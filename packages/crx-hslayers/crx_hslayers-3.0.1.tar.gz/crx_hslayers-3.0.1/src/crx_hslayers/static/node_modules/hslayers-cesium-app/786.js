"use strict";(self.webpackChunkhslayers_cesium_app=self.webpackChunkhslayers_cesium_app||[]).push([[786],{42786:(D,m,i)=>{i.r(m),i.d(m,{HsFeatureFilterPipe:()=>g,HsFeatureTableComponent:()=>A,HsFeatureTableModule:()=>B,HsFeatureTableService:()=>F,HsLayerFeaturesComponent:()=>v});var e=i(7404);let g=(()=>{class a{transform(t,r){return t?r?(r=r.toLocaleLowerCase(),t.filter(s=>s.name.toLocaleLowerCase().includes(r)).slice(0,20)):t:[]}static#e=this.\u0275fac=function(r){return new(r||a)};static#t=this.\u0275pipe=e.EJ8({name:"featureFilter",type:a,pure:!0})}return a})();var d=i(25849),T=i(53848),h=i(88716),p=i(27426),_=i(76253);let F=(()=>{class a{constructor(t,r,s){this.hsUtilsService=t,this.hsLayerUtilsService=r,this.hsQueryVectorService=s,this.sortReverse=!1,this.lastSortValue="",this.features=[]}addLayer(t){if(!(0,h.W1)(t)&&this.hsUtilsService.instOf(t,T.A)&&(void 0===(0,h.lg)(t)||1==(0,h.lg)(t)))return this.wrapLayer(t)}wrapLayer(t){return{title:(0,h.LK)(t),lyr:t,type:"vector"}}fillFeatureList(t){const r=this.hsLayerUtilsService.isLayerClustered(t)?t.getSource().getSource():t.getSource();this.features=r.getFeatures().map(s=>this.describeFeature(s)).filter(s=>s?.attributes?.length>0)}updateFeatureDescription(t){const r=this.describeFeature(t),s=this.features.findIndex(n=>n.feature==t);r&&s>-1&&(this.features[s]=r)}addFeatureDescription(t){const r=this.describeFeature(t);r&&this.features.push(r)}removeFeatureDescription(t){const r=this.features.findIndex(s=>s.feature==t);r>-1&&this.features.splice(r,1)}describeFeature(t){const r=this.hsQueryVectorService.getFeatureAttributes(t).pop();return r?{name:this.setFeatureName(r.attributes),feature:t,attributes:this.attributesWithoutFeatureName(r.attributes),stats:r.stats}:null}setFeatureName(t){if(t.length>0){let r="Feature";for(const s of t)"name"===s.name&&(r=s.value);return r}return"Feature"}attributesWithoutFeatureName(t){return t.filter(r=>"name"!==r.name)}sortFeaturesBy(t){void 0!==this.features&&this.features.length>1&&(this.sortReverse=this.lastSortValue===t&&!this.sortReverse,this.features=this.features.sort((r,s)=>this.sortFeatures(r,s,t)))}sortFeatures(t,r,s){let n,o,u;return"name"===s?(n=t[s],o=r[s]):(n=this.getValue(t.attributes,s),o=this.getValue(r.attributes,s)),null===n&&(u=1),null===o&&(u=-1),"string"==typeof n&&"string"==typeof o&&(u=n.charAt(0)>o.charAt(0)?1:n.charAt(0)<o.charAt(0)?-1:0),"number"==typeof n&&"number"==typeof o&&(u=n-o),this.sortReverse&&(u*=-1),this.lastSortValue=s,u}getValue(t,r){let s=t.filter(n=>n.name==r).map(n=>n.value);return s=0==s.length||void 0===s?null:s[0],s}static#e=this.\u0275fac=function(r){return new(r||a)(e.KVO(p.MJ),e.KVO(p.Xp),e.KVO(_.Y))};static#t=this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var L=i(40736),b=i(14608),S=i(5811),c=i(60316),E=i(70258),R=i(91459),f=i(34456),H=i(31968);const C=()=>({module:"LAYERS"});function I(a,l){if(1&a&&(e.j41(0,"span")(1,"i"),e.EFF(2),e.k0s()()),2&a){const t=e.XpG().$implicit;e.R7$(2),e.JRh(t.value)}}function $(a,l){if(1&a&&e.nrm(0,"span",19),2&a){const t=e.XpG().$implicit;e.Y8G("innerHTML",t.sanitizedValue,e.npT)}}function k(a,l){if(1&a){const t=e.RV6();e.j41(0,"a",6),e.bIt("click",function(){const s=e.eBV(t).$implicit,n=e.XpG(4);return e.Njj(n.executeOperation(s))}),e.j41(1,"span")(2,"i"),e.EFF(3),e.k0s()()()}if(2&a){const t=l.$implicit,r=e.XpG(4);e.R7$(3),e.SpI(" ",r.translate(t.customActionName)||r.translate(t.action),";")}}function G(a,l){if(1&a&&(e.j41(0,"div"),e.DNE(1,k,4,1,"a",20),e.k0s()),2&a){const t=e.XpG().$implicit;e.R7$(),e.Y8G("ngForOf",t.value.operations)}}function j(a,l){if(1&a){const t=e.RV6();e.j41(0,"tr",13)(1,"th",14),e.EFF(2),e.j41(3,"a",15),e.nI1(4,"translateHs"),e.bIt("click",function(){const s=e.eBV(t).$implicit,n=e.XpG(2);return e.Njj(n.sortFeaturesBy(s.name))}),e.EFF(5,"^"),e.k0s()(),e.j41(6,"td",16),e.DNE(7,I,3,1,"span",17),e.j41(8,"i"),e.DNE(9,$,1,1,"span",18),e.k0s(),e.DNE(10,G,2,1,"div",17),e.k0s()()}if(2&a){const t=l.$implicit,r=e.XpG(2);e.R7$(2),e.SpI(" ",r.translate(t.name),""),e.R7$(),e.Y8G("title",e.bMT(4,5,"FEATURE_TABLE.sortFeaturesByValue")),e.R7$(4),e.Y8G("ngIf",!(t.sanitizedValue||null!=t.value&&t.value.operations)),e.R7$(2),e.Y8G("ngIf",!!t.sanitizedValue),e.R7$(),e.Y8G("ngIf",null==t.value?null:t.value.operations)}}function M(a,l){if(1&a&&(e.j41(0,"tr",21)(1,"th",14),e.EFF(2),e.k0s(),e.j41(3,"td",16)(4,"span")(5,"i"),e.EFF(6),e.k0s()()()()),2&a){const t=l.$implicit,r=e.XpG(2);e.Y8G("hidden",!r.showFeatureStats),e.R7$(2),e.SpI(" ",r.translate(t.name),""),e.R7$(4),e.JRh(t.value)}}function U(a,l){if(1&a){const t=e.RV6();e.j41(0,"table",7)(1,"thead")(2,"tr",8)(3,"th",9),e.EFF(4),e.j41(5,"a",10),e.nI1(6,"translateHs"),e.bIt("click",function(){const s=e.eBV(t).$implicit,n=e.XpG();return e.Njj(n.sortFeaturesBy(s.name))}),e.EFF(7,"^"),e.k0s()()()(),e.j41(8,"tbody"),e.DNE(9,j,11,7,"tr",11)(10,M,7,3,"tr",12),e.k0s()()}if(2&a){const t=l.$implicit,r=e.XpG();e.R7$(4),e.JRh(r.translate(t.name)),e.R7$(),e.Y8G("title",e.bMT(6,4,"FEATURE_TABLE.sortFeaturesByValue")),e.R7$(4),e.Y8G("ngForOf",t.attributes),e.R7$(),e.Y8G("ngForOf",t.stats)}}let v=(()=>{class a{constructor(t,r,s,n,o){this.hsFeatureTableService=t,this.hsUtilsService=r,this.hsMapService=s,this.hsLanguageService=n,this.hsLayerUtilsService=o,this.showFeatureStats=!1,this.searchedFeatures=""}ngOnInit(){const t=this.layer.lyr,r=this.hsLayerUtilsService.isLayerClustered(t)?t.getSource().getSource():t.getSource();r&&(this.hsFeatureTableService.fillFeatureList(t),r.on("changefeature",s=>{this.hsFeatureTableService.updateFeatureDescription(s.feature)}),r.on("addfeature",s=>{this.hsFeatureTableService.addFeatureDescription(s.feature)}),r.on("removefeature",s=>{this.hsFeatureTableService.removeFeatureDescription(s.feature)}))}executeOperation(t){switch(t.action){case"zoom to":const r=t.feature.getGeometry().getExtent();this.hsMapService.fitExtent(r);break;case"custom action":t.customAction(t.feature)}}translate(t){return this.hsLanguageService.getTranslationIgnoreNonExisting("FEATURE_TABLE",t,void 0)}sortFeaturesBy(t){this.hsFeatureTableService.sortFeaturesBy(t)}static#e=this.\u0275fac=function(r){return new(r||a)(e.rXU(F),e.rXU(p.MJ),e.rXU(b.F),e.rXU(R.LJ),e.rXU(p.Xp))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["hs-layer-features"]],inputs:{layer:"layer"},decls:15,vars:16,consts:[[1,"mt-1",2,"text-align","center"],[1,"form-group","mt-1","mb-1"],[1,"input-group",2,"margin-bottom","4px"],["type","text","name","FeatureName",1,"form-control","hs-filter",3,"ngModelChange","placeholder","ngModel"],["style","width:100%;",4,"ngFor","ngForOf"],[1,"p-2"],[3,"click"],[2,"width","100%"],[2,"text-align","center","background-color","rgba(0,0,0,0.05)"],["colspan","2"],[2,"float","center",3,"click","title"],["rowspan","3",4,"ngFor","ngForOf"],["class","tdbreak",3,"hidden",4,"ngFor","ngForOf"],["rowspan","3"],[1,"tdbreak",2,"background-color","rgba(0,0,0,0.03)"],[2,"float","right",3,"click","title"],[1,"tdbreak",2,"min-width","200px","max-width","200px"],[4,"ngIf"],[3,"innerHTML",4,"ngIf"],[3,"innerHTML"],[3,"click",4,"ngFor","ngForOf"],[1,"tdbreak",3,"hidden"]],template:function(r,s){1&r&&(e.j41(0,"h3",0),e.EFF(1),e.nI1(2,"translateHs"),e.k0s(),e.j41(3,"div",1)(4,"div",2)(5,"input",3),e.nI1(6,"translateHs"),e.mxI("ngModelChange",function(o){return e.DH7(s.searchedFeatures,o)||(s.searchedFeatures=o),o}),e.k0s()()(),e.DNE(7,U,11,6,"table",4),e.nI1(8,"featureFilter"),e.j41(9,"p",5)(10,"small")(11,"a",6),e.bIt("click",function(){return s.showFeatureStats=!s.showFeatureStats}),e.EFF(12),e.nI1(13,"translateHs"),e.k0s()()(),e.nrm(14,"hr")),2&r&&(e.R7$(),e.JRh(e.i5U(2,5,s.layer.title,e.lJ4(15,C))),e.R7$(4),e.Y8G("placeholder",e.bMT(6,8,"COMMON.filter")),e.R50("ngModel",s.searchedFeatures),e.R7$(2),e.Y8G("ngForOf",e.i5U(8,10,s.hsFeatureTableService.features,s.searchedFeatures)),e.R7$(5),e.JRh(e.bMT(13,13,"FEATURE_TABLE.showFeatureStats")))},dependencies:[c.Sq,c.bT,f.me,f.BC,f.vS,H.q,g],styles:["td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid #dddddd;text-align:left;padding:6px;font-size:.875rem}.tdbreak[_ngcontent-%COMP%]{overflow-wrap:break-word;word-break:break-word}\n\n/*# sourceMappingURL=layer-features.component.ts-angular-inline--10.css.map*/"]})}return a})();function V(a,l){if(1&a&&(e.j41(0,"div"),e.nrm(1,"hs-layer-features",5),e.k0s()),2&a){const t=l.$implicit;e.R7$(),e.Y8G("layer",t)}}function x(a,l){if(1&a&&(e.j41(0,"div",1),e.nrm(1,"hs-panel-header",2),e.j41(2,"div",3),e.DNE(3,V,2,1,"div",4),e.k0s()()),2&a){const t=e.XpG();e.R7$(),e.Y8G("panelTabs","FEATURE_TABLE"),e.R7$(2),e.Y8G("ngForOf",t.layers)}}let A=(()=>{class a extends d.aH{constructor(t,r,s,n){super(),this.hsFeatureTableService=t,this.hsConfig=r,this.hsMapService=s,this.hsSidebarService=n,this.layers=[],this.name="feature-table"}ngOnInit(){this.hsSidebarService.addButton({panel:"featureTable",module:"hs.feature-table",order:14,fits:!0,title:"PANEL_HEADER.FEATURE_TABLE",description:"SIDEBAR.descriptions.FEATURE_TABLE",icon:"icon-indexmanager"}),this.hsMapService.loaded().then(()=>{for(const t of this.hsConfig.layersInFeatureTable||[])this.addLayerToTable(t)})}addLayerToTable(t){const r=this.hsFeatureTableService.addLayer(t);r&&this.layers.push(r)}static#e=this.\u0275fac=function(r){return new(r||a)(e.rXU(F),e.rXU(L.Q),e.rXU(b.F),e.rXU(S.x))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["hs-feature-table"]],features:[e.Vt3],decls:2,vars:3,consts:[["class","card hs-main-panel",4,"ngIf"],[1,"card","hs-main-panel"],["name","feature-table",3,"panelTabs"],[1,"card-body"],[4,"ngFor","ngForOf"],[3,"layer"]],template:function(r,s){1&r&&(e.DNE(0,x,4,2,"div",0),e.nI1(1,"async")),2&r&&e.Y8G("ngIf",e.bMT(1,1,s.isVisible$))},dependencies:[c.Sq,c.bT,E.k,v,c.Jj],encapsulation:2})}return a})();var O=i(56485);let B=(()=>{class a{static#e=this.\u0275fac=function(r){return new(r||a)};static#t=this.\u0275mod=e.$C({type:a});static#r=this.\u0275inj=e.G2t({imports:[c.MD,f.YN,d.Zz,O.zH,d.k4]})}return a})()}}]);
//# sourceMappingURL=786.js.map