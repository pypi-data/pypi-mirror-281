{"version":3,"file":"projects_hslayers_components_search_index_ts.js","mappings":"AAAA,aAAa,0HAA0H,gBAAgB,cAAc,gLAAgL,EAAE,eAAe,YAAY,QAAQ,eAAe,oBAAoB,oCAAoC,kBAAkB,gCAAgC,8BAA8B,EAAE,SAAS,IAAI,8LAA8L,YAAY,QAAQ,2BAA2B,+MAA+M,kCAAkC,iBAAiB,sDAAsD,0FAA0F,WAAW,gBAAgB,qaAAqa,kBAAkB,QAAQ,4GAA4G,EAAE,YAAY,2BAA2B,qFAAqF,EAAE,+NAA+N,yBAAyB,4EAA4E,gCAAgC,OAAO,GAAG,2BAA2B,gDAAgD,kBAAkB,EAAE,0BAA0B,gSAAgS,mBAAmB,gEAAgE,mBAAmB,qFAAqF,eAAe,4BAA4B,4CAA4C,0BAA0B,yCAAyC,uGAAuG,mBAAmB,0EAA0E,gDAAgD,qCAAqC,EAAE,2KAA2K,kBAAkB,oCAAoC,+JAA+J,oFAAoF,EAAE,uBAAuB,2CAA2C,4TAA4T,0BAA0B,sDAAsD,4BAA4B,4CAA4C,0BAA0B,uBAAuB,uBAAuB,mGAAmG,EAAE,4DAA4D,yBAAyB,iDAAiD,2BAA2B,4CAA4C,0BAA0B,uBAAuB,uBAAuB,6DAA6D,EAAE,6BAA6B,oCAAoC,oGAAoG,gCAAgC,8CAA8C,EAAE,SAAS,IAAI,qCAAqC,gBAAgB,QAAQ,gBAAgB,6CAA6C,SAAS,gBAAgB,wBAAwB,0BAA0B,YAAY,QAAQ,qBAAqB,+NAA+N,qBAAqB,EAAE,cAAc,qDAAqD,WAAW,0DAA0D,kHAAkH,eAAe,WAAW,0BAA0B,6GAA6G,IAAI,QAAQ,wHAAwH,oBAAoB,8EAA8E,oCAAoC,8DAA8D,+BAA+B,seAAse,8DAA8D,6BAA6B,4HAA4H,uCAAuC,mCAAmC,wBAAwB,+PAA+P,wDAAwD,EAAE,SAAS,IAAI,eAAe,aAAa,SAAS,EAAE,gBAAgB,QAAQ,gBAAgB,wCAAwC,sCAAsC,0BAA0B,yBAAyB,sCAAsC,sCAAsC,0BAA0B,sCAAsC,sCAAsC,+DAA+D,QAAQ,oBAAoB,iJAAiJ,gBAAgB,wGAAwG,oBAAoB,wJAAwJ,YAAY,QAAQ,iBAAiB,qJAAqJ,6BAA6B,mFAAmF,aAAa,EAAE,cAAc,oCAAoC,wBAAwB,qEAAqE,QAAQ,6BAA6B,eAAe,6EAA6E,qBAAqB,sCAAsC,iBAAiB,UAAU,qBAAqB,0GAA0G,SAAS,iIAAiI,oCAAoC,uCAAuC,+BAA+B,qcAAqc,0LAA0L,iDAAiD,EAAE,SAAS,IAAI,qCAAqC,gBAAgB,2KAA2K,YAAY,qBAAqB,mBAAmB,qOAAqO,qBAAqB,EAAE,cAAc,qDAAqD,WAAW,6FAA6F,oCAAoC,qDAAqD,+BAA+B,wNAAwN,0FAA0F,kDAAkD,EAAE,SAAS,YAAY,QAAQ,oCAAoC,kBAAkB,8BAA8B,OAAO,EAAE,+BAA+B,8BAA8B,EAAE,SAAS,YAAY,qBAAqB,cAAc,kCAAkC,oCAAoC,kBAAkB,+BAA+B,mIAAmI,sKAAsK,yCAAyC,EAAE,SAAS,KAAK","sources":["webpack:///projects_hslayers_components_search_index_ts.js"],"sourcesContent":["\"use strict\";(self.webpackChunkhslayers_app=self.webpackChunkhslayers_app||[]).push([[\"projects_hslayers_components_search_index_ts\"],{65510:(Q,y,a)=>{a.r(y),a.d(y,{HsSearchComponent:()=>J,HsSearchInputComponent:()=>g,HsSearchModule:()=>N,HsSearchResultsComponent:()=>S,HsSearchService:()=>m,HsSearchToolbarComponent:()=>z,limitToPipe:()=>C});var e=a(93953);let C=(()=>{class r{transform(s,t){return s.slice(0,t)}static#e=this.\\u0275fac=function(t){return new(t||r)};static#s=this.\\u0275pipe=e.EJ8({name:\"limitTo\",type:r,pure:!0})}return r})();var H=a(10467),b=a(64801),f=a(40736),M=a(21413),I=a(34958),T=a(48791),j=a(47616),O=a(35901),U=a(15253),F=a(87549),G=a(65935),v=a(88716),L=a(21626),V=a(27426),B=a(14608),E=a(5991),l=a(22187);let m=(()=>{class r{constructor(s,t,i,n,o,d,R){this.http=s,this.hsUtilsService=t,this.hsConfig=i,this.hsMapService=n,this.hsStylerService=o,this.hsEventBusService=d,this.hsLayerUtilsService=R,this.formatWKT=new U.A,this.canceler=new M.B,this.providers={},this.searchResultsLayer=new j.A({source:new O.A({}),style:this.hsStylerService.pin_white_blue_highlight}),(0,v.D6)(this.searchResultsLayer,\"Search results\"),(0,v.t0)(this.searchResultsLayer,!1)}request(s){let t=null,i=[];void 0!==this.hsConfig.search_provider&&void 0===this.hsConfig.searchProvider&&(this.hsConfig.searchProvider=this.hsConfig.search_provider),void 0===this.hsConfig.searchProvider?i=[\"geonames\"]:\"string\"==typeof this.hsConfig.searchProvider||\"function\"==typeof this.hsConfig.searchProvider?i=[this.hsConfig.searchProvider]:\"object\"==typeof this.hsConfig.searchProvider&&(i=this.hsConfig.searchProvider),this.cleanResults();for(const n of i){let o=n;\"geonames\"==n?(t=void 0!==this.hsConfig.geonamesUser?`http://api.geonames.org/searchJSON?&name_startsWith=${s}&username=${this.hsConfig.geonamesUser}`:this.hsUtilsService.proxify(`http://api.geonames.org/searchJSON?&name_startsWith=${s}`),\"https:\"==window.location.protocol&&(t=this.hsUtilsService.proxify(t))):\"sdi4apps_openapi\"==n?t=\"http://portal.sdi4apps.eu/openapi/search?q=\"+s:\"function\"==typeof n&&(t=n(s),o=\"searchProvider\"==n.name?\"geonames\":n.name);const d=this.canceler[o];void 0!==d&&d.unsubscribe(),this.canceler[o]=this.http.get(t).subscribe(R=>{this.searchResultsReceived(R,o)},()=>{})}}searchResultsReceived(s,t){void 0===this.providers[t]&&(this.providers[t]={results:[],name:t});const i=this.providers[t];t.indexOf(\"geonames\")>-1?this.parseGeonamesResults(s,i):\"sdi4apps_openapi\"==t?this.parseOpenApiResults(s,i):this.parseGeonamesResults(s,i),this.pointerMoveEventKey=this.hsMapService.getMap().on(\"pointermove\",n=>this.mapPointerMoved(n)),this.hsEventBusService.searchResultsReceived.next()}hideResultsLayer(){this.hsMapService.getMap().removeLayer(this.searchResultsLayer)}showResultsLayer(){this.hideResultsLayer(),this.hsMapService.getMap().addLayer(this.searchResultsLayer)}cleanResults(){if(void 0!==this.providers){for(const s of Object.keys(this.providers)){const t=this.providers[s];void 0!==t.results&&(t.results.length=0)}this.searchResultsLayer.getSource().clear(),this.hideResultsLayer(),(0,G.e)(this.pointerMoveEventKey)}}mapPointerMoved(s){const t=this.hsMapService.getMap().getFeaturesAtPixel(s.pixel).filter(i=>{const n=this.hsMapService.getLayerForFeature(i);return n&&n==this.searchResultsLayer});for(const i of Object.keys(this.providers).map(n=>this.providers[n]).filter(n=>n?.results))this.hsLayerUtilsService.highlightFeatures(t,this.searchResultsLayer,i.results)}selectResult(s,t){const i=this.getResultCoordinate(s);this.hsMapService.getMap().getView().setCenter(i),void 0===t&&(t=10),this.hsMapService.getMap().getView().setZoom(t),this.hsEventBusService.searchZoomTo.next({coordinate:(0,F.transform)(i,this.hsMapService.getCurrentProj(),\"EPSG:4326\"),zoom:t})}getResultCoordinate(s){const t=this.hsMapService.getCurrentProj();return s.provider_name.indexOf(\"geonames\")>-1||\"searchFunctionsearchProvider\"==s.provider_name?(0,F.transform)([parseFloat(s.lng),parseFloat(s.lat)],\"EPSG:4326\",t):\"sdi4apps_openapi\"==s.provider_name?this.formatWKT.readFeature(s.FullGeom.toUpperCase()).getGeometry().transform(\"EPSG:4326\",t).getCoordinates():void 0}parseGeonamesResults(s,t){t.results=s.geonames,this.generateGeonamesFeatures(t)}generateGeonamesFeatures(s){const t=this.searchResultsLayer.getSource();for(const i of s.results){i.provider_name=s.name;const n=new I.default({geometry:new T.default(this.getResultCoordinate(i)),record:i,id:this.hsUtilsService.generateUuid()});n.setId(n.get(\"id\")),t.addFeature(n),i.featureId=n.getId()}}parseOpenApiResults(s,t){t.results=s.data,this.generateOpenApiFeatures(t)}generateOpenApiFeatures(s){const t=this.searchResultsLayer.getSource();for(const i of s.results){i.provider_name=s.name;const n=new I.default({geometry:new T.default(this.getResultCoordinate(i)),record:i});t.addFeature(n),i.feature=n}}static#e=this.\\u0275fac=function(t){return new(t||r)(e.KVO(L.Qq),e.KVO(V.MJ),e.KVO(f.Q),e.KVO(B.F),e.KVO(E.qm),e.KVO(l.z),e.KVO(V.Xp))};static#s=this.\\u0275prov=e.jDH({token:r,factory:r.\\u0275fac,providedIn:\"root\"})}return r})();var u=a(89417),h=a(60177),$=a(31968);function D(r,c){if(1&r){const s=e.RV6();e.j41(0,\"button\",5),e.bIt(\"click\",function(){e.eBV(s);const i=e.XpG();return e.Njj(i.clear())}),e.nrm(1,\"i\",6),e.k0s()}}let g=(()=>{class r{constructor(s,t,i,n){this.hsConfig=s,this.hsSearchService=t,this.hsEventBusService=i,this.hsShareUrlService=n,this.query=\"\",this.clearVisible=!1,this.searchResultsReceivedSubscription=this.hsEventBusService.searchResultsReceived.subscribe(()=>{this.clearVisible=!0})}ngOnDestroy(){this.searchResultsReceivedSubscription.unsubscribe()}ngOnInit(){const s=this.hsShareUrlService.getParamValue(b.Rv.search);s&&(this.query=s,this.queryChanged()),this.searchInputVisible=!(window.innerWidth<this.hsConfig.mobileBreakpoint)}queryChanged(){var s=this;return(0,H.A)(function*(){yield s.hsSearchService.hsMapService.loaded(),0!=s.query.length?s.hsSearchService.request(s.query):s.clear()})()}clear(){this.query=\"\",this.clearVisible=!1,this.hsSearchService.cleanResults(),this.hsEventBusService.clearSearchResults.next()}toggleSearchInput(){this.searchInputVisible=!this.searchInputVisible,\"\"!=this.query&&this.clear()}static#e=this.\\u0275fac=function(t){return new(t||r)(e.rXU(f.Q),e.rXU(m),e.rXU(l.z),e.rXU(b.JX))};static#s=this.\\u0275cmp=e.VBU({type:r,selectors:[[\"hs-search-input\"]],decls:7,vars:9,consts:[[1,\"input-group\"],[1,\"btn\",\"btn-light\",\"btn-outline-secondary\",\"rounded-0\",\"hs-toolbar-button\",3,\"click\"],[1,\"glyphicon\",\"icon-search\",3,\"title\"],[\"name\",\"query\",1,\"form-control\",\"hs-search-address-input\",\"rounded-0\",\"hs-toolbar-button\",3,\"ngModelChange\",\"ngModel\",\"hidden\",\"placeholder\"],[\"class\",\"clearSearch\",3,\"click\",4,\"ngIf\"],[1,\"clearSearch\",3,\"click\"],[1,\"icon-remove-circle\",\"align-middle\"]],template:function(t,i){1&t&&(e.j41(0,\"div\",0)(1,\"button\",1),e.bIt(\"click\",function(){return i.toggleSearchInput()}),e.nrm(2,\"i\",2),e.nI1(3,\"translateHs\"),e.k0s(),e.j41(4,\"input\",3),e.nI1(5,\"translateHs\"),e.mxI(\"ngModelChange\",function(o){return e.DH7(i.query,o)||(i.query=o),o}),e.bIt(\"ngModelChange\",function(){return i.queryChanged()}),e.k0s(),e.DNE(6,D,2,0,\"button\",4),e.k0s()),2&t&&(e.R7$(2),e.Y8G(\"title\",e.bMT(3,5,\"COMMON.search\")),e.R7$(2),e.R50(\"ngModel\",i.query),e.Y8G(\"hidden\",!i.searchInputVisible)(\"placeholder\",e.bMT(5,7,\"COMMON.search\")),e.R7$(2),e.Y8G(\"ngIf\",i.clearVisible))},dependencies:[u.me,u.BC,u.vS,h.bT,$.q],encapsulation:2})}return r})();var P=a(56977);const x=r=>({active:r});function A(r,c){if(1&r){const s=e.RV6();e.j41(0,\"a\",4),e.bIt(\"click\",function(){const i=e.eBV(s).$implicit,n=e.XpG(2);return e.Njj(n.zoomTo(i))})(\"mouseover\",function(){const i=e.eBV(s).$implicit,n=e.XpG(2);return e.Njj(n.highlightResult(i,!0))})(\"mouseleave\",function(){const i=e.eBV(s).$implicit,n=e.XpG(2);return e.Njj(n.highlightResult(i,!1))}),e.EFF(1),e.j41(2,\"small\",5),e.nrm(3,\"br\"),e.EFF(4),e.k0s()()}if(2&r){const s=c.$implicit;e.Y8G(\"ngClass\",e.eq3(4,x,s.highlighted)),e.BMQ(\"title\",s.DisplayDescription),e.R7$(),e.JRh(s.name||s.DisplayTitle),e.R7$(3),e.JRh(s.fcodeName)}}function X(r,c){if(1&r&&(e.j41(0,\"div\")(1,\"a\",2),e.EFF(2),e.k0s(),e.DNE(3,A,5,6,\"a\",3),e.nI1(4,\"limitTo\"),e.k0s()),2&r){const s=c.$implicit;e.R7$(),e.Y8G(\"hidden\",!(s.value.results.length>0)),e.R7$(),e.SpI(\"Provider: \",s.value.name,\"\"),e.R7$(),e.Y8G(\"ngForOf\",e.i5U(4,3,s.value.results,10))}}let S=(()=>{class r{constructor(s,t){this.hsEventBusService=s,this.hsSearchService=t,this.end=new M.B,this.hsEventBusService.searchResultsReceived.pipe((0,P.Q)(this.end)).subscribe(()=>{this.searchResultsReceived()}),this.hsEventBusService.clearSearchResults.pipe((0,P.Q)(this.end)).subscribe(()=>{this.clear()})}ngOnDestroy(){this.end.next(),this.end.complete()}searchResultsReceived(){this.searchResultsVisible=!0,this.hsSearchService.showResultsLayer()}clear(){this.searchResultsVisible=!1}findFeature(s){return this.hsSearchService.searchResultsLayer.getSource().getFeatureById(s)}highlightResult(s,t){const i=this.findFeature(s.featureId);i&&(0,v.YD)(i,t)}zoomTo(s){this.fcode_zoom_map={PPLA:12,PPL:15,PPLC:10,ADM1:9,FRM:15,PPLF:13,LCTY:13,RSTN:15,PPLA3:9,AIRP:13,AIRF:13,HTL:17,STM:14,LK:13};let t=10;void 0!==s.fcode&&void 0!==this.fcode_zoom_map[s.fcode]&&(t=this.fcode_zoom_map[s.fcode]),this.hsSearchService.selectResult(s,t)}static#e=this.\\u0275fac=function(t){return new(t||r)(e.rXU(l.z),e.rXU(m))};static#s=this.\\u0275cmp=e.VBU({type:r,selectors:[[\"hs-search-results\"]],decls:3,vars:4,consts:[[1,\"list-group\",2,\"display\",\"block\",\"margin-bottom\",\"0px\",3,\"hidden\"],[4,\"ngFor\",\"ngForOf\"],[1,\"list-group-item\",\"active\",3,\"hidden\"],[\"class\",\"list-group-item hsl-search-result\",3,\"ngClass\",\"click\",\"mouseover\",\"mouseleave\",4,\"ngFor\",\"ngForOf\"],[1,\"list-group-item\",\"hsl-search-result\",3,\"click\",\"mouseover\",\"mouseleave\",\"ngClass\"],[2,\"color\",\"rgb(148, 143, 143)\"]],template:function(t,i){1&t&&(e.j41(0,\"div\",0),e.DNE(1,X,5,6,\"div\",1),e.nI1(2,\"keyvalue\"),e.k0s()),2&t&&(e.Y8G(\"hidden\",!i.searchResultsVisible),e.R7$(),e.Y8G(\"ngForOf\",e.bMT(2,2,i.hsSearchService.providers)))},dependencies:[h.YU,h.Sq,h.lG,C],encapsulation:2})}return r})();var p=a(25849),Y=a(91459),K=a(70258);function k(r,c){1&r&&(e.j41(0,\"div\"),e.nrm(1,\"hs-panel-header\",1),e.j41(2,\"div\",2),e.nrm(3,\"hs-search-input\")(4,\"hs-search-results\"),e.k0s()()),2&r&&(e.R7$(),e.Y8G(\"panelTabs\",\"SEARCH\"))}let J=(()=>{class r extends p.aH{constructor(s,t,i){super(),this.hsEventBusService=s,this.hsConfig=t,this.hsLanguageService=i,this.replace=!1,this.clearVisible=!1,this.name=\"search\",this.searchResultsReceivedSubscription=this.hsEventBusService.searchResultsReceived.subscribe(()=>{this.clearVisible=!0})}ngOnDestroy(){this.searchResultsReceivedSubscription.unsubscribe()}ngOnInit(){super.ngOnInit(),this.searchInputVisible=!(window.innerWidth<this.hsConfig.mobileBreakpoint)}static#e=this.\\u0275fac=function(t){return new(t||r)(e.rXU(l.z),e.rXU(f.Q),e.rXU(Y.LJ))};static#s=this.\\u0275cmp=e.VBU({type:r,selectors:[[\"hs-search\"]],features:[e.Vt3],decls:2,vars:3,consts:[[4,\"ngIf\"],[\"name\",\"Search\",3,\"panelTabs\"],[1,\"input-group\",\"search-panel\",\"hs-search-address\",\"pt-1\",\"pb-1\",\"d-flex\"]],template:function(t,i){1&t&&(e.DNE(0,k,5,1,\"div\",0),e.nI1(1,\"async\")),2&t&&e.Y8G(\"ngIf\",e.bMT(1,1,i.isVisible$))},dependencies:[h.bT,K.k,S,g,h.Jj],encapsulation:2})}return r})(),N=(()=>{class r{static#e=this.\\u0275fac=function(t){return new(t||r)};static#s=this.\\u0275mod=e.$C({type:r});static#t=this.\\u0275inj=e.G2t({imports:[u.YN,h.MD,p.Zz,p.k4]})}return r})(),z=(()=>{class r extends p.Bh{constructor(){super(),this.name=\"searchToolbar\"}static#e=this.\\u0275fac=function(t){return new(t||r)};static#s=this.\\u0275cmp=e.VBU({type:r,selectors:[[\"hs-search-toolbar\"]],features:[e.Vt3],decls:5,vars:3,consts:[[1,\"nav-item\",3,\"hidden\"]],template:function(t,i){1&t&&(e.j41(0,\"div\",0),e.nI1(1,\"async\"),e.j41(2,\"div\"),e.nrm(3,\"hs-search-input\")(4,\"hs-search-results\"),e.k0s()()),2&t&&e.Y8G(\"hidden\",!1===e.bMT(1,1,i.isVisible$))},dependencies:[S,g,h.Jj],encapsulation:2})}return r})()}}]);"],"names":[],"sourceRoot":""}