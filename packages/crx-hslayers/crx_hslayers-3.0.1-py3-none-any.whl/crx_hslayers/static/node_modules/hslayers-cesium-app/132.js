"use strict";(self.webpackChunkhslayers_cesium_app=self.webpackChunkhslayers_cesium_app||[]).push([[132],{12132:(L,T,i)=>{i.r(T),i.d(T,{HsGeolocationComponent:()=>z,HsGeolocationModule:()=>B,HsGeolocationService:()=>P});var v=i(25849),e=i(7404),m=i(89204),E=i(29814),C=i(61099),O=i(18194),G=i(1963),o=i(29100),s=i(49964),n=i(7375),l=i(25058),h=i(93812),u=i(45363),p=i(15279);class y extends n.Ay{constructor(a){super("error"),this.code=a.code,this.message=a.message}}const H=class k extends l.A{constructor(a){super(),a=a||{},this.position_=null,this.transform_=u.identityTransform,this.watchId_=void 0,this.addChangeListener("projection",this.handleProjectionChanged_),this.addChangeListener("tracking",this.handleTrackingChanged_),void 0!==a.projection&&this.setProjection(a.projection),void 0!==a.trackingOptions&&this.setTrackingOptions(a.trackingOptions),this.setTracking(void 0!==a.tracking&&a.tracking)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const a=this.getProjection();a&&(this.transform_=(0,u.getTransformFromProjections)((0,u.get)("EPSG:4326"),a),this.position_&&this.set("position",this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const a=this.getTracking();a&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!a&&void 0!==this.watchId_&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(a){const t=a.coords;this.set("accuracy",t.accuracy),this.set("altitude",null===t.altitude?void 0:t.altitude),this.set("altitudeAccuracy",null===t.altitudeAccuracy?void 0:t.altitudeAccuracy),this.set("heading",null===t.heading?void 0:(0,p.eh)(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const d=this.transform_(this.position_);this.set("position",d.slice()),this.set("speed",null===t.speed?void 0:t.speed);const g=(0,h.circular)(this.position_,t.accuracy);g.applyTransform(this.transform_),this.set("accuracyGeometry",g),this.changed()}positionError_(a){this.dispatchEvent(new y(a))}getAccuracy(){return this.get("accuracy")}getAccuracyGeometry(){return this.get("accuracyGeometry")||null}getAltitude(){return this.get("altitude")}getAltitudeAccuracy(){return this.get("altitudeAccuracy")}getHeading(){return this.get("heading")}getPosition(){return this.get("position")}getProjection(){return this.get("projection")}getSpeed(){return this.get("speed")}getTracking(){return this.get("tracking")}getTrackingOptions(){return this.get("trackingOptions")}setProjection(a){this.set("projection",(0,u.get)(a))}setTracking(a){this.set("tracking",a)}setTrackingOptions(a){this.set("trackingOptions",a)}};var R=i(94691),S=i(17804),N=i(60411),j=i(53848),I=i(88716),F=i(14608),b=i(24025),w=i(38243),D=i(27426);let P=(()=>{class c{constructor(t,d,g,J){this.HsMapService=t,this.HsLayoutService=d,this.hsLog=g,this.HsUtilsService=J,this.localization=!1,this.trackOrientation=!1,this.following=!1,this.setAccuracyFeature(),this.setPositionFeature(),this.setStyle(),this.HsMapService.loaded().then(W=>{this.geolocation=new H({projection:this.HsMapService.getCurrentProj(),trackingOptions:{enableHighAccuracy:!0}}),this.accuracyFeature.setStyle(this.style),this.positionFeature.setStyle(this.style),this.position_layer=new j.A({source:new N.A}),(0,I.D6)(this.position_layer,"Position"),(0,I.t0)(this.position_layer,!1),(0,I.Gu)(this.position_layer,!1);const M=this.position_layer.getSource();M.addFeature(this.accuracyFeature),M.addFeature(this.positionFeature),W.addControl(new S.A({resetNorth:this.toggleOrientation.bind(this),className:"ol-rotate hidden",autoHide:!1}))})}stopTracking(){this.following=!1,this.getRotate().element.classList.add("hidden"),this.geolocation.setTracking(!1),this.HsMapService.getMap().getView().setRotation(0)}toggleTracking(){var t=this;return(0,m.A)(function*(){if(t.clicked)return t.cancelClick=!0,void("bottom"==t.HsLayoutService.sidebarPosition$.getValue()&&t.HsLayoutService.contentWrapper.querySelector(".hs-locationButton").dispatchEvent(new Event("dblclick")));t.clicked=!0,setTimeout(()=>{if(t.cancelClick)return t.cancelClick=!1,void(t.clicked=!1);if(t.isCentered())t.following?(t.stopTracking(),t.toggleOrientation()):(t.geolocation.on("change:position",()=>t.setNewPosition()),t.geolocation.setTracking(!0),t.following=!0,t.toggleOrientation());else{const d=t.geolocation.getPosition();d&&t.HsMapService.getMap().getView().setCenter(d)}t.cancelClick=!1,t.clicked=!1},500)})()}stopLocalization(){this.localization=!1,this.HsMapService.getMap().removeLayer(this.position_layer),this.stopTracking(),this.trackOrientation&&this.toggleOrientation()}startLocalization(){this.localization||(this.geolocation.setTracking(!0),this.localization=!0,this.geolocation.once("change:position",()=>{this.setNewPosition(),this.HsMapService.getMap().getView().setCenter(this.geolocation.getPosition()),this.HsMapService.getMap().addLayer(this.position_layer),this.position_layer.setZIndex(99),this.geolocation.setTracking(!1)}))}isCentered(){return JSON.stringify(this.HsMapService.getMap().getView().getCenter())===JSON.stringify(this.positionFeature.getGeometry().getCoordinates())}setNewPosition(){const t=this.geolocation.getPosition();this.positionFeature.getGeometry().setCoordinates(t),this.accuracyFeature.getGeometry().setCenterAndRadius(t,this.geolocation.getAccuracy()),this.HsMapService.getMap().getView().setCenter(t)}toggleOrientation(){this.trackOrientation=!this.trackOrientation,this.HsLayoutService.contentWrapper.querySelector("button.ol-rotate").classList.toggle("active"),this.trackOrientation?(this.getRotate().element.classList.remove("hidden"),this.orientationListener=this.handleOrientation.bind(this),window.addEventListener("deviceorientation",this.orientationListener)):(window.removeEventListener("deviceorientation",this.orientationListener),this.HsMapService.getMap().getView().setRotation(0))}handleOrientation(t){const d=t.alpha??0;this.HsMapService.getMap().getView().setRotation((360-d)*(Math.PI/180))}getRotate(){for(const t of this.HsMapService.getMap().getControls().getArray())if(t instanceof S.A)return t}setAccuracyFeature(){this.accuracyFeature=new R.default({known:!1,geometry:new o.A([0,0],1)})}setPositionFeature(){this.positionFeature=new R.default({known:!1,geometry:new s.default([0,0])})}setStyle(){this.style=new E.default({image:new C.default({fill:new O.default({color:[242,121,0,.7]}),stroke:new G.default({color:[187,51,51,.7]}),radius:5}),fill:new O.default({color:[187,187,187,.2]}),stroke:new G.default({color:[102,102,0,.8]})})}static#t=this.\u0275fac=function(d){return new(d||c)(e.KVO(F.F),e.KVO(b.F),e.KVO(w.r),e.KVO(D.MJ))};static#e=this.\u0275prov=e.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();var A=i(60316),U=i(31968);const V=c=>({"ol-collapsed":c});function Y(c,a){if(1&c){const t=e.RV6();e.j41(0,"button",3),e.nI1(1,"translateHs"),e.bIt("click",function(){e.eBV(t);const g=e.XpG();return e.Njj(g.startLocalization())}),e.nrm(2,"i",4),e.k0s()}2&c&&e.Y8G("title",e.bMT(1,1,"GEOLOCATION.locateMe"))}function x(c,a){if(1&c){const t=e.RV6();e.j41(0,"button",5),e.nI1(1,"translateHs"),e.bIt("click",function(){e.eBV(t);const g=e.XpG();return e.Njj(g.toggleTracking())})("dblclick",function(){e.eBV(t);const g=e.XpG();return e.Njj(g.stopLocalization())}),e.nrm(2,"i",6),e.k0s()}if(2&c){const t=e.XpG();e.Y8G("title",e.bMT(1,2,"GEOLOCATION.locateMe")),e.R7$(2),e.Y8G("ngClass",t.isFollowing()&&t.getLocalization()?"icon-navigation":"icon-gpson")}}let z=(()=>{class c extends v.Bh{constructor(t){super(),this.hsGeolocationService=t,this.name="geolocationButton"}ngOnInit(){this.collapsed=!0,super.ngOnInit()}isVisible(){return this.hsLayoutService.componentEnabled("geolocationButton")&&this.hsLayoutService.componentEnabled("guiOverlay")}startLocalization(){this.hsGeolocationService.startLocalization()}stopLocalization(){this.hsGeolocationService.stopLocalization()}getLocalization(){return this.hsGeolocationService.localization}toggleTracking(){this.hsGeolocationService.toggleTracking()}isFollowing(){return this.hsGeolocationService.following}static#t=this.\u0275fac=function(d){return new(d||c)(e.rXU(P))};static#e=this.\u0275cmp=e.VBU({type:c,selectors:[["hs-geolocation"]],features:[e.Vt3],decls:4,vars:8,consts:[[1,"hs-locate","ol-unselectable","ol-control","hs-locateToggler",3,"hidden","ngClass"],["class","ol-has-tooltip blocate hs-locateToggler","type","button",3,"title","click",4,"ngIf"],["class","ol-has-tooltip blocate hs-locateToggler hs-locationButton","type","button",3,"title","click","dblclick",4,"ngIf"],["type","button",1,"ol-has-tooltip","blocate","hs-locateToggler",3,"click","title"],[1,"glyphicon","icon-gpsoff-gps","hs-locateToggler"],["type","button",1,"ol-has-tooltip","blocate","hs-locateToggler","hs-locationButton",3,"click","dblclick","title"],[1,"glyphicon","hs-locateToggler",3,"ngClass"]],template:function(d,g){1&d&&(e.j41(0,"div",0),e.nI1(1,"async"),e.DNE(2,Y,3,3,"button",1)(3,x,3,4,"button",2),e.k0s()),2&d&&(e.Y8G("hidden",!1===e.bMT(1,4,g.isVisible$))("ngClass",e.eq3(6,V,g.collapsed)),e.R7$(2),e.Y8G("ngIf",!g.getLocalization()),e.R7$(),e.Y8G("ngIf",g.getLocalization()))},dependencies:[A.YU,A.bT,A.Jj,U.q],encapsulation:2})}return c})();var K=i(34456);let B=(()=>{class c{static#t=this.\u0275fac=function(d){return new(d||c)};static#e=this.\u0275mod=e.$C({type:c});static#i=this.\u0275inj=e.G2t({imports:[K.YN,A.MD,v.Zz]})}return c})()},29100:(L,T,i)=>{i.d(T,{A:()=>O});var v=i(40090),e=i(84505),m=i(94695),E=i(97920);class C extends v.Ay{constructor(o,s,n){super(),void 0!==n&&void 0===s?this.setFlatCoordinates(n,o):this.setCenterAndRadius(o,s=s||0,n)}clone(){const o=new C(this.flatCoordinates.slice(),void 0,this.layout);return o.applyProperties(this),o}closestPointXY(o,s,n,l){const h=this.flatCoordinates,u=o-h[0],p=s-h[1],r=u*u+p*p;if(r<l){if(0===r)for(let f=0;f<this.stride;++f)n[f]=h[f];else{const f=this.getRadius()/Math.sqrt(r);n[0]=h[0]+f*u,n[1]=h[1]+f*p;for(let y=2;y<this.stride;++y)n[y]=h[y]}return n.length=this.stride,r}return l}containsXY(o,s){const n=this.flatCoordinates,l=o-n[0],h=s-n[1];return l*l+h*h<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(o){const s=this.flatCoordinates,n=s[this.stride]-s[0];return(0,e.createOrUpdate)(s[0]-n,s[1]-n,s[0]+n,s[1]+n,o)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const o=this.flatCoordinates[this.stride]-this.flatCoordinates[0],s=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return o*o+s*s}getType(){return"Circle"}intersectsExtent(o){const s=this.getExtent();if((0,e.intersects)(o,s)){const n=this.getCenter();return o[0]<=n[0]&&o[2]>=n[0]||o[1]<=n[1]&&o[3]>=n[1]||(0,e.forEachCorner)(o,this.intersectsCoordinate.bind(this))}return!1}setCenter(o){const s=this.stride,n=this.flatCoordinates[s]-this.flatCoordinates[0],l=o.slice();l[s]=l[0]+n;for(let h=1;h<s;++h)l[s+h]=o[h];this.setFlatCoordinates(this.layout,l),this.changed()}setCenterAndRadius(o,s,n){this.setLayout(n,o,0),this.flatCoordinates||(this.flatCoordinates=[]);const l=this.flatCoordinates;let h=(0,m._n)(l,0,o,this.stride);l[h++]=l[0]+s;for(let u=1,p=this.stride;u<p;++u)l[h++]=l[u];l.length=h,this.changed()}getCoordinates(){return null}setCoordinates(o,s){}setRadius(o){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+o,this.changed()}rotate(o,s){const n=this.getCenter(),l=this.getStride();this.setCenter((0,E.e$)(n,0,n.length,l,o,s,n)),this.changed()}}const O=C}}]);
//# sourceMappingURL=132.js.map