"use strict";(self.webpackChunkhslayers_cesium_app=self.webpackChunkhslayers_cesium_app||[]).push([[817],{72817:(z,v,i)=>{i.r(v),i.d(v,{HsMeasureComponent:()=>x,HsMeasureModule:()=>N,HsMeasureService:()=>S,HsMeasureToolbarComponent:()=>$});var b=i(84205),p=i(33900),d=i(25849),e=i(7404),g=i(22187),C=i(36758),H=i(29814),I=i(18194),E=i(1963),j=i(93812),T=i(76983),V=i(53848),R=i(60411),L=i(88716),F=i(14608),f=i(27426);let S=(()=>{class a{constructor(t,s,n){this.hsMapService=t,this.HsUtilsService=s,this.HsEventBusService=n,this.data={measurements:[],multipleShapeMode:!1},this.sketches=[],this.measuringActivated=!1,this.setMeasureLayer(),(0,L.D6)(this.measureVector,"Measurement sketches")}switchMultipleMode(t){this.data.multipleShapeMode=void 0!==t?t:!this.data.multipleShapeMode}setMeasureLayer(){this.measureVector=new V.A({source:new R.A,style:new H.default({fill:new I.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new E.default({color:"#ffcc33",width:2})})})}changeMeasureParams(t){this.hsMapService.getMap().removeInteraction(this.draw),this.sketches=[],this.addInteraction(t)}clearMeasurement(){this.draw.setActive(!1),this.data.measurements=[],this.measureVector.getSource().clear(),this.sketches=[],this.draw.setActive(!0)}activateMeasuring(t){if(this.measuringActivated)return;const s=this.hsMapService.getMap();s?(s.addLayer(this.measureVector),s.getViewport().addEventListener("mousemove",n=>{this.mouseMoveHandler(n)}),s.getViewport().addEventListener("touchmove",n=>{this.mouseMoveHandler(n)}),s.getViewport().addEventListener("touchend",n=>{this.mouseMoveHandler(n)}),this.addInteraction(t),this.measuringActivated=!0):setTimeout(()=>{this.activateMeasuring(t)},500)}deactivateMeasuring(){this.hsMapService.loaded().then(t=>{t.getViewport().removeEventListener("mousemove",s=>{this.mouseMoveHandler(s)}),t.getViewport().removeEventListener("touchmove",s=>{this.mouseMoveHandler(s)}),t.getViewport().removeEventListener("touchend",s=>{this.mouseMoveHandler(s)}),t.removeInteraction(this.draw),t.removeLayer(this.measureVector)}),this.measuringActivated=!1,this.HsEventBusService.measurementEnds.next()}mouseMoveHandler(t){if(this.sketches.length>0){let s;for(const n of this.sketches){const r=n.getGeometry();this.HsUtilsService.instOf(r,j.default)?s=this.addMultiple(this.HsUtilsService.formatArea(r,this.hsMapService.getCurrentProj()),s):this.HsUtilsService.instOf(r,T.default)&&(s=this.addMultiple(this.HsUtilsService.formatLength(r,this.hsMapService.getCurrentProj()),s))}setTimeout(()=>{this.data.measurements[this.lastMeasurementId]=s},0)}}addMultiple(t,s){if(null==s)return t;let n=t.unit;const r=t.type;let o;if(t.unit==s.unit)o=Math.round(100*(t.size+s.size))/100,"m"==n&&"length"==r&&o>1e3?(o=Math.round(o/1e3*100)/100,n="km"):"m"==n&&"area"==r&&o>1e4&&(o=Math.round(o/1e6*100)/100,n="km");else{const l=[t,s];for(let c=0;c<l.length;c++)"m"==l[c].unit&&(l[c].size/="length"==r?1e3:1e6);o=Math.round(100*(l[0].size+l[1].size))/100,n="km"}return{size:o,type:r,unit:n}}addInteraction(t){const s="area"==t?"Polygon":"LineString";this.draw=new C.Ay({source:this.measureVector.getSource(),type:s,dragVertexDelay:150}),this.hsMapService.getMap().addInteraction(this.draw),this.draw.on("drawstart",n=>{this.HsEventBusService.measurementStarts.next(),this.data.multipleShapeMode?(Array.isArray(this.sketches)||(this.sketches=[],this.data.measurements.push({size:0,unit:""})),this.sketches.push(n.feature)):(this.sketches=[n.feature],this.data.measurements.push({size:0,unit:""})),this.lastMeasurementId=this.data.measurements.length-1}),this.draw.on("drawend",n=>{this.HsEventBusService.measurementEnds.next()})}static#e=this.\u0275fac=function(s){return new(s||a)(e.KVO(F.F),e.KVO(f.MJ),e.KVO(g.z))};static#t=this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var u=i(60316),h=i(34456),B=i(70258),y=i(31968);const m=a=>({active:a});function O(a,M){1&a&&(e.j41(0,"span")(1,"sup"),e.EFF(2,"2"),e.k0s()())}function G(a,M){if(1&a&&(e.j41(0,"li",18),e.EFF(1),e.DNE(2,O,3,0,"span",19),e.k0s()),2&a){const t=M.$implicit;e.R7$(),e.Lme(" ",null==t?null:t.size,"\xa0",null==t?null:t.unit,""),e.R7$(),e.Y8G("ngIf","Area"===(null==t?null:t.type))}}function k(a,M){if(1&a){const t=e.RV6();e.j41(0,"div",1),e.nrm(1,"hs-panel-header",2),e.j41(2,"div",3)(3,"div",4),e.EFF(4),e.nI1(5,"translateHs"),e.j41(6,"div",5)(7,"label",6),e.EFF(8),e.nI1(9,"translateHs"),e.nI1(10,"uppercase"),e.j41(11,"input",7),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.hsMeasureService.data.multipleShapeMode,n)||(r.hsMeasureService.data.multipleShapeMode=n),e.Njj(n)}),e.k0s()(),e.j41(12,"label",8),e.EFF(13),e.nI1(14,"translateHs"),e.nI1(15,"uppercase"),e.j41(16,"input",9),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.hsMeasureService.data.multipleShapeMode,n)||(r.hsMeasureService.data.multipleShapeMode=n),e.Njj(n)}),e.k0s()()()(),e.j41(17,"div",10)(18,"label",11),e.EFF(19),e.nI1(20,"translateHs"),e.j41(21,"input",12),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.type,n)||(r.type=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.changeMeasureParams())}),e.k0s()(),e.j41(22,"label",13),e.EFF(23),e.nI1(24,"translateHs"),e.j41(25,"input",14),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.type,n)||(r.type=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.changeMeasureParams())}),e.k0s()()(),e.j41(26,"button",15),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.clearAll())}),e.EFF(27),e.nI1(28,"translateHs"),e.k0s(),e.j41(29,"ul",16),e.DNE(30,G,3,3,"li",17),e.k0s()()()}if(2&a){const t=e.XpG();e.R7$(),e.Y8G("panelTabs","MEASURE"),e.R7$(3),e.SpI(" ",e.bMT(5,18,"MEASURE.multipleShapes")," "),e.R7$(3),e.Y8G("ngClass",e.eq3(34,m,!0===t.hsMeasureService.data.multipleShapeMode)),e.R7$(),e.SpI(" ",e.bMT(10,22,e.bMT(9,20,"COMMON.on"))," "),e.R7$(3),e.Y8G("value",!0),e.R50("ngModel",t.hsMeasureService.data.multipleShapeMode),e.R7$(),e.Y8G("ngClass",e.eq3(36,m,!1===t.hsMeasureService.data.multipleShapeMode)),e.R7$(),e.SpI(" ",e.bMT(15,26,e.bMT(14,24,"COMMON.off"))," "),e.R7$(3),e.Y8G("value",!1),e.R50("ngModel",t.hsMeasureService.data.multipleShapeMode),e.R7$(2),e.Y8G("ngClass",e.eq3(38,m,"distance"===t.type)),e.R7$(),e.SpI(" ",e.bMT(20,28,"COMMON.distance")," "),e.R7$(2),e.R50("ngModel",t.type),e.R7$(),e.Y8G("ngClass",e.eq3(40,m,"area"===t.type)),e.R7$(),e.SpI(" ",e.bMT(24,30,"COMMON.area")," "),e.R7$(2),e.R50("ngModel",t.type),e.R7$(2),e.JRh(e.bMT(28,32,"COMMON.clear")),e.R7$(3),e.Y8G("ngForOf",t.hsMeasureService.data.measurements)}}let x=(()=>{class a extends d.aH{constructor(t,s,n){super(),this.hsEventBusService=t,this.hsMeasureService=s,this.hsUtilsService=n,this.name="measure",this.end=new b.B}ngOnDestroy(){this.end.next(),this.end.complete()}ngOnInit(){super.ngOnInit(),this.type="distance",this.hsUtilsService.runningInBrowser()&&document.addEventListener("keyup",t=>{"Control"==t.key&&setTimeout(()=>{this.hsMeasureService.switchMultipleMode()},0)}),this.hsEventBusService.measurementStarts.pipe((0,p.Q)(this.end)).subscribe(()=>{this.hsLayoutService.panelEnabled("toolbar",!1)}),this.hsEventBusService.measurementEnds.pipe((0,p.Q)(this.end)).subscribe(()=>{this.hsLayoutService.panelEnabled("toolbar",!0)}),this.hsLayoutService.mainpanel$.pipe((0,p.Q)(this.end)).subscribe(t=>{"measure"==this.hsLayoutService.mainpanel?this.hsMeasureService.activateMeasuring(this.type):this.hsMeasureService.deactivateMeasuring()}),"measure"==this.hsLayoutService.mainpanel&&this.hsMeasureService.activateMeasuring(this.type)}changeMeasureParams(){"measure"==this.hsLayoutService.mainpanel&&this.hsMeasureService.changeMeasureParams(this.type)}clearAll(){this.hsMeasureService.clearMeasurement()}static#e=this.\u0275fac=function(s){return new(s||a)(e.rXU(g.z),e.rXU(S),e.rXU(f.MJ))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["hs-measure"]],features:[e.Vt3],decls:2,vars:3,consts:[["class","card hs-main-panel",4,"ngIf"],[1,"card","hs-main-panel"],["name","measure",3,"panelTabs"],[1,"card-body","p-2"],[1,"mb-2"],[1,"btn-group","btn-group-toggle"],["for","hs-measure-multiple-true",1,"btn","btn-sm","btn-secondary",3,"ngClass"],["type","radio","name","multiple","id","hs-measure-multiple-true",3,"ngModelChange","value","ngModel"],["for","hs-measure-multiple-false",1,"btn","btn-sm","btn-secondary",3,"ngClass"],["type","radio","name","multiple","id","hs-measure-multiple-false",3,"ngModelChange","value","ngModel"],[1,"btn-group","btn-group-toggle","mb-2"],["for","hs-measure-distance",1,"btn","btn-secondary",3,"ngClass"],["type","radio","name","type","id","hs-measure-distance","value","distance",3,"ngModelChange","ngModel"],["for","hs-measure-area",1,"btn","btn-secondary",3,"ngClass"],["type","radio","name","type","id","hs-measure-area","value","area",3,"ngModelChange","ngModel"],[1,"btn","btn-secondary","float-end",3,"click"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[4,"ngIf"]],template:function(s,n){1&s&&(e.DNE(0,k,31,42,"div",0),e.nI1(1,"async")),2&s&&e.Y8G("ngIf",e.bMT(1,1,n.isVisible$))},dependencies:[u.YU,u.Sq,u.bT,h.me,h.Fm,h.BC,h.vS,B.k,u.Jj,u.Pc,y.q],encapsulation:2})}return a})();var A=i(56485);let N=(()=>{class a{static#e=this.\u0275fac=function(s){return new(s||a)};static#t=this.\u0275mod=e.$C({type:a});static#s=this.\u0275inj=e.G2t({imports:[u.MD,h.YN,d.Zz,A.zH,d.k4]})}return a})();var U=i(59452);let $=(()=>{class a extends d.Bh{constructor(){super(),this.name="measureToolbar"}measureButtonClicked(){this.hsLayoutService.setMainPanel("measure",!0)}componentEnabled(){return(0,U.of)(this.hsLayoutService.panelEnabled("measure")&&this.hsLayoutService.componentEnabled(this.name)&&this.hsLayoutService.componentEnabled("guiOverlay"))}static#e=this.\u0275fac=function(s){return new(s||a)};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["hs-measure-toolbar"]],features:[e.Vt3],decls:6,vars:6,consts:[[1,"nav-item",3,"hidden"],[1,"btn-group"],[1,"btn","rounded-0","hs-toolbar-button","btn-light","btn-outline-secondary",3,"click","title"],[1,"icon-design"]],template:function(s,n){1&s&&(e.j41(0,"div",0),e.nI1(1,"async"),e.j41(2,"div",1)(3,"button",2),e.nI1(4,"translateHs"),e.bIt("click",function(){return n.measureButtonClicked()}),e.nrm(5,"i",3),e.k0s()()()),2&s&&(e.Y8G("hidden",!1===e.bMT(1,2,n.isVisible$)),e.R7$(3),e.Y8G("title",e.bMT(4,4,"TOOLBAR.measureLinesAndPolygon")))},dependencies:[u.Jj,y.q],encapsulation:2})}return a})()}}]);
//# sourceMappingURL=817.js.map