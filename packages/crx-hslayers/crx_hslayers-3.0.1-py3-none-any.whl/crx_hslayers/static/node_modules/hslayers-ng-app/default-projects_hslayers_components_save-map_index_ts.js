"use strict";(self.webpackChunkhslayers_app=self.webpackChunkhslayers_app||[]).push([["default-projects_hslayers_components_save-map_index_ts"],{93640:(Oe,T,o)=>{o.r(T),o.d(T,{AdvancedOptionsComponent:()=>G,HsSaveMapAdvancedFormComponent:()=>$,HsSaveMapComponent:()=>Ce,HsSaveMapDialogSpawnerService:()=>V,HsSaveMapManagerParams:()=>H,HsSaveMapManagerService:()=>g,HsSaveMapModule:()=>ye,HsSaveMapResultDialogComponent:()=>x});var D=o(10467),e=o(93953),E=o(93108),v=o(21413),Y=o(84412),U=o(53993),r=o(89417),N=o(14608),b=o(25550),j=o(40736),B=o(21626),J=o(26907),k=o(24025),y=o(27426),L=o(22187),X=o(38243),P=o(6616);class H{constructor(){this.statusData={titleFree:void 0,hasPermission:void 0,success:void 0,changeTitle:void 0,groups:[]},this.currentComposition=void 0,this._access_rights={"access_rights.write":"private","access_rights.read":"EVERYONE"},this.compoData=new r.gE({name:new r.MJ("",{validators:r.k0.required,nonNullable:!0}),abstract:new r.MJ("",{validators:r.k0.required,nonNullable:!0}),workspace:new r.MJ(void 0),keywords:new r.MJ(""),id:new r.MJ(""),thumbnail:new r.MJ(void 0),access_rights:new r.MJ(this._access_rights)}),this.userData={},this.panelOpened=new v.B,this.saveMapResulted=new v.B,this.endpointSelected=new Y.t(null),this.preSaveCheckCompleted=new v.B,this.missingName=!1,this.missingAbstract=!1}}let g=(()=>{class a extends H{constructor(t,s,n,i,l,f,C,d,M,h,u){super(),this.hsMapService=t,this.hsSaveMapService=s,this.hsConfig=n,this.http=i,this.hsShareService=l,this.hsLaymanService=f,this.hsLayoutService=C,this.hsUtilsService=d,this.hsEventBusService=M,this.hsLogService=h,this.hsCompositionsParserService=u,this.hsCompositionsParserService.currentCompositionRecord.pipe((0,U.E)(this.hsEventBusService.compositionLoads)).subscribe(([R,F])=>{if(null==F.error){const S=F.data??F;this.currentComposition=S;const Ie=R.error?this.currentUser:this.parseAccessRights(R);this.compoData.patchValue({id:S.id,abstract:S.abstract,keywords:S.keywords,workspace:Ie,name:S.name,access_rights:this._access_rights})}}),this.hsLayoutService.mainpanel$.subscribe(R=>{("saveMap"==this.hsLayoutService.mainpanel||"statusCreator"==this.hsLayoutService.mainpanel)&&this.hsEventBusService.mapResets.subscribe(()=>{this.resetCompoData()})})}parseAccessRights(t){this.currentComposition.editable=!0;const s=t.url.match(/\/workspaces\/([^/]+)/)?t.url.match(/\/workspaces\/([^/]+)/)[1]:null,n=t.access_rights.write,i=t.access_rights.read;return this.currentUser===s?(this.privateOrPublic(n,"write",this.currentUser),this.privateOrPublic(i,"read",this.currentUser)):n.includes(this.currentUser)||2==n.length&&[s,"EVERYONE"].every(l=>n.includes(l))?(this.privateOrPublic(n,"write",s),this.privateOrPublic(i,"read",s)):(this._access_rights["access_rights.read"]="EVERYONE",this._access_rights["access_rights.write"]="private",this.currentComposition.editable=!1),s}privateOrPublic(t,s,n){const i=t.filter(l=>l!==n);this._access_rights[`access_rights.${s}`]=0===i.length?"private":1===i.length&&"EVERYONE"===i[0]?i[0]:t.join(",")}selectEndpoint(t){this.endpointSelected.next(t)}updateCompoDataName(t){this.compoData.controls.name.setValue(t)}save(t,s){return new Promise((n,i)=>{const l={};Object.assign(l,this.compoData.value);const f=this.generateCompositionJson();let C=this.hsShareService;s.type.includes("layman")&&(C=this.hsLaymanService),C.save(f,s,l,t).then(d=>{const M={},h=d;let u=!1;s.type.includes("layman")&&(u=t?1==h.length&&void 0!==h[0].uuid:void 0!==h.uuid),u?this.hsEventBusService.compositionLoads.next(M):s.type.includes("layman")&&"CONFLICT"==h.status&&(M.id=h[0].uuid,M.name=h[0].name),d.status=u,n(d)}).catch(d=>{i({status:!1,error:d})})})}generateCompositionJson(){return this.hsSaveMapService.map2json(this.hsMapService.getMap(),this.compoData.value,this.userData,this.statusData)}openPanel(t){this.hsLayoutService.setMainPanel("saveMap",!0),this.panelOpened.next({composition:t})}setUserDetails(t){const s=t.data;s&&1==s.success&&(s.userInfo&&(this.userData.contact.email=s.userInfo.email,this.userData.contact.phone=s.userInfo.phone,this.userData.contact.person=s.userInfo.firstName+" "+s.userInfo.lastName),s.userInfo&&s.userInfo.org&&(this.userData.organization.address=s.userInfo.org.street,this.userData.organization.country=s.userInfo.org.state,this.userData.organization.postalCode=s.userInfo.org.zip,this.userData.organization.city=s.userInfo.org.city,this.userData.organization.name=s.userInfo.org.name))}selectNewName(){this.updateCompoDataName(this.statusData.guessedTitle),this.changeTitle=!0}validateForm(){return this.missingName=!this.compoData.controls.name.value,this.missingAbstract=!this.compoData.controls.abstract.value,!!this.compoData.controls.name.value&&!!this.compoData.controls.abstract.value}resetCompoData(){this.compoData.patchValue({id:"",abstract:"",name:"",keywords:""}),this.currentComposition=void 0}initiateSave(t){var s=this;return(0,D.A)(function*(){if(s.compoData.valid)try{const n=yield s.save(t,s.endpointSelected.getValue());s.processSaveCallback(n)}catch(n){s.hsLogService.error(n),s.processSaveCallback(n)}else s.hsLogService.log("validationfailed")})()}processSaveCallback(t){if(this.statusData.status=t.status,t.status)this.statusData.resultCode="success",this.hsLayoutService.setMainPanel("layerManager",!0);else{const s=t.error;24==s.code?(this.statusData.overWriteNeeded=!0,this.updateCompoDataName(s.detail.mapname),this.statusData.resultCode="exists"):this.statusData.resultCode=32==s.code?"not-saved":"error",this.statusData.error=s}this.saveMapResulted.next(this.statusData)}focusTitle(){this.statusData.guessedTitle&&this.updateCompoDataName(this.statusData.guessedTitle),this.hsLayoutService.contentWrapper.querySelector(".hs-stc-title").focus()}static#e=this.\u0275fac=function(s){return new(s||a)(e.KVO(N.F),e.KVO(b.qY),e.KVO(j.Q),e.KVO(B.Qq),e.KVO(J.HsShareService),e.KVO(b.fr),e.KVO(k.F),e.KVO(y.MJ),e.KVO(L.z),e.KVO(X.r),e.KVO(P.r))};static#t=this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var p=o(60177),_=o(31968);const z=()=>({module:"SAVECOMPOSITION.dialogResult"}),K=a=>({"justify-content-between":a});function Q(a,c){1&a&&(e.j41(0,"div",13),e.nrm(1,"div",14),e.k0s())}function W(a,c){1&a&&(e.j41(0,"div",18),e.EFF(1),e.nI1(2,"translateHs"),e.k0s()),2&a&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"SAVECOMPOSITION.dialogResult.requestWasProcessed")," "))}function Z(a,c){1&a&&(e.j41(0,"div",18),e.EFF(1),e.nI1(2,"translateHs"),e.k0s()),2&a&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"SAVECOMPOSITION.dialogResult.serverDidNotRespond")," "))}function q(a,c){if(1&a&&(e.j41(0,"div",16),e.DNE(1,W,3,3,"div",17)(2,Z,3,3,"div",17),e.j41(3,"div",18)(4,"dl")(5,"dd",19),e.EFF(6),e.k0s()()()()),2&a){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf","not-saved"===t.hsSaveMapManagerService.statusData.resultCode),e.R7$(),e.Y8G("ngIf","error"===t.hsSaveMapManagerService.statusData.resultCode),e.R7$(4),e.SpI(" ",t.hsSaveMapManagerService.statusData.error.message," ")}}function ee(a,c){if(1&a&&e.DNE(0,q,7,3,"div",15),2&a){const t=e.XpG(),s=e.sdS(13);e.Y8G("ngIf",!t.hsSaveMapManagerService.statusData.status)("ngIfElse",s)}}function te(a,c){1&a&&(e.j41(0,"div",20),e.EFF(1),e.nI1(2,"translateHs"),e.k0s()),2&a&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"SAVECOMPOSITION.dialogResult.success")," "))}function se(a,c){if(1&a){const t=e.RV6();e.j41(0,"div")(1,"button",21),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.initiateSave(!1))}),e.EFF(2),e.nI1(3,"translateHs"),e.k0s(),e.j41(4,"button",22),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.changeName())}),e.EFF(5),e.nI1(6,"translateHs"),e.k0s()()}2&a&&(e.R7$(2),e.SpI(" ",e.bMT(3,2,"SAVECOMPOSITION.form.overwrite")," "),e.R7$(3),e.SpI(" ",e.bMT(6,4,"SAVECOMPOSITION.form.changeName")," "))}let x=(()=>{class a{constructor(t,s){this.hsDialogContainerService=t,this.hsSaveMapManagerService=s,this.data={},this.saving=!1}close(){this.hsDialogContainerService.destroy(this)}initiateSave(t){var s=this;return(0,D.A)(function*(){s.saving=!0,s.hsSaveMapManagerService.compoData.patchValue({workspace:s.hsSaveMapManagerService.currentUser}),yield s.hsSaveMapManagerService.initiateSave(t),s.saving=!1,s.close()})()}changeName(){this.hsSaveMapManagerService.saveMapResulted.next("rename"),this.close()}static#e=this.\u0275fac=function(s){return new(s||a)(e.rXU(E.oE),e.rXU(g))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["hs-save-map-dialog-result"]],decls:23,vars:22,consts:[["status",""],["success",""],["tabindex","-1","role","dialog","aria-hidden","true",1,"modal","hs-status-creator-result-dialog","in"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-dismiss","modal",1,"btn-close",3,"click"],["class","align-items-center d-flex flex-column justify-content-center p-4",4,"ngIf","ngIfElse"],[1,"modal-footer",3,"ngClass"],[4,"ngIf"],["type","button","data-dismiss","modal",1,"btn","btn-primary",3,"click"],[3,"hidden"],[1,"align-items-center","d-flex","flex-column","justify-content-center","p-4"],[1,"hs-loader","hs-loader-dark"],["class","modal-body","style","max-height: 600px; overflow-y: auto",4,"ngIf","ngIfElse"],[1,"modal-body",2,"max-height","600px","overflow-y","auto"],["class","alert alert-danger",4,"ngIf"],[1,"alert","alert-danger"],[1,"ps-1","my-2"],[1,"alert","alert-success","mx-2","my-4"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-primary","ms-2",3,"click"]],template:function(s,n){if(1&s){const i=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h4",6),e.EFF(5),e.nI1(6,"translateHs"),e.k0s(),e.j41(7,"button",7),e.nI1(8,"translateHs"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.close())}),e.k0s()(),e.DNE(9,Q,2,0,"div",8)(10,ee,1,2,"ng-template",null,0,e.C5r)(12,te,3,3,"ng-template",null,1,e.C5r),e.j41(14,"div",9),e.DNE(15,se,7,6,"div",10),e.j41(16,"button",11),e.bIt("click",function(){return e.eBV(i),e.Njj(n.close())}),e.j41(17,"span",12),e.EFF(18),e.nI1(19,"translateHs"),e.k0s(),e.j41(20,"span",12),e.EFF(21),e.nI1(22,"translateHs"),e.k0s()()()()()()}if(2&s){const i=e.sdS(11);e.R7$(5),e.SpI(" ",e.i5U(6,10,n.hsSaveMapManagerService.statusData.status?"success":"error",e.lJ4(19,z))," "),e.R7$(2),e.BMQ("aria-label",e.bMT(8,13,"COMMON.close")),e.R7$(2),e.Y8G("ngIf",n.saving)("ngIfElse",i),e.R7$(5),e.Y8G("ngClass",e.eq3(20,K,"exists"===n.hsSaveMapManagerService.statusData.resultCode&&!n.saving)),e.R7$(),e.Y8G("ngIf","exists"===n.hsSaveMapManagerService.statusData.resultCode&&!n.saving),e.R7$(2),e.Y8G("hidden",!n.saving),e.R7$(),e.SpI("",e.bMT(19,15,"COMMON.saving"),"..."),e.R7$(2),e.Y8G("hidden",n.saving),e.R7$(),e.JRh(e.bMT(22,17,"COMMON.close"))}},dependencies:[p.YU,p.bT,_.q],encapsulation:2})}return a})(),V=(()=>{class a{constructor(t,s){this.hsDialogContainerService=t,this.hsSaveMapManagerService=s,this.hsSaveMapManagerService.saveMapResulted.subscribe(n=>{"string"!=typeof n&&this.hsDialogContainerService.create(x,{statusData:n})})}static#e=this.\u0275fac=function(s){return new(s||a)(e.KVO(E.oE),e.KVO(g))};static#t=this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var ae=o(99172),ne=o(96354),m=o(56977),ie=o(73852),I=o(88716);const w=()=>({module:"LAYERS"});function re(a,c){if(1&a){const t=e.RV6();e.j41(0,"li",19)(1,"div",20)(2,"input",21),e.bIt("change",function(n){const i=e.eBV(t).$implicit,l=e.XpG();return e.Njj(l.onChecklistChange(n.target.checked,i))}),e.k0s(),e.j41(3,"label",22),e.nI1(4,"translateHs"),e.EFF(5),e.nI1(6,"translateHs"),e.k0s()()()}if(2&a){const t=c.$implicit,s=c.index;e.R7$(2),e.Mz_("name","hs-stclayer-",s,""),e.Y8G("value",t.layer)("checked",t.checked),e.R7$(),e.Mz_("for","hs-stclayer-",s,""),e.Y8G("title",e.i5U(4,8,t.title,e.lJ4(14,w))),e.R7$(2),e.JRh(e.i5U(6,11,t.title,e.lJ4(15,w)))}}let G=(()=>{class a{constructor(t,s,n,i,l){this.parentContainer=t,this.fb=s,this.hsMapService=n,this.hsUtilsService=i,this.hsSaveMapService=l,this.btnSelectDeselectClicked=!0,this.postCompose=this.hsUtilsService.debounce(()=>{this.setCurrentBoundingBox(),this.hsSaveMapService.generateThumbnail(this.thumbnail)},1e3,!1,this),this.visible=!1}get parentFormGroup(){return this.parentContainer.control}ngOnInit(){this.fillCompositionLayers(),this.parentFormGroup.addControl("bbox",new r.gE({east:new r.MJ(0),south:new r.MJ(0),west:new r.MJ(0),north:new r.MJ(0)})),this.setCurrentBoundingBox(),this.hsSaveMapService.generateThumbnail(this.thumbnail),this.parentFormGroup.addControl("layers",new r.MJ(this.flattenValues())),this.hsMapService.getMap().on("postcompose",this.postCompose)}ngOnDestroy(){this.parentFormGroup.removeControl("bbox"),this.parentFormGroup.removeControl("layers"),this.hsMapService.getMap().un("postcompose",this.postCompose)}setCurrentBoundingBox(){this.parentFormGroup.patchValue({bbox:this.hsMapService.describeExtent()})}onChecklistChange(t,s){s.checked=t,this.parentFormGroup.get("layers").setValue(this.flattenValues())}flattenValues(){return this.layers.filter(t=>t.checked).map(t=>t.layer)}fillCompositionLayers(){this.layers=this.hsMapService.getMap().getLayers().getArray().filter(t=>null==(0,I.lg)(t)||1==(0,I.lg)(t)).map(t=>({title:(0,I.LK)(t),checked:this.btnSelectDeselectClicked,layer:t})).sort((t,s)=>t.layer.getZIndex()-s.layer.getZIndex())}toggleLayers(){this.btnSelectDeselectClicked=!this.btnSelectDeselectClicked,this.layers=this.layers.map(t=>({...t,checked:this.btnSelectDeselectClicked})),this.parentFormGroup.get("layers").setValue(this.flattenValues())}static#e=this.\u0275fac=function(s){return new(s||a)(e.rXU(r.ZU),e.rXU(r.ok),e.rXU(N.F),e.rXU(y.MJ),e.rXU(b.qY))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["hs-save-map-advanced-options"]],inputs:{thumbnail:"thumbnail"},features:[e.Jv_([],[{provide:r.ZU,useFactory:()=>(0,e.WQX)(r.ZU,{skipSelf:!0})}])],decls:38,vars:32,consts:[[1,"form"],[3,"formGroup"],[1,"d-flex","w-100","pb-2","stc-extent-row"],[1,"form-floating","px-0"],["type","text","formControlName","east","id","floatingEast",1,"form-control",3,"title"],["for","floatingEast"],["type","text","formControlName","south","id","floatingSouth",1,"form-control",3,"title"],["for","floatingSouth"],["type","text","formControlName","west","id","floatingWest",1,"form-control",3,"title"],["for","floatingWest"],["type","text","formControlName","north","id","floatingNorth",1,"form-control",3,"title"],["for","floatingNorth"],["type","button",1,"mt-1","btn","btn-secondary","w-100",3,"click"],[1,"form-group"],["id","stc-layerlist",1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item",2,"padding","3px"],[1,"d-flex","w-100","justify-content-center"],["type","button",1,"mt-1","btn","btn-primary",3,"click"],[1,"list-group-item"],[1,"form-check","text-truncate"],["type","checkbox",1,"form-check-input","mt-0",3,"change","value","name","checked"],[1,"form-check-label","mw-100","text-truncate",3,"for","title"]],template:function(s,n){1&s&&(e.j41(0,"fieldset",0)(1,"div",1)(2,"div",2)(3,"div",3),e.nrm(4,"input",4),e.nI1(5,"translateHs"),e.j41(6,"label",5),e.EFF(7),e.nI1(8,"translateHs"),e.k0s()(),e.j41(9,"div",3),e.nrm(10,"input",6),e.nI1(11,"translateHs"),e.j41(12,"label",7),e.EFF(13),e.nI1(14,"translateHs"),e.k0s()(),e.j41(15,"div",3),e.nrm(16,"input",8),e.nI1(17,"translateHs"),e.j41(18,"label",9),e.EFF(19),e.nI1(20,"translateHs"),e.k0s()(),e.j41(21,"div",3),e.nrm(22,"input",10),e.nI1(23,"translateHs"),e.j41(24,"label",11),e.EFF(25),e.nI1(26,"translateHs"),e.k0s()()(),e.j41(27,"button",12),e.bIt("click",function(){return n.setCurrentBoundingBox()}),e.EFF(28),e.nI1(29,"translateHs"),e.k0s()(),e.j41(30,"div",13)(31,"ul",14),e.DNE(32,re,7,16,"li",15),e.j41(33,"li",16)(34,"div",17)(35,"button",18),e.bIt("click",function(){return n.toggleLayers()}),e.EFF(36),e.nI1(37,"translateHs"),e.k0s()()()()()()),2&s&&(e.R7$(),e.Y8G("formGroup",n.parentFormGroup.controls.bbox),e.R7$(3),e.Y8G("title",e.bMT(5,12,"COMMON.east")),e.R7$(3),e.JRh(e.bMT(8,14,"COMMON.east")),e.R7$(3),e.Y8G("title",e.bMT(11,16,"COMMON.south")),e.R7$(3),e.JRh(e.bMT(14,18,"COMMON.south")),e.R7$(3),e.Y8G("title",e.bMT(17,20,"COMMON.west")),e.R7$(3),e.JRh(e.bMT(20,22,"COMMON.west")),e.R7$(3),e.Y8G("title",e.bMT(23,24,"COMMON.north")),e.R7$(3),e.JRh(e.bMT(26,26,"COMMON.north")),e.R7$(3),e.JRh(e.bMT(29,28,"SAVECOMPOSITION.form.userCurrentMapExtent")),e.R7$(4),e.Y8G("ngForOf",n.layers),e.R7$(4),e.JRh(e.bMT(37,30,"SAVECOMPOSITION.form.toggleAll")))},dependencies:[p.Sq,r.me,r.BC,r.cb,r.j4,r.JD,_.q],encapsulation:2})}return a})();const oe=a=>({canBeOverwritten:a});function ce(a,c){if(1&a){const t=e.RV6();e.j41(0,"hs-layman-access-rights",18),e.mxI("access_rightsChange",function(n){e.eBV(t);const i=e.XpG(2);return e.DH7(i.hsSaveMapManagerService._access_rights,n)||(i.hsSaveMapManagerService._access_rights=n),e.Njj(n)}),e.bIt("access_rights_changed",function(n){e.eBV(t);const i=e.XpG(2);return e.Njj(i.setAccessRights(n))}),e.k0s()}if(2&a){const t=e.XpG(2);e.Y8G("collapsed",!0),e.R50("access_rights",t.hsSaveMapManagerService._access_rights)}}function le(a,c){1&a&&(e.j41(0,"div",27),e.EFF(1),e.nI1(2,"translateHs"),e.k0s()),2&a&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"SAVECOMPOSITION.saveOrOverwrite")," "))}function pe(a,c){if(1&a){const t=e.RV6();e.j41(0,"button",28),e.bIt("click",function(){e.eBV(t);const n=e.XpG(3);return e.Njj(n.initiateSave(!1))}),e.EFF(1),e.nI1(2,"translateHs"),e.j41(3,"span",29),e.nI1(4,"translateHs"),e.EFF(5," i "),e.k0s()()}2&a&&(e.R7$(),e.SpI("",e.bMT(2,2,"SAVECOMPOSITION.form.overwrite")," "),e.R7$(2),e.Y8G("title",e.bMT(4,4,"SAVECOMPOSITION.form.overwrite")))}function he(a,c){1&a&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translateHs"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"COMMON.asNew")))}function de(a,c){if(1&a){const t=e.RV6();e.j41(0,"div",19),e.DNE(1,le,3,3,"div",20),e.j41(2,"div",21),e.DNE(3,pe,6,6,"button",22),e.j41(4,"div",23)(5,"button",24),e.EFF(6),e.nI1(7,"translateHs"),e.DNE(8,he,3,3,"span",25),e.k0s(),e.j41(9,"a",26),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.saveCompoJson())}),e.EFF(10),e.nI1(11,"translateHs"),e.k0s()()()()}if(2&a){const t=c.ngIf,s=e.XpG(2);e.R7$(),e.Y8G("ngIf",t.canBeOverwritten),e.R7$(),e.AVh("justify-content-between",t.canBeOverwritten),e.R7$(),e.Y8G("ngIf",t.canBeOverwritten),e.R7$(2),e.Y8G("hidden",!s.isAllowed()),e.R7$(),e.SpI("",e.bMT(7,8,"COMMON.save")," "),e.R7$(2),e.Y8G("ngIf",t.canBeOverwritten),e.R7$(2),e.JRh(e.bMT(11,10,"COMMON.download"))}}function me(a,c){if(1&a){const t=e.RV6();e.j41(0,"form",3,0),e.bIt("ngSubmit",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.initiateSave(!0))}),e.j41(2,"div",4),e.nrm(3,"input",5),e.nI1(4,"translateHs"),e.j41(5,"label",6),e.EFF(6),e.nI1(7,"translateHs"),e.k0s()(),e.j41(8,"div",4),e.nrm(9,"textarea",7),e.nI1(10,"translateHs"),e.j41(11,"label",8),e.EFF(12),e.nI1(13,"translateHs"),e.k0s()(),e.j41(14,"div",4),e.nrm(15,"input",9),e.nI1(16,"translateHs"),e.j41(17,"label",10),e.EFF(18),e.nI1(19,"translateHs"),e.k0s()(),e.j41(20,"label",11),e.EFF(21),e.nI1(22,"translateHs"),e.nrm(23,"img",12,1),e.nI1(25,"translateHs"),e.k0s(),e.DNE(26,ce,1,2,"hs-layman-access-rights",13),e.j41(27,"div",14)(28,"button",15),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.setExtraFormTo("advancedOptions"))}),e.EFF(29),e.nI1(30,"translateHs"),e.k0s()(),e.nrm(31,"hs-save-map-advanced-options",16),e.DNE(32,de,12,12,"div",17),e.k0s()}if(2&a){const t=e.sdS(1),s=e.sdS(24),n=e.XpG();e.Y8G("formGroup",n.hsSaveMapManagerService.compoData),e.R7$(3),e.AVh("is-invalid",n.hsSaveMapManagerService.compoData.controls.name.invalid&&t.submitted),e.Y8G("placeholder",e.bMT(4,18,"COMMON.name")),e.R7$(3),e.SpI("",e.bMT(7,20,"COMMON.name")," *"),e.R7$(3),e.AVh("is-invalid",n.hsSaveMapManagerService.compoData.controls.abstract.invalid&&t.submitted),e.Y8G("placeholder",e.bMT(10,22,"COMMON.abstract")),e.R7$(3),e.SpI("",e.bMT(13,24,"COMMON.abstract")," *"),e.R7$(3),e.Y8G("placeholder",e.bMT(16,26,"COMMON.keywords")),e.R7$(3),e.JRh(e.bMT(19,28,"COMMON.keywords")),e.R7$(3),e.SpI("",e.bMT(22,30,"COMMON.thumbnail")," "),e.R7$(2),e.Y8G("alt",e.bMT(25,32,"SAVECOMPOSITION.compositionThumbnail")),e.R7$(3),e.Y8G("ngIf",null==n.endpoint?null:n.endpoint.type.includes("layman")),e.R7$(3),e.JRh(e.bMT(30,34,"COMMON.advancedOptions")),e.R7$(2),e.Y8G("thumbnail",s)("hidden","advancedOptions"!==n.extraFormOpened),e.R7$(),e.Y8G("ngIf",e.eq3(36,oe,n.canOverwrite()&&n.overwrite))}}let $=(()=>{class a{constructor(t,s,n){this.hsSaveMapManagerService=t,this.hsUtilsService=s,this.hsLayoutService=n,this.overwrite=!1,this.extraFormOpened="",this.end=new v.B,this.isVisible=this.hsLayoutService.mainpanel$.pipe((0,ae.Z)(this.hsLayoutService.mainpanel),(0,ne.T)(i=>"saveMap"===i))}ngOnInit(){this.hsSaveMapManagerService.endpointSelected.pipe((0,m.Q)(this.end)).subscribe(t=>{this.endpoint=t}),this.hsSaveMapManagerService.saveMapResulted.pipe((0,m.Q)(this.end)).subscribe(t=>{t.overWriteNeeded&&(this.overwrite=!0),"rename"==t&&this.hsLayoutService.layoutElement.querySelector('[name="hs-save-map-name"]').focus()}),this.hsSaveMapManagerService.compoData.controls.name.valueChanges.subscribe(t=>{this.overwrite=this.hsSaveMapManagerService.compoData.controls.workspace.value&&this.hsSaveMapManagerService.currentComposition?.name===t})}ngOnDestroy(){this.end.next(),this.end.complete()}setExtraFormTo(t){this.extraFormOpened=this.extraFormOpened===t?"":t}setAccessRights(t){this.hsSaveMapManagerService.compoData.patchValue({access_rights:t})}saveCompoJson(){const t=this.hsSaveMapManagerService.generateCompositionJson(),s=new Blob([JSON.stringify(t)],{type:"application/json"}),n=document.getElementById("stc-download"),i=URL.createObjectURL(s);n.href=i,n.download="composition",setTimeout(()=>{window.URL.revokeObjectURL(i)},0)}capitalizeFirstLetter(t){return this.hsUtilsService.capitalizeFirstLetter(t)}nameChanged(){this.overwrite=!1,this.hsSaveMapManagerService.missingName=!1}abstractChanged(){this.hsSaveMapManagerService.missingAbstract=!1}isAllowed(){return null!==this.endpoint&&(!!this.endpoint.type.includes("layman")||void 0)}initiateSave(t){const s=this.hsSaveMapManagerService.currentUser,n=this.hsSaveMapManagerService.compoData.get("workspace").value;if(0==t&&this.canOverwrite()&&s!==n){const i=this.hsSaveMapManagerService.compoData.get("access_rights");this.hsSaveMapManagerService.compoData.patchValue({access_rights:{...i.value,"access_rights.write":[n,s].join(",")}})}this.hsSaveMapManagerService.initiateSave(t)}canOverwrite(){return this.hsSaveMapManagerService.currentComposition?.editable}static#e=this.\u0275fac=function(s){return new(s||a)(e.rXU(g),e.rXU(y.MJ),e.rXU(k.F))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["hs-save-map-form"]],decls:2,vars:3,consts:[["compoForm","ngForm"],["compositionThumbnail",""],["class","form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"form",3,"ngSubmit","formGroup"],[1,"form-floating","mb-2"],["type","text","formControlName","name","name","hs-save-map-name",1,"form-control",3,"placeholder"],["for","hs-save-map-name"],["formControlName","abstract","name","hs-save-map-abstract",1,"form-control",3,"placeholder"],["for","hs-save-map-abstract"],["type","text","name","hs-save-map-keywords",1,"form-control",3,"placeholder"],["for","hs-save-map-keywords"],[1,"form-group"],["width","256","height","256",1,"hs-stc-thumbnail","img-thumbnail",3,"alt"],[3,"collapsed","access_rights","access_rightsChange","access_rights_changed",4,"ngIf"],[1,"mb-2","d-flex","justify-content-center"],["type","button","id","stc-advanced-options",1,"btn","btn-secondary","me-2","w-50",3,"click"],[3,"thumbnail","hidden"],["class","modal-footer w-100 pt-3",4,"ngIf"],[3,"access_rightsChange","access_rights_changed","collapsed","access_rights"],[1,"modal-footer","w-100","pt-3"],["class","alert alert-info text-gray m-2",4,"ngIf"],[1,"d-flex","justify-content-end","w-100"],["type","button","class","btn btn-danger position-relative","id","stc-save",3,"click",4,"ngIf"],[1,"d-flex","justify-content-end","gap-2"],["type","submit","id","stc-saveas",1,"btn","btn-primary",3,"hidden"],[4,"ngIf"],["type","button","id","stc-download",1,"btn","btn-secondary",3,"click"],[1,"alert","alert-info","text-gray","m-2"],["type","button","id","stc-save",1,"btn","btn-danger","position-relative",3,"click"],[1,"position-absolute","top-0","start-100","translate-middle","badge","rounded-pill","bg-primary",3,"title"]],template:function(s,n){1&s&&(e.DNE(0,me,33,38,"form",2),e.nI1(1,"async")),2&s&&e.Y8G("ngIf",e.bMT(1,1,n.isVisible))},dependencies:[p.bT,r.qT,r.me,r.BC,r.cb,r.j4,r.JD,ie.Ht,G,p.Jj,_.q],encapsulation:2})}return a})();var O=o(25849),A=o(23916),ue=o(19835),ve=o(91040),ge=o(70258);function fe(a,c){if(1&a&&(e.j41(0,"option",12),e.EFF(1),e.k0s()),2&a){const t=c.$implicit;e.Y8G("ngValue",t),e.R7$(),e.JRh(t.title)}}function Me(a,c){if(1&a&&e.nrm(0,"hs-layman-current-user",13),2&a){const t=e.XpG(2);e.Y8G("endpoint",t.endpoint)}}function Se(a,c){1&a&&e.nrm(0,"hs-save-map-form")}function be(a,c){if(1&a){const t=e.RV6();e.j41(0,"div",2),e.nrm(1,"hs-panel-header",3),e.j41(2,"div",4)(3,"div",5)(4,"div",6)(5,"span",7),e.EFF(6),e.nI1(7,"translateHs"),e.k0s(),e.j41(8,"select",8),e.mxI("ngModelChange",function(n){e.eBV(t);const i=e.XpG();return e.DH7(i.endpoint,n)||(i.endpoint=n),e.Njj(n)}),e.bIt("change",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.selectEndpoint(n.endpoint))}),e.DNE(9,fe,2,2,"option",9),e.k0s()()(),e.DNE(10,Me,1,1,"hs-layman-current-user",10)(11,Se,1,0,"hs-save-map-form",11),e.k0s()()}if(2&a){const t=e.XpG(),s=e.sdS(3);e.Y8G("ngClass",t.panelWidthClass),e.R7$(),e.Y8G("panelTabs","SAVECOMPOSITION"),e.R7$(5),e.JRh(e.bMT(7,8,"COMMON.saveTo")),e.R7$(2),e.R50("ngModel",t.endpoint),e.R7$(),e.Y8G("ngForOf",t.endpoints),e.R7$(),e.Y8G("ngIf","layman"===(null==t.endpoint?null:t.endpoint.type)),e.R7$(),e.Y8G("ngIf",t.isAuthenticated||!(null!=t.endpoint&&t.endpoint.type.includes("layman")))("ngIfElse",s)}}function _e(a,c){1&a&&(e.j41(0,"div",14),e.EFF(1),e.nI1(2,"translateHs"),e.k0s()),2&a&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"SAVECOMPOSITION.panelMd.youAreNotAuthorized")," "))}let Ce=(()=>{class a extends O.aH{constructor(t,s,n,i,l,f){super(),this.hsConfig=t,this.hsSaveMapManagerService=s,this.hsCommonLaymanService=n,this.hsCommonEndpointsService=i,this.hsSaveMapDialogSpawnerService=l,this.hsSaveMapService=f,this.endpoint=null,this.isAuthenticated=!1,this.name="saveMap",this.end=new v.B}ngOnInit(){super.ngOnInit(),this.endpoints=this.hsCommonEndpointsService.endpoints,this.hsCommonEndpointsService.endpointsFilled.pipe((0,m.Q)(this.end)).subscribe(t=>{if(t?.length>0&&!this.endpoint){this.hsSaveMapManagerService.selectEndpoint(this.hsCommonLaymanService.layman||t[0])}}),this.hsCommonLaymanService.authChange.pipe((0,m.Q)(this.end)).subscribe(t=>{this.isAuthenticated=t.authenticated,this.hsSaveMapManagerService.currentUser=t.user}),this.hsSaveMapManagerService.endpointSelected.pipe((0,m.Q)(this.end)).subscribe(t=>{t&&(this.endpoint=t,t.getCurrentUserIfNeeded&&t.getCurrentUserIfNeeded(t))}),this.hsSaveMapManagerService.panelOpened.pipe((0,m.Q)(this.end)).subscribe(t=>{if(t&&t.endpoint){const s=t.endpoint.type,n=this.hsCommonEndpointsService.endpoints.filter(i=>i.type.includes(s));n.length>0&&this.hsSaveMapManagerService.selectEndpoint(n[0])}}),window.addEventListener("beforeunload",()=>{this.hsConfig.saveMapStateOnReload&&this.hsSaveMapService.save2storage()})}ngOnDestroy(){this.end.next(),this.end.complete()}selectEndpoint(t){this.hsSaveMapManagerService.selectEndpoint(t)}static#e=this.\u0275fac=function(s){return new(s||a)(e.rXU(j.Q),e.rXU(g),e.rXU(A.wC),e.rXU(ue.Y),e.rXU(V),e.rXU(b.qY))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["hs-save-map"]],features:[e.Vt3],decls:4,vars:3,consts:[["notAuthorized",""],["class","card panel-default hs-main-panel mainpanel hs-stc-mainpanel",3,"ngClass",4,"ngIf"],[1,"card","panel-default","hs-main-panel","mainpanel","hs-stc-mainpanel",3,"ngClass"],["name","saveMap",3,"panelTabs"],[1,"card-body"],[1,"form-group"],[1,"input-group"],[1,"input-group-text","control-label"],["name","endpoint",1,"form-control","form-select",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["class","d-block pb-5",3,"endpoint",4,"ngIf"],[4,"ngIf","ngIfElse"],[3,"ngValue"],[1,"d-block","pb-5",3,"endpoint"],[1,"alert","alert-info","text-gray"]],template:function(s,n){1&s&&(e.DNE(0,be,12,10,"div",1),e.nI1(1,"async"),e.DNE(2,_e,3,3,"ng-template",null,0,e.C5r)),2&s&&e.Y8G("ngIf",e.bMT(1,1,n.isVisible$))},dependencies:[p.YU,p.Sq,p.bT,r.xH,r.y7,r.wz,r.BC,r.vS,ve.t,ge.k,$,p.Jj,_.q],encapsulation:2})}return a})(),ye=(()=>{class a{static#e=this.\u0275fac=function(s){return new(s||a)};static#t=this.\u0275mod=e.$C({type:a});static#s=this.\u0275inj=e.G2t({imports:[p.MD,O.Zz,r.YN,r.X1,A.QW,O.k4]})}return a})()}}]);
//# sourceMappingURL=default-projects_hslayers_components_save-map_index_ts.js.map