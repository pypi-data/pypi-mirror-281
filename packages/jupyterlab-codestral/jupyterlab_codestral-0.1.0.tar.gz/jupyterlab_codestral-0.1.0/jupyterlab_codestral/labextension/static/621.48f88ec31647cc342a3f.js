(self.webpackChunkjupyterlab_codestral=self.webpackChunkjupyterlab_codestral||[]).push([[621],{4621:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});const s=class{constructor(e){this.client=e}async create({file:e,purpose:t="fine-tune"}){const n=new FormData;return n.append("file",e),n.append("purpose",t),await this.client._request("post","v1/files",null,void 0,n)}async retrieve({fileId:e}){return await this.client._request("get",`v1/files/${e}`)}async list(){return await this.client._request("get","v1/files")}async delete({fileId:e}){return await this.client._request("delete",`v1/files/${e}`)}},o=class{constructor(e){this.client=e}async create({model:e,trainingFiles:t,validationFiles:n=[],hyperparameters:s={training_steps:1800,learning_rate:1e-4},suffix:o=null,integrations:r=null}){return await this.client._request("post","v1/fine_tuning/jobs",{model:e,training_files:t,validation_files:n,hyperparameters:s,suffix:o,integrations:r})}async retrieve({jobId:e}){return await this.client._request("get",`v1/fine_tuning/jobs/${e}`,{})}async list(){return await this.client._request("get","v1/fine_tuning/jobs",{})}async cancel({jobId:e}){return await this.client._request("post",`v1/fine_tuning/jobs/${e}/cancel`,{})}};var r=n(5606);const i=[429,500,502,503,504],a=Promise.resolve(globalThis.fetch??n.e(92).then(n.t.bind(n,3092,23)).then((e=>e.default)));class u extends Error{constructor(e){super(e),this.name="MistralAPIError"}}function c(e){const t=new AbortController;return e.forEach((e=>{e&&(e.addEventListener("abort",(()=>{t.abort(e.reason)}),{once:!0}),e.aborted&&t.abort(e.reason))})),t.signal}const l=class{constructor(e=r.env.MISTRAL_API_KEY,t="https://api.mistral.ai",n=5,i=120){this.endpoint=t,this.apiKey=e,this.maxRetries=n,this.timeout=i,this.endpoint.indexOf("inference.azure.com")&&(this.modelDefault="mistral"),this.files=new s(this),this.jobs=new o(this)}async _fetch(...e){return(await a)(...e)}_request=async function(e,t,n,s,o=null){const r=`${this.endpoint}/${t}`,a={method:e,headers:{"User-Agent":"mistral-client-js/0.5.0",Accept:n?.stream?"text/event-stream":"application/json","Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},signal:c([AbortSignal.timeout(1e3*this.timeout),s]),body:"get"!==e?o??JSON.stringify(n):null,timeout:1e3*this.timeout};o&&delete a.headers["Content-Type"];for(let e=0;e<this.maxRetries;e++)try{const t=await this._fetch(r,a);if(t.ok){if(n?.stream){if(void 0===t.body.getReader)return t.body;{const e=t.body.getReader();return async function*(){try{for(;;){const{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}()}}return await t.json()}if(!i.includes(t.status))throw new u(`HTTP error! status: ${t.status} Response: \n${await t.text()}`);console.debug(`Retrying request on response status: ${t.status}`,`Response: ${await t.text()}`,`Attempt: ${e+1}`),await new Promise((t=>setTimeout(t,500*Math.pow(2,e+1))))}catch(t){if(console.error(`Request failed: ${t.message}`),"MistralAPIError"===t.name)throw t;if(e===this.maxRetries-1)throw t;await new Promise((t=>setTimeout(t,500*Math.pow(2,e+1))))}throw new Error("Max retries reached")};_makeChatCompletionRequest=function(e,t,n,s,o,r,i,a,c,l,m,d){if(!e&&!this.modelDefault)throw new u("You must provide a model name");return{model:e??this.modelDefault,messages:t,tools:n??void 0,temperature:s??void 0,max_tokens:o??void 0,top_p:r??void 0,random_seed:i??void 0,stream:a??void 0,safe_prompt:(c||l)??void 0,tool_choice:m??void 0,response_format:d??void 0}};_makeCompletionRequest=function(e,t,n,s,o,r,i,a,c){if(!e&&!this.modelDefault)throw new u("You must provide a model name");return{model:e??this.modelDefault,prompt:t,suffix:n??void 0,temperature:s??void 0,max_tokens:o??void 0,top_p:r??void 0,random_seed:i??void 0,stop:a??void 0,stream:c??void 0}};listModels=async function(){return await this._request("get","v1/models")};chat=async function({model:e,messages:t,tools:n,temperature:s,maxTokens:o,topP:r,randomSeed:i,safeMode:a,safePrompt:u,toolChoice:c,responseFormat:l},{signal:m}={}){const d=this._makeChatCompletionRequest(e,t,n,s,o,r,i,!1,a,u,c,l);return await this._request("post","v1/chat/completions",d,m)};chatStream=async function*({model:e,messages:t,tools:n,temperature:s,maxTokens:o,topP:r,randomSeed:i,safeMode:a,safePrompt:u,toolChoice:c,responseFormat:l},{signal:m}={}){const d=this._makeChatCompletionRequest(e,t,n,s,o,r,i,!0,a,u,c,l),f=await this._request("post","v1/chat/completions",d,m);let p="";const h=new TextDecoder;for await(const e of f){let t;for(p+=h.decode(e,{stream:!0});-1!==(t=p.indexOf("\n"));){const e=p.substring(0,t);if(p=p.substring(t+1),e.startsWith("data:")){const t=e.substring(6).trim();"[DONE]"!==t&&(yield JSON.parse(t))}}}};embeddings=async function({model:e,input:t}){const n={model:e,input:t};return await this._request("post","v1/embeddings",n)};completion=async function({model:e,prompt:t,suffix:n,temperature:s,maxTokens:o,topP:r,randomSeed:i,stop:a},{signal:u}={}){const c=this._makeCompletionRequest(e,t,n,s,o,r,i,a,!1);return await this._request("post","v1/fim/completions",c,u)};completionStream=async function*({model:e,prompt:t,suffix:n,temperature:s,maxTokens:o,topP:r,randomSeed:i,stop:a},{signal:u}={}){const c=this._makeCompletionRequest(e,t,n,s,o,r,i,a,!0),l=await this._request("post","v1/fim/completions",c,u);let m="";const d=new TextDecoder;for await(const e of l){let t;for(m+=d.decode(e,{stream:!0});-1!==(t=m.indexOf("\n"));){const e=m.substring(0,t);if(m=m.substring(t+1),e.startsWith("data:")){const t=e.substring(6).trim();"[DONE]"!==t&&(yield JSON.parse(t))}}}}}},5606:e=>{var t,n,s=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:r}catch(e){n=r}}();var a,u=[],c=!1,l=-1;function m(){c&&a&&(c=!1,a.length?u=a.concat(u):l=-1,u.length&&d())}function d(){if(!c){var e=i(m);c=!0;for(var t=u.length;t;){for(a=u,u=[];++l<t;)a&&a[l].run();l=-1,t=u.length}a=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===r||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||c||i(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.prependListener=p,s.prependOnceListener=p,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}}}]);