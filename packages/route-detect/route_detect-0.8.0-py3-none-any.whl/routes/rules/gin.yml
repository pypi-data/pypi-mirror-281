rules:
  - id: gin-route-authenticated
    patterns:
      - pattern-either:
          - patterns:
              - pattern: $ROUTER.$METHOD($PATH, ..., $CALLBACK)
              - pattern-either:
                  - patterns:
                      - pattern-either:
                          - pattern-inside: |
                              $ROUTER := $GININIT(...)
                              ...
                              $ROUTER.Use($AUTHNMIDDLEWARE(...))
                              ...
                          - pattern-inside: |
                              $PARENT := $GININIT(...)
                              ...
                              $ROUTER := $PARENT. ... .Group(...). ... .Use($AUTHNMIDDLEWARE(...)). ...
                              ...
                          - pattern-inside: |
                              $PARENT := $GININIT(...)
                              ...
                              $ROUTER := $PARENT. ... .Group(...). ...
                              ...
                              $ROUTER.Use($AUTHNMIDDLEWARE(...))
                              ...
                          - pattern-inside: |
                              $PARENT := $GININIT(...)
                              ...
                              $GROUP := $ANY. ... .Group(...). ...
                              ...
                              $ROUTER := $GROUP. ... .Group(...). ...
                              ...
                              $ROUTER.Use($AUTHNMIDDLEWARE(...))
                              ...
                      - metavariable-pattern:
                          metavariable: $GININIT
                          pattern-either:
                            - pattern: gin.New
                            - pattern: gin.Default
                  - patterns:
                      - pattern-either:
                          - pattern-inside: |
                              func $FUNC(..., $ROUTER *$GINTYPE, ...) {
                                ...
                                $ROUTER.Use($AUTHNMIDDLEWARE(...))
                                ...
                              }
                          - pattern-inside: |
                              func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                ...
                                $ROUTER := $PARENT. ... .Group(...). ... .Use($AUTHNMIDDLEWARE(...)). ...
                                ...
                              }
                          - pattern-inside: |
                              func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                ...
                                $ROUTER := $PARENT. ... .Group(...). ...
                                ...
                                $ROUTER.Use($AUTHNMIDDLEWARE(...))
                                ...
                              }
                          - pattern-inside: |
                              func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                ...
                                $GROUP := $ANY. ... .Group(...). ...
                                ...
                                $ROUTER := $GROUP. ... .Group(...). ...
                                ...
                                $ROUTER.Use($AUTHNMIDDLEWARE(...))
                                ...
                              }
                      - metavariable-pattern:
                          metavariable: $GINTYPE
                          pattern-either:
                            - pattern: gin.Engine
                            - pattern: gin.RouterGroup
              - metavariable-pattern:
                  metavariable: $AUTHNMIDDLEWARE
                  pattern-either:
                    - pattern: authMiddleware.MiddlewareFunc
                    - pattern: authentication.RequireClient
                    - pattern: authentication.RequireApplicationToken
                    - pattern: authentication.RequireAdmin
          - patterns:
              - pattern: $ROUTER.$METHOD($PATH, ..., $CALLBACK)
              - pattern-either:
                  - patterns:
                      - pattern-either:
                          - pattern-inside: |
                              $ROUTER := $GININIT(...)
                              ...
                          - pattern-inside: |
                              $PARENT := $GININIT(...)
                              ...
                              $ROUTER := $PARENT. ... .Group(...). ...
                              ...
                          - pattern-inside: |
                              $PARENT := $GININIT(...)
                              ...
                              $GROUP := $ANY. ... .Group(...). ...
                              ...
                              $ROUTER := $GROUP. ... .Group(...). ...
                              ...
                      - metavariable-pattern:
                          metavariable: $GININIT
                          pattern-either:
                            - pattern: gin.New
                            - pattern: gin.Default
                  - patterns:
                      - pattern-either:
                          - pattern-inside: |
                              func $FUNC(..., $ROUTER *$GINTYPE, ...) {
                                ...
                              }
                          - pattern-inside: |
                              func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                ...
                                $ROUTER := $PARENT. ... .Group(...). ...
                                ...
                              }
                          - pattern-inside: |
                              func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                ...
                                $GROUP := $ANY. ... .Group(...). ...
                                ...
                                $ROUTER := $GROUP. ... .Group(...). ...
                                ...
                              }
                      - metavariable-pattern:
                          metavariable: $GINTYPE
                          pattern-either:
                            - pattern: gin.Engine
                            - pattern: gin.RouterGroup
              - metavariable-pattern:
                  metavariable: $CALLBACK
                  pattern-either:
                    - pattern: |
                        func(...) {
                          ...
                          Auth(...)
                        }
                    - pattern: |
                        func(...) {
                          ...
                          AuthAny(...)
                        }
      - metavariable-pattern:
          metavariable: $METHOD
          pattern-either:
            - pattern: Any
            - pattern: Handle
            - pattern: Static
            - pattern: StaticFS
            - pattern: StaticFile
            - pattern: DELETE
            - pattern: GET
            - pattern: HEAD
            - pattern: OPTIONS
            - pattern: PATCH
            - pattern: POST
            - pattern: PUT
    message: Found authenticated Gin route
    metadata:
      references:
        - https://gin-gonic.com/docs/quickstart/
        - https://gin-gonic.com/docs/examples/using-middleware/
        - https://gin-gonic.com/docs/examples/grouping-routes/
        - https://gin-gonic.com/docs/examples/using-basicauth-middleware/
      route-detect:
        fill: green
    languages: [go]
    severity: INFO
  - id: gin-route-unauthenticated
    patterns:
      - pattern-either:
          - patterns:
              - pattern: $ROUTER.$METHOD($PATH, ..., $CALLBACK)
              - pattern-not: $ROUTER.$METHOD($PATH, ..., func(...) { ... })
              - pattern-either:
                  - patterns:
                      - pattern-either:
                          - patterns:
                              - pattern-inside: |
                                  $ROUTER := $GININIT(...)
                                  ...
                              - pattern-not-inside: |
                                  $ROUTER := $GININIT(...)
                                  ...
                                  $ROUTER.Use(authMiddleware.MiddlewareFunc(...))
                                  ...
                              - pattern-not-inside: |
                                  $ROUTER := $GININIT(...)
                                  ...
                                  $ROUTER.Use(authentication.RequireClient(...))
                                  ...
                              - pattern-not-inside: |
                                  $ROUTER := $GININIT(...)
                                  ...
                                  $ROUTER.Use(authentication.RequireApplicationToken(...))
                                  ...
                              - pattern-not-inside: |
                                  $ROUTER := $GININIT(...)
                                  ...
                                  $ROUTER.Use(authentication.RequireAdmin(...))
                                  ...
                          - patterns:
                              - pattern-either:
                                  - pattern-inside: |
                                      $PARENT := $GININIT(...)
                                      ...
                                      $ROUTER := $PARENT. ... .Group(...). ...
                                      ...
                                  - pattern-inside: |
                                      $PARENT := $GININIT(...)
                                      ...
                                      $GROUP := $ANY. ... .Group(...). ...
                                      ...
                                      $ROUTER := $GROUP. ... .Group(...). ...
                                      ...
                              - pattern-not-inside: |
                                  $PARENT := $GININIT(...)
                                  ...
                                  $ROUTER := $PARENT. ... .Group(...). ... .Use(authMiddleware.MiddlewareFunc(...)). ...
                                  ...
                              - pattern-not-inside: |
                                  $PARENT := $GININIT(...)
                                  ...
                                  $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireClient(...)). ...
                                  ...
                              - pattern-not-inside: |
                                  $PARENT := $GININIT(...)
                                  ...
                                  $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireApplicationToken(...)). ...
                                  ...
                              - pattern-not-inside: |
                                  $PARENT := $GININIT(...)
                                  ...
                                  $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireAdmin(...)). ...
                                  ...
                              - pattern-not-inside: |
                                  $PARENT := $GININIT(...)
                                  ...
                                  $ROUTER := $PARENT. ... .Group(...). ...
                                  ...
                                  $ROUTER.Use(authMiddleware.MiddlewareFunc(...))
                                  ...
                              - pattern-not-inside: |
                                  $PARENT := $GININIT(...)
                                  ...
                                  $ROUTER := $PARENT. ... .Group(...). ...
                                  ...
                                  $ROUTER.Use(authentication.RequireClient(...))
                                  ...
                              - pattern-not-inside: |
                                  $PARENT := $GININIT(...)
                                  ...
                                  $ROUTER := $PARENT. ... .Group(...). ...
                                  ...
                                  $ROUTER.Use(authentication.RequireApplicationToken(...))
                                  ...
                              - pattern-not-inside: |
                                  $PARENT := $GININIT(...)
                                  ...
                                  $ROUTER := $PARENT. ... .Group(...). ...
                                  ...
                                  $ROUTER.Use(authentication.RequireAdmin(...))
                                  ...
                      - metavariable-pattern:
                          metavariable: $GININIT
                          pattern-either:
                            - pattern: gin.New
                            - pattern: gin.Default
                  - patterns:
                      - pattern-either:
                          - patterns:
                              - pattern-inside: |
                                  func $FUNC(..., $ROUTER *$GINTYPE, ...) {
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $ROUTER *$GINTYPE, ...) {
                                    ...
                                    $ROUTER.Use(authMiddleware.MiddlewareFunc(...))
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $ROUTER *$GINTYPE, ...) {
                                    ...
                                    $ROUTER.Use(authentication.RequireClient(...))
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $ROUTER *$GINTYPE, ...) {
                                    ...
                                    $ROUTER.Use(authentication.RequireApplicationToken(...))
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $ROUTER *$GINTYPE, ...) {
                                    ...
                                    $ROUTER.Use(authentication.RequireAdmin(...))
                                    ...
                                  }
                          - patterns:
                              - pattern-either:
                                  - pattern-inside: |
                                      func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                        ...
                                        $ROUTER := $PARENT. ... .Group(...). ...
                                        ...
                                      }
                                  - pattern-inside: |
                                      func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                        ...
                                        $GROUP := $ANY. ... .Group(...). ...
                                        ...
                                        $ROUTER := $GROUP. ... .Group(...). ...
                                        ...
                                      }
                              - pattern-not-inside: |
                                  func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                    ...
                                    $ROUTER := $PARENT. ... .Group(...). ... .Use(authMiddleware.MiddlewareFunc(...)). ...
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                    ...
                                    $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireClient(...)). ...
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                    ...
                                    $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireApplicationToken(...)). ...
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                    ...
                                    $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireAdmin(...)). ...
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                    ...
                                    $ROUTER := $PARENT. ... .Group(...). ...
                                    ...
                                    $ROUTER.Use(authMiddleware.MiddlewareFunc(...))
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                    ...
                                    $ROUTER := $PARENT. ... .Group(...). ...
                                    ...
                                    $ROUTER.Use(authentication.RequireClient(...))
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                    ...
                                    $ROUTER := $PARENT. ... .Group(...). ...
                                    ...
                                    $ROUTER.Use(authentication.RequireApplicationToken(...))
                                    ...
                                  }
                              - pattern-not-inside: |
                                  func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                    ...
                                    $ROUTER := $PARENT. ... .Group(...). ...
                                    ...
                                    $ROUTER.Use(authentication.RequireAdmin(...))
                                    ...
                                  }
                      - metavariable-pattern:
                          metavariable: $GINTYPE
                          pattern-either:
                            - pattern: gin.Engine
                            - pattern: gin.RouterGroup
          - patterns:
              - pattern: $ROUTER.$METHOD($PATH, ..., $CALLBACK)
              - pattern-either:
                  - patterns:
                      - pattern-either:
                          - pattern-inside: |
                              $ROUTER := $GININIT(...)
                              ...
                          - pattern-inside: |
                              $PARENT := $GININIT(...)
                              ...
                              $ROUTER := $PARENT. ... .Group(...). ...
                              ...
                          - pattern-inside: |
                              $PARENT := $GININIT(...)
                              ...
                              $GROUP := $ANY. ... .Group(...). ...
                              ...
                              $ROUTER := $GROUP. ... .Group(...). ...
                              ...
                      - pattern-not-inside: |
                          $PARENT := $GININIT(...)
                          ...
                          $ROUTER := $PARENT. ... .Group(...). ... .Use(authMiddleware.MiddlewareFunc(...)). ...
                          ...
                      - pattern-not-inside: |
                          $PARENT := $GININIT(...)
                          ...
                          $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireClient(...)). ...
                          ...
                      - pattern-not-inside: |
                          $PARENT := $GININIT(...)
                          ...
                          $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireApplicationToken(...)). ...
                          ...
                      - pattern-not-inside: |
                          $PARENT := $GININIT(...)
                          ...
                          $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireAdmin(...)). ...
                          ...
                      - pattern-not-inside: |
                          $PARENT := $GININIT(...)
                          ...
                          $ROUTER := $PARENT. ... .Group(...). ...
                          ...
                          $ROUTER.Use(authMiddleware.MiddlewareFunc(...))
                          ...
                      - pattern-not-inside: |
                          $PARENT := $GININIT(...)
                          ...
                          $ROUTER := $PARENT. ... .Group(...). ...
                          ...
                          $ROUTER.Use(authentication.RequireClient(...))
                      - pattern-not-inside: |
                          $PARENT := $GININIT(...)
                          ...
                          $ROUTER := $PARENT. ... .Group(...). ...
                          ...
                          $ROUTER.Use(authentication.RequireApplicationToken(...))
                          ...
                      - pattern-not-inside: |
                          $PARENT := $GININIT(...)
                          ...
                          $ROUTER := $PARENT. ... .Group(...). ...
                          ...
                          $ROUTER.Use(authentication.RequireAdmin(...))
                          ...
                      - metavariable-pattern:
                          metavariable: $GININIT
                          pattern-either:
                            - pattern: gin.New
                            - pattern: gin.Default
                  - patterns:
                      - pattern-either:
                          - pattern-inside: |
                              func $FUNC(..., $ROUTER *$GINTYPE, ...) {
                                ...
                              }
                          - pattern-inside: |
                              func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                ...
                                $ROUTER := $PARENT. ... .Group(...). ...
                                ...
                              }
                          - pattern-inside: |
                              func $FUNC(..., $PARENT *$GINTYPE, ...) {
                                ...
                                $GROUP := $ANY. ... .Group(...). ...
                                ...
                                $ROUTER := $GROUP. ... .Group(...). ...
                                ...
                              }
                      - pattern-not-inside: |
                          func $FUNC(..., $PARENT *$GINTYPE, ...) {
                            ...
                            $ROUTER := $PARENT. ... .Group(...). ... .Use(authMiddleware.MiddlewareFunc(...)). ...
                            ...
                          }
                      - pattern-not-inside: |
                          func $FUNC(..., $PARENT *$GINTYPE, ...) {
                            ...
                            $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireClient(...)). ...
                            ...
                          }
                      - pattern-not-inside: |
                          func $FUNC(..., $PARENT *$GINTYPE, ...) {
                            ...
                            $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireApplicationToken(...)). ...
                            ...
                          }
                      - pattern-not-inside: |
                          func $FUNC(..., $PARENT *$GINTYPE, ...) {
                            ...
                            $ROUTER := $PARENT. ... .Group(...). ... .Use(authentication.RequireAdmin(...)). ...
                            ...
                          }
                      - pattern-not-inside: |
                          func $FUNC(..., $PARENT *$GINTYPE, ...) {
                            ...
                            $ROUTER := $PARENT. ... .Group(...). ...
                            ...
                            $ROUTER.Use(authMiddleware.MiddlewareFunc(...))
                            ...
                          }
                      - pattern-not-inside: |
                          func $FUNC(..., $PARENT *$GINTYPE, ...) {
                            ...
                            $ROUTER := $PARENT. ... .Group(...). ...
                            ...
                            $ROUTER.Use(authentication.RequireClient(...))
                            ...
                          }
                      - pattern-not-inside: |
                          func $FUNC(..., $PARENT *$GINTYPE, ...) {
                            ...
                            $ROUTER := $PARENT. ... .Group(...). ...
                            ...
                            $ROUTER.Use(authentication.RequireApplicationToken(...))
                            ...
                          }
                      - pattern-not-inside: |
                          func $FUNC(..., $PARENT *$GINTYPE, ...) {
                            ...
                            $ROUTER := $PARENT. ... .Group(...). ...
                            ...
                            $ROUTER.Use(authentication.RequireAdmin(...))
                            ...
                          }
                      - metavariable-pattern:
                          metavariable: $GINTYPE
                          pattern-either:
                            - pattern: gin.Engine
                            - pattern: gin.RouterGroup
              - metavariable-pattern:
                  metavariable: $CALLBACK
                  patterns:
                    - pattern: |
                        func(...) {
                          ...
                        }
                    - pattern-not: |
                        func(...) {
                          ...
                          Auth(...)
                        }
                    - pattern-not: |
                        func(...) {
                          ...
                          AuthAny(...)
                        }
      - metavariable-pattern:
          metavariable: $METHOD
          pattern-either:
            - pattern: Any
            - pattern: Handle
            - pattern: Static
            - pattern: StaticFS
            - pattern: StaticFile
            - pattern: DELETE
            - pattern: GET
            - pattern: HEAD
            - pattern: OPTIONS
            - pattern: PATCH
            - pattern: POST
            - pattern: PUT
    message: Found unauthenticated Gin route
    metadata:
      references:
        - https://gin-gonic.com/docs/quickstart/
        - https://gin-gonic.com/docs/examples/using-middleware/
        - https://gin-gonic.com/docs/examples/grouping-routes/
        - https://gin-gonic.com/docs/examples/using-basicauth-middleware/
      route-detect:
        fill: red
    languages: [go]
    severity: INFO
