"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4702],{42884:(t,e,n)=>{var i=n(36111),a=n(43057),r=n(29079),s=n(54858),o=n.n(s),l=n(72495),c=n.n(l),d=n(14867),u=n.n(d),m=n(86326),b=n(35623),p=(n(64622),n(42383),n(89995)),h=n(68820),f=n(96478),y=n(49528),g=n(24372),D=n(25584),v=n(97598),k=n.n(v),E=n(92117),I=n(45423),T=n(53225),A=n(56237);function C(t){let{open:e,setModalOpen:n,trigger:i,published:a,onClick:r}=t;return m.createElement(E.A,{open:e,onClose:()=>n(!1),size:"tiny",trigger:i,closeIcon:!0},m.createElement(I.A,{content:a?f.Translate.string("Set contribution list in draft mode"):f.Translate.string("Publish contributions")}),m.createElement(E.A.Content,null,a?m.createElement(m.Fragment,null,m.createElement("p",null,m.createElement(f.Translate,null,"Are you sure you want to change the contribution list back to draft mode?")),m.createElement("p",null,m.createElement(f.Translate,null,"By doing so the following menu items won't be accessible:"))):m.createElement(m.Fragment,null,m.createElement("p",null,m.createElement(f.Translate,null,"Are you sure you want to publish the contribution list?")),m.createElement("p",null,m.createElement(f.Translate,null,"By doing so the following menu items will be accessible:"))),m.createElement(T.A,{bulleted:!0},m.createElement(T.A.Item,null,m.createElement(f.Translate,null,"Contribution List")),m.createElement(T.A.Item,null,m.createElement(f.Translate,null,"My Contributions")),m.createElement(T.A.Item,null,m.createElement(f.Translate,null,"Author List")),m.createElement(T.A.Item,null,m.createElement(f.Translate,null,"Speaker List")),m.createElement(T.A.Item,null,m.createElement(f.Translate,null,"Timetable")),m.createElement(T.A.Item,null,m.createElement(f.Translate,null,"Book of Abstracts")))),m.createElement(E.A.Actions,null,m.createElement(A.A,{onClick:()=>n(!1)},m.createElement(f.Translate,null,"No")),m.createElement(A.A,{primary:!0,onClick:r},m.createElement(f.Translate,null,"Yes"))))}C.propTypes={open:k().bool.isRequired,setModalOpen:k().func.isRequired,trigger:k().node.isRequired,published:k().bool.isRequired,onClick:k().func.isRequired};const _=r.Ay.bind(null,{endpoint:"contributions.manage_publication",rules:[{args:["event_id"],converters:{event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"contributions",isDynamic:!1},{data:"/",isDynamic:!1},{data:"published",isDynamic:!1}]}]},"/");function x(t){let{eventId:e,onSuccess:n}=t;const i=_({event_id:e}),[a,r]=(0,m.useState)(!1),s=m.createElement(h.IButton,{onClick:()=>r(!0)},m.createElement(f.Translate,null,"Publish contributions"));return m.createElement(C,{open:a,setModalOpen:r,trigger:s,published:!1,onClick:async()=>{try{await y.indicoAxios.put(i)}catch(t){return(0,y.handleAxiosError)(t)}n(),r(!1)}})}x.propTypes={eventId:k().string.isRequired,onSuccess:k().func.isRequired};var w=n(91185),j=n(59865);const O=r.Ay.bind(null,{endpoint:"contributions.manage_publication",rules:[{args:["event_id"],converters:{event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"contributions",isDynamic:!1},{data:"/",isDynamic:!1},{data:"published",isDynamic:!1}]}]},"/");function S(t){let{eventId:e}=t;const[n,i]=(0,m.useState)(!1),[a,r,s,o]=(0,j.ib)(O({event_id:e}));if(s)return null;const l=m.createElement(w.A,{label:a?f.Translate.string("Published"):f.Translate.string("Draft"),toggle:!0,onClick:()=>i(!0),checked:a,disabled:o});return m.createElement(C,{open:n,setModalOpen:i,trigger:l,published:a,onClick:()=>{r(),i(!1)}})}S.propTypes={eventId:k().string.isRequired};const L=["id"];function P(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(Object(n),!0).forEach((function(e){(0,i.A)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const R=r.Ay.bind(null,{endpoint:"event_editing.api_file_types",rules:[{args:["event_id","type"],converters:{event_id:"IntegerConverter",type:"AnyConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"editing",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"type",isDynamic:!0},{data:"/",isDynamic:!1},{data:"file-types",isDynamic:!1}]}]},"/"),U=r.Ay.bind(null,{endpoint:"papers.api_paper_details",rules:[{args:["contrib_id","event_id"],converters:{contrib_id:"IntegerConverter",event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"papers",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"contrib_id",isDynamic:!0}]}]},"/");document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector("#contribution-calendar-link");if(!t)return;const{contributionId:e,eventId:n}=t.dataset;b.render(m.createElement(h.ICSCalendarLink,{endpoint:"contributions.export_ics",params:{event_id:n,contrib_id:e},renderButton:t=>m.createElement(h.IButton,{icon:"calendar",classes:t,title:f.Translate.string("Export")}),options:[{key:"contribution",text:f.Translate.string("Contribution"),extraParams:{}}]}),t)})),function(t){function e(t){$(t).tablesorter({cssAsc:"header-sort-asc",cssDesc:"header-sort-desc",cssInfoBlock:"avoid-sort",headerTemplate:"",sortList:[[1,0]]})}function n(t,e,n){return $.ajax({url:t,method:e,data:JSON.stringify(n),dataType:"json",contentType:"application/json",error:handleAjaxError,complete:IndicoUI.Dialogs.Util.progress()})}function i(){$(".js-contrib-start-date").each((function(){const t=$(this);t.ajaxqbubble({url:t.data("href"),qBubbleOptions:{style:{classes:"qbubble-contrib-start-date qtip-allow-overflow"}}})}))}function r(){$(".js-contrib-duration").each((function(){const t=$(this);t.ajaxqbubble({url:t.data("href"),qBubbleOptions:{style:{classes:"qbubble-contrib-duration"}}})}))}t.setupEditableSubmissionButton=async function(){const t=document.querySelector("#editable-submission-button");if(!t)return;const e=JSON.parse(t.dataset.availableTypes),{eventId:n,contributionId:i,contributionCode:r}=t.dataset;let s,o,l=[];try{[s,o]=await Promise.all([Promise.all(e.map((t=>y.indicoAxios.get(R({event_id:n,type:t}))))),y.indicoAxios.get(U({event_id:n,contrib_id:i}),{validateStatus:t=>t>=200&&t<300||404===t,headers:{"X-Indico-No-Report-Error":"404"}})])}catch(t){return void(0,y.handleAxiosError)(t)}const d=c()(s.map(((t,n)=>[e[n],(0,g.camelizeKeys)(t.data)])));if(o){const{isInFinalState:t,lastRevision:e}=(0,g.camelizeKeys)(o.data);t&&e&&(l=e.files)}b.render(m.createElement(p.A,{fileTypes:d,eventId:+n,contributionId:+i,contributionCode:r,uploadableFiles:l.map((t=>{let{id:e}=t;return q(q({},(0,a.A)(t,L)),{},{paperId:e})}))}),t)},t.setupContributionConfig=function(){!function(){const t=document.querySelector("#pub-switch");b.render(m.createElement(S,{eventId:t.dataset.eventId}),t)}()},t.setupContributionList=function(t){t=$.extend({createSessionURL:null,createTrackURL:null,timetableRESTURL:null},t);$(".list [data-toggle=dropdown]").closest(".toolbar").dropdown(),e("#contribution-list .tablesorter"),function(t,e){const i=$("#contribution-list");i.on("click",".session-item-picker",(function(){$(this).itempicker({filterPlaceholder:D.$T.gettext("Filter sessions"),containerClasses:"session-item-container",items:i.find("table").data("session-items"),footerElements:[{title:D.$T.gettext("Assign new session"),onClick(e){ajaxDialog({title:D.$T.gettext("Add new session"),url:t,onClose(t){t&&($(".session-item-picker").each((function(){const e=$(this);e.data("indicoItempicker")?e.itempicker("updateItemList",t.sessions):i.find("table").data("session-items",t.sessions)})),e.itempicker("selectItem",t.new_session_id))}})}}],onSelect(t,i){const a=$(this),r=a[0].style,s={session_id:t?t.id:null};return n(a.data("href"),a.data("method"),s).then((function(s){const o=t?t.title:D.$T.gettext("No session");if(a.find(".label").text(o),t?(r.setProperty("color",`#${t.colors.text}`,"important"),r.setProperty("background",`#${t.colors.background}`,"important")):(r.removeProperty("color"),r.removeProperty("background")),s.unscheduled){const t=a.closest("tr"),r=t.find("td.start-date > .vertical-aligner"),o=r.children().detach();r.html($("<em>",{text:D.$T.gettext("Not scheduled")})),showUndoWarning(D.$T.gettext("'{0}' has been unscheduled due to the session change.").format(t.data("title")),D.$T.gettext("Undo successful! Timetable entry and session have been restored."),(function(){return n(e,"POST",s.undo_unschedule).then((function(t){o.filter(".label").text(" "+u().utc(t.start_dt).format("DD/MM/YYYY HH:mm")),r.html(o),a.itempicker("selectItem",i?i.id:null)}))}))}}))}})}))}(t.createSessionURL,t.timetableRESTURL),function(t){const e=$("#contribution-list");e.on("click",".track-item-picker",(function(){$(this).itempicker({filterPlaceholder:D.$T.gettext("Filter tracks"),containerClasses:"track-item-container",uncheckedItemIcon:"",items:e.find("table").data("track-items"),footerElements:[{title:D.$T.gettext("Add new track"),onClick(n){ajaxDialog({title:D.$T.gettext("Add new track"),url:t,onClose(t){t&&($(".track-item-picker").each((function(){const n=$(this);n.data("indicoItempicker")?n.itempicker("updateItemList",t.tracks):e.find("table").data("track-items",t.tracks)})),n.itempicker("selectItem",t.new_track_id))}})}}],onSelect(t){const e=$(this),i={track_id:t?t.id:null};return n(e.data("href"),e.data("method"),i).then((function(){const n=t?t.title:D.$T.gettext("No track");e.find(".label").text(n)}))}})}))}(t.createTrackURL),i(),r(),enableIfChecked("#contribution-list","input[name=contribution_id]",".js-enable-if-checked");const a=setupListGenerator({itemHandle:"tr",listItems:"#contribution-list tbody tr",term:"#search-input",state:"#filtering-state",placeholder:"#filter-placeholder"});$("#contribution-list").on("indico:htmlUpdated",(function(){e("#contribution-list .tablesorter"),i(),r(),o()(a)})).on("attachments:updated",(function(t){const e=$(t.target);reloadManagementAttachmentInfoColumn(e.data("locator"),e.closest("td"))})),$(".js-submit-form").on("click",(function(t){t.preventDefault();const e=$(this);e.hasClass("disabled")||$("#contribution-list form").attr("action",e.data("href")).submit()}))},t.setupSubContributionList=function(){$("#subcontribution-list [data-toggle=dropdown]").closest(".toolbar").dropdown(),e("#subcontribution-list .tablesorter"),enableIfChecked("#subcontribution-list","input[name=subcontribution_id]","#subcontribution-list .js-enable-if-checked"),$("#subcontribution-list td.subcontribution-title").on("mouseenter",(function(){const t=$(this);this.offsetWidth<this.scrollWidth&&!t.attr("title")&&t.attr("title",t.text())})),$("#subcontribution-list").on("attachments:updated",(function(t){const e=$(t.target);reloadManagementAttachmentInfoColumn(e.data("locator"),e.closest("td")),$(this).trigger("ajaxDialog:setData",[!0])})),$("#subcontribution-list").on("indico:htmlUpdated",(function(){$(this).trigger("ajaxDialog:setData",[!0])})),$("#subcontribution-list table").sortable({items:".js-sortable-subcontribution-row",handle:".js-sort-handle",placeholder:"sortable-placeholder",tolerance:"pointer",distance:10,axis:"y",containment:"#subcontribution-list table",start(t,e){e.placeholder.height(e.helper.outerHeight())},update(t,e){const n=$(this);$.ajax({url:e.item.data("sort-url"),method:"POST",data:{subcontrib_ids:n.sortable("toArray")},error:handleAjaxError}),n.trigger("ajaxDialog:setData",[!0])}})},t.setupEventDisplayContributionList=function(){setupListGenerator({itemHandle:"div.contribution-row",listItems:"#display-contribution-list div.contribution-row",term:"#search-input",state:"#filtering-state",placeholder:"#filter-placeholder"})()},t.setupEventDisplayAuthorList=function(){setupSearchBox({itemHandle:".author-list > li",listItems:".author-list > li",term:"#search-input",state:"#filtering-state",placeholder:"#filter-placeholder"})()},t.setupDraftModeWarning=function(){const t=document.querySelector("#draft-mode-warning"),e=document.querySelector("#draft-mode-warning-button-container");t&&e&&b.render(m.createElement(x,{eventId:e.dataset.eventId,onSuccess:()=>t.classList.add("hidden")}),e)}}(window)}},t=>{t.O(0,[4644,4394,2076],(()=>{return e=42884,t(t.s=e);var e}));t.O()}]);
//# sourceMappingURL=module_events.contributions.0e10afc5.bundle.js.map