"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7020],{48772:(e,t,a)=>{var i=a(36111),r=a(29079),n=a(50090),s=a(97598),c=a.n(s),o=a(86326),l=a(35623),u=a(72956),d=a(42430),m=a(50528),p=a(68803),y=a(47279),f=a(56237),g=a(6423),D=a(68820),b=a(89152),v=a(96478),E=a(49528);function _(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function O(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_(Object(a),!0).forEach((function(t){(0,i.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const P=r.Ay.bind(null,{endpoint:"users.profile_picture_preview",rules:[{args:["source","user_id"],converters:{source:"AnyConverter",user_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"profile",isDynamic:!1},{data:"/",isDynamic:!1},{data:"picture",isDynamic:!1},{data:"/",isDynamic:!1},{data:"preview",isDynamic:!1},{data:"/",isDynamic:!1},{data:"source",isDynamic:!0}]},{args:["source"],converters:{source:"AnyConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"profile",isDynamic:!1},{data:"/",isDynamic:!1},{data:"picture",isDynamic:!1},{data:"/",isDynamic:!1},{data:"preview",isDynamic:!1},{data:"/",isDynamic:!1},{data:"source",isDynamic:!0}]}]},"/"),w=r.Ay.bind(null,{endpoint:"users.save_profile_picture",rules:[{args:["user_id"],converters:{user_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"profile",isDynamic:!1},{data:"/",isDynamic:!1},{data:"picture",isDynamic:!1}]},{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"profile",isDynamic:!1},{data:"/",isDynamic:!1},{data:"picture",isDynamic:!1}]}]},"/");function h(e){let{image:t,text:a,email:i,children:r,source:n}=e;const{input:{onChange:s,value:c}}=(0,d.useField)("source"),l=c===n;return o.createElement(m.A,{color:l?"blue":null,onClick:()=>s(n),style:l?{backgroundColor:"#f5f5f5"}:null},o.createElement(m.A.Description,null,t?o.createElement(p.A,{src:t,circular:!0,size:"tiny"}):o.createElement(y.A,{name:"question circle outline",size:"huge",className:"users-client-js-___ProfilePicture-module__placeholder___XTBq-"}),a),i&&o.createElement(D.TooltipIfTruncated,{useEventTarget:!0},o.createElement(m.A.Content,{extra:!0},o.createElement(v.Translate,null,"Based on ",o.createElement(v.Param,{name:"email",value:i})))),r&&o.createElement(m.A.Content,{extra:!0},r))}function A(e){let{onFileSelected:t}=e;const{submitting:a}=(0,d.useFormState)({subscription:{submitting:!0}}),{input:{onChange:i}}=(0,d.useField)("file",{allowNull:!0}),{getRootProps:r,getInputProps:n,open:s}=(0,u.VB)({onDropAccepted:e=>{let[a]=e;t(a),i(a)},multiple:!1,noClick:!0,noKeyboard:!0,accept:[".png",".jpg",".jpeg",".gif",".webp"],disabled:a});return o.createElement("section",null,o.createElement("div",r(),o.createElement("input",n()),o.createElement(f.A,{disabled:a,type:"button",icon:"upload",content:v.Translate.string("Upload"),size:"small",onClick:e=>{e.stopPropagation(),s()}})))}h.propTypes={image:c().string,text:c().string.isRequired,email:c().string,children:c().node,source:c().oneOf(["standard","identicon","gravatar","custom"]).isRequired},h.defaultProps={image:null,email:null,children:null},A.propTypes={onFileSelected:c().func.isRequired};const C=(0,n.A)({field:"file",updates:e=>null===e?{}:{source:"custom"}});function j(e){let{userId:t,email:a,source:i}=e;const[r,n]=(0,o.useState)(null),[s,c]=(0,o.useState)("custom"===i),l=null!==t?{user_id:t}:{},u=(0,o.useCallback)((e=>{n(e),c(!0)}),[]);return o.createElement("div",{className:"users-client-js-___ProfilePicture-module__profile-picture-selection___YxVGi"},o.createElement(d.Form,{onSubmit:async e=>{const t=new FormData;"custom"===e.source&&t.append("picture",e.file),t.append("source",e.source);const a={headers:{"content-type":"multipart/form-data"}};try{await E.indicoAxios.post(w(l),t,a)}catch(e){return void(0,E.handleAxiosError)(e)}location.reload(),await new Promise((()=>{}))},initialValues:{file:null,source:i},validate:e=>"custom"!==e.source||e.file?{}:{source:"invalid"},subscription:{},decorators:[C]},(e=>o.createElement("div",null,o.createElement(g.A,{onSubmit:e.handleSubmit},o.createElement(m.A.Group,{itemsPerRow:4,centered:!0},o.createElement(h,{image:P(O(O({},l),{},{source:"standard"})),text:v.Translate.string("System-assigned icon"),source:"standard"}),o.createElement(h,{image:P(O(O({},l),{},{source:"identicon"})),text:"Identicon",source:"identicon",email:a}),o.createElement(h,{image:P(O(O({},l),{},{source:"gravatar"})),text:"Gravatar",source:"gravatar",email:a}),o.createElement(h,{image:s?r?URL.createObjectURL(r):P(O(O({},l),{},{source:"custom"})):null,text:v.Translate.string("Custom picture"),source:"custom"},o.createElement(A,{onFileSelected:u}))),o.createElement(b.FinalSubmitButton,{label:v.Translate.string("Save changes"),className:"submit-button"}))))))}j.propTypes={userId:c().number,email:c().string.isRequired,source:c().string.isRequired},j.defaultProps={userId:null},window.setupPictureSelection=function(e,t,a){document.addEventListener("DOMContentLoaded",(()=>{l.render(o.createElement(j,{userId:e,email:t,source:a}),document.querySelector("#profile-picture-selection"))}))}}},e=>{e.O(0,[4644,4394,2076],(()=>{return t=48772,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_users.profile_picture.8048f4c0.bundle.js.map