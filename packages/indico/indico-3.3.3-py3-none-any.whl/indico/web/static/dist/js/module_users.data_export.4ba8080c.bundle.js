"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5817],{84368:(e,t,a)=>{var n=a(29079),r=a(97440),l=a.n(r),s=a(14867),i=a.n(s),o=a(97598),c=a.n(o),u=a(86326),d=a(35623),m=a(87597),p=a(56237),E=a(47279),x=a(6841),y=a(54219),g=a(89152),b=a(96478),f=a(49528),_=a(24372),A=a(78434),T=a.n(A),v=a(79858),D=a(42430),q=a(6423),h=a(45423),O=a(53225);const w={personal_data:b.Translate.string("Basic information about your account"),settings:b.Translate.string("Your global Indico settings"),contribs:b.Translate.string("Data about your contributions in events"),note_revisions:b.Translate.string("Data about minutes you wrote in events"),registrations:b.Translate.string("Data you submitted when registering for events"),room_booking:b.Translate.string("Your rooms and reservations"),abstracts_papers:b.Translate.string("Data about your abstract and paper submissions"),survey_submissions:b.Translate.string("Your survey answers"),attachments:b.Translate.string("Data about materials you uploaded"),editables:b.Translate.string("Data about editables submitted through the Editing module"),misc:b.Translate.string("Other data such as your API tokens and OAuth applications")};function R(e){let{onSubmit:t,exportOptions:a}=e;return u.createElement(u.Fragment,null,u.createElement("p",{className:"users-client-js-___DataExportForm-module__form-description___aTX-6"},u.createElement(b.Translate,null,"Here, you can request to export all data concerning you that is currently stored in Indico.")),u.createElement(D.Form,{onSubmit:t,initialValues:{includeFiles:!1,options:{}},initialValuesEqual:T(),validate:e=>{let{options:t}=e;if(!Object.values(t).some((e=>e)))return{[v.FORM_ERROR]:b.Translate.string("At least one option in the data section must be selected")}}},(e=>u.createElement(q.A,{onSubmit:e.handleSubmit},u.createElement(S,{exportOptions:a}),u.createElement(C,null),u.createElement("div",{className:"users-client-js-___DataExportForm-module__submit___Ncicq"},u.createElement(g.FinalSubmitButton,{label:b.Translate.string("Export my data")}))))))}function S(e){let{exportOptions:t}=e;return u.createElement(u.Fragment,null,u.createElement(h.A,{size:"medium",dividing:!0},u.createElement(b.Translate,{context:"user data export"},"Data selection")),u.createElement(O.A,null,t.map((e=>{let[t,a]=e;return u.createElement(O.A.Item,{key:t},u.createElement(O.A.Content,null,u.createElement(k,{name:`options.${t}`,title:a,description:w[t]})))}))))}function C(){return u.createElement(u.Fragment,null,u.createElement(h.A,{size:"medium",dividing:!0},u.createElement(b.Translate,{context:"user data export"},"Additional options")),u.createElement(O.A,null,u.createElement(O.A.Item,null,u.createElement(O.A.Content,null,u.createElement(k,{name:"includeFiles",title:b.Translate.string("Include files"),description:b.Translate.string("If checked, for each selected option, a copy of all your uploaded files will be included in the export. Note that depending on the number of files, this may significantly increase the download size of the export")})))))}function k(e){let{name:t,title:a,description:n}=e;return u.createElement("div",{className:"users-client-js-___DataExportForm-module__toggle___jslF4"},u.createElement(g.FinalCheckbox,{name:t,label:u.createElement("label",null,u.createElement("b",null,a))}),u.createElement("div",{className:"users-client-js-___DataExportForm-module__description___oPN3G"},n))}R.propTypes={onSubmit:c().func.isRequired,exportOptions:c().array.isRequired},S.propTypes={exportOptions:c().array.isRequired},k.propTypes={name:c().string.isRequired,title:c().string.isRequired,description:c().string.isRequired};const F=n.Ay.bind(null,{endpoint:"users.api_user_data_export",rules:[{args:["user_id"],converters:{user_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"data-export",isDynamic:!1}]},{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"data-export",isDynamic:!1}]}]},"/");function N(e){let{userId:t,request:a,exportOptions:n}=e;const r=null!==t?{user_id:t}:{},[s,i]=(0,u.useState)(a.state);return u.createElement("div",{className:"i-box-group vert"},u.createElement("div",{className:"i-box"},u.createElement("div",{className:"i-box-header"},u.createElement("div",{className:"i-box-title"},u.createElement(b.Translate,null,"Data export"))),u.createElement("div",{className:"i-box-content ui"},"none"===s&&u.createElement(R,{onSubmit:async e=>{const{includeFiles:t,options:a}=e,n=Object.keys(l()(a));let s;try{s=await f.indicoAxios.post(F(r),{include_files:t,options:n})}catch(e){return(0,g.handleSubmitError)(e)}i(s.data.state)},exportOptions:n}),"running"===s&&u.createElement(j,null),"success"===s&&u.createElement(I,{request:a,exportOptions:n,setState:i}),"failed"===s&&u.createElement(z,{setState:i}),"expired"===s&&u.createElement(H,{setState:i}))))}function j(){return u.createElement("div",null,u.createElement(m.A,{info:!0},u.createElement(m.A.Header,null,u.createElement(b.Translate,{context:"user data export"},"Your data is being prepared. We will notify you by email once it is available for download."))))}function I(e){let{request:t,exportOptions:a,setState:n}=e;return u.createElement("div",null,u.createElement("div",null,u.createElement(m.A,{positive:!0},u.createElement(m.A.Header,null,u.createElement(b.Translate,null,"Your data export is ready")),u.createElement(b.Translate,{as:"p",context:"user data export"},"You can download it from the link below")),t.maxSizeExceeded&&u.createElement(m.A,{warning:!0},u.createElement(b.Translate,{as:"p",context:"user data export"},"Some files were not exported due to exceeding the maximum allowed size of the archive. Consider selecting less options")),u.createElement(Y,{request:t,exportOptions:a}),u.createElement("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5em"}},u.createElement(p.A,{onClick:()=>n("none")},u.createElement(b.Translate,{context:"user data export"},"New export")),u.createElement(p.A,{primary:!0,icon:!0,labelPosition:"right",as:"a",href:t.url},u.createElement(b.Translate,null,"Download"),u.createElement(E.A,{name:"download"})))))}function z(e){let{setState:t}=e;return u.createElement("div",null,u.createElement(m.A,{negative:!0},u.createElement(m.A.Header,null,u.createElement(b.Translate,{context:"user data export"},"Data export failed")),u.createElement(b.Translate,{as:"p",context:"user data export"},"You can request a new one")),u.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},u.createElement(p.A,{primary:!0,icon:!0,labelPosition:"right",onClick:()=>t("none")},u.createElement(b.Translate,null,"Retry"),u.createElement(E.A,{name:"redo"}))))}function H(e){let{setState:t}=e;return u.createElement("div",null,u.createElement(m.A,{warning:!0},u.createElement(m.A.Header,null,u.createElement(b.Translate,null,"Download link expired"))),u.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},u.createElement(p.A,{primary:!0,onClick:()=>t("none"),icon:!0,labelPosition:"right"},u.createElement(b.Translate,{context:"user data export"},"New export"),u.createElement(E.A,{name:"zip"}))))}function Y(e){let{request:t,exportOptions:a}=e;return u.createElement(x.A,{celled:!0},u.createElement(x.A.Header,null,u.createElement(x.A.Row,null,u.createElement(x.A.HeaderCell,null,u.createElement(b.Translate,{context:"user data export request date"},"Requested on")),u.createElement(x.A.HeaderCell,null,u.createElement(b.Translate,{context:"user data export"},"Contents")))),u.createElement(x.A.Body,null,u.createElement(x.A.Row,null,u.createElement(x.A.Cell,null,i()(t.requestedDt).format("L")),u.createElement(x.A.Cell,null,t.selectedOptions.map((e=>u.createElement(y.A,{className:"users-client-js-___DataExport-module__option-label___DWmGs",key:e},a.find((t=>{let[a]=t;return a===e}))[1])))))))}N.propTypes={userId:c().number,request:c().shape({state:c().string.isRequired,requestedDt:c().string,selectedOptions:c().array,maxSizeExceeded:c().bool,url:c().string}).isRequired,exportOptions:c().array.isRequired},N.defaultProps={userId:null},I.propTypes={request:c().object.isRequired,exportOptions:c().array.isRequired,setState:c().func.isRequired},z.propTypes={setState:c().func.isRequired},H.propTypes={setState:c().func.isRequired},Y.propTypes={request:c().shape({requestedDt:c().string.isRequired,selectedOptions:c().arrayOf(c().string).isRequired}).isRequired,exportOptions:c().array.isRequired},window.setupDataExport=function(e,t,a){document.addEventListener("DOMContentLoaded",(()=>{d.render(u.createElement(N,{userId:e,request:(0,_.camelizeKeys)(t),exportOptions:a}),document.querySelector("#data-export-container"))}))}}},e=>{e.O(0,[4644,4394,2076],(()=>{return t=84368,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_users.data_export.4ba8080c.bundle.js.map