"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6002],{486:(e,t,a)=>{var n,r=a(29079),l=a(86326),o=a(35623),s=a(36111),i=a(25584);function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){(0,s.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}(n=window).setupCategoryDisplaySubcatList=function(){const e=$(".category-list").data("subcat-info-url");void 0!==e&&$.ajax({url:e,dataType:"json",success(e){Object.entries(e.event_counts).forEach((e=>{let[t,a]=e;const n=a.value?i.$T.ngettext("{0} event","{0} events",a.value).format(a.pretty):i.$T.gettext("empty");$(`#category-event-count-${t}`).text(n)}))}})},n.setupCategoryDisplayEventList=function(e,t,a,n){const r=$(".event-list"),l=r.find(".future-events"),o=r.find(".past-events");function s(e,t){const a=$(e),r=a.find(".events");function l(e){a.find(".js-hide-message").toggle(e),a.find(".js-show-message").toggle(!e)}function o(e){a.find(".js-toggle-list").toggle(!e),a.find(".js-spinner").toggle(e)}l(!r.is(":empty")),o(!1),a.find(".js-toggle-list").on("click",(function(e,a){let s;e.preventDefault(),r.is(":empty")?(s=!0,o(!0),$.ajax({url:r.data("event-list-url"),data:d({before:r.data("event-list-before"),after:r.data("event-list-after")},n),error:handleAjaxError,success(e){r.html(e.html),r.show(),l(!0),o(!1)}})):r.is(":visible")?(s=!1,r.hide(),l(!1)):(s=!0,r.show(),l(!0)),!a&&t&&t(s)}))}a&&(n.flat=1),s(l,(function(e){a||$.ajax({url:r.data("show-future-events-url"),method:e?"PUT":"DELETE",error:handleAjaxError})})),s(o,(function(e){a||$.ajax({url:r.data("show-past-events-url"),method:e?"PUT":"DELETE",error:handleAjaxError})})),e&&!a&&l.find(".js-toggle-list").first().trigger("click",!0),t&&!a&&o.find(".js-toggle-list").first().trigger("click",!0)};var u=a(68820),m=a(96478);document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#category-calendar-link");if(!e)return;const t=e.dataset.categoryId;o.render(l.createElement(u.ICSCalendarLink,{endpoint:"categories.export_ical",params:{category_id:t},renderButton:e=>l.createElement(u.IButton,{icon:"calendar",title:m.Translate.string("Export"),classes:e}),options:[{key:"category",text:m.Translate.string("Category"),extraParams:{}}]}),e)})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#fav-button");if(!e)return;const t=e.dataset.categoryId,a=void 0!==e.dataset.favorited;o.render(l.createElement(u.Favorite,{type:"category",id:t,favorited:a,setFavText:m.Translate.string("Add category to favorites (This will make events in this category visible on your Dashboard.)"),deleteFavText:m.Translate.string("Delete category from favorites.")}),e)}));var g=a(31610),_=a(64771),y=a(14867),p=a.n(y),E=a(97598),f=a.n(E),v=a(6841),b=a(91185),A=a(33971),h=a(68803),C=a(56237),D=a(51479),T=a(89152),j=a(59865),q=a(49528);const S={"./CategoryModeration.module.scss":{table:"categories-client-js-components-___CategoryModeration-module__table___Muk5s","no-border":"categories-client-js-components-___CategoryModeration-module__no-border___3wNOu",user:"categories-client-js-components-___CategoryModeration-module__user___D7Q+H",avatar:"categories-client-js-components-___CategoryModeration-module__avatar___gg2Un","table-footer":"categories-client-js-components-___CategoryModeration-module__table-footer___LCAAT",disabled:"categories-client-js-components-___CategoryModeration-module__disabled___kBJ15","text-separator":"categories-client-js-components-___CategoryModeration-module__text-separator___n+kI6"}},w=r.Ay.bind(null,{endpoint:"categories.api_event_move_requests",rules:[{args:["category_id"],converters:{category_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event-move-requests",isDynamic:!1}]}]},"/"),L=r.Ay.bind(null,{endpoint:"events.display",rules:[{args:["event_id"],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1}]}]},"/");function x(){return l.createElement(v.A.Row,null,l.createElement(v.A.Cell,{collapsing:!0},l.createElement(b.A,null)),l.createElement(v.A.Cell,{colSpan:"5"},l.createElement(A.A,{fluid:!0},l.createElement(A.A.Header,{image:!0},l.createElement(A.A.Line,null),l.createElement(A.A.Line,null)))))}function R(e){let{requestor:t,event:a,category:n,requestorComment:r,requestedDt:o,selected:s,onSelect:i}=e;const{fullName:c,avatarURL:d,affiliation:u}=t;return l.createElement(l.Fragment,null,l.createElement(v.A.Row,null,l.createElement(v.A.Cell,{collapsing:!0},l.createElement(b.A,{checked:s,onChange:i})),l.createElement(v.A.Cell,{className:"categories-client-js-components-___CategoryModeration-module__user___D7Q+H"},l.createElement(h.A,{className:"categories-client-js-components-___CategoryModeration-module__avatar___gg2Un",src:d,size:"mini",avatar:!0}),l.createElement("span",null,c," ",u&&`(${u})`)),l.createElement(v.A.Cell,null,l.createElement("a",{href:L({event_id:a.id})},a.title)),n?l.createElement(v.A.Cell,null,n.chainTitles.join(" » ")):l.createElement(m.Translate,{as:v.A.Cell},"Unlisted event"),l.createElement(v.A.Cell,null,function(e){let{startDt:t,endDt:a}=e;return t=p()(t),a=p()(a),t.isSame(a,"day")?`${t.format("L LT")} → ${a.format("LT")}`:`${t.format("L LT")} → ${a.format("L LT")}`}(a)),l.createElement(v.A.Cell,null,l.createElement("span",{title:p()(o).format("L LT")},p()(o).fromNow()))),r?l.createElement(v.A.Row,null,l.createElement(v.A.Cell,{className:"categories-client-js-components-___CategoryModeration-module__no-border___3wNOu"}),l.createElement(v.A.Cell,{colSpan:"5",className:"categories-client-js-components-___CategoryModeration-module__no-border___3wNOu"},r)):null)}function O(e){let{requests:t,onSubmit:a,loading:n}=e;const[r,o]=(0,l.useState)(new Set),[s,i]=(0,l.useState)(""),c=r.size>0,d=e=>{o(new Set),a(Array.from(r),e,s)};return 0!==t.length||n?l.createElement(v.A,{className:"categories-client-js-components-___CategoryModeration-module__table___Muk5s"},l.createElement(v.A.Header,null,l.createElement(v.A.Row,null,l.createElement(v.A.HeaderCell,null),l.createElement(m.Translate,{as:v.A.HeaderCell},"User"),l.createElement(m.Translate,{as:v.A.HeaderCell},"Event"),l.createElement(m.Translate,{as:v.A.HeaderCell},"Category"),l.createElement(m.Translate,{as:v.A.HeaderCell},"Event Date"),l.createElement(m.Translate,{as:v.A.HeaderCell},"Requested Date"))),l.createElement(v.A.Body,null,n?l.createElement(x,null):t.map((e=>{let{id:t,requestor:a,requestorComment:n,event:s,category:i,requestedDt:c}=e;return l.createElement(R,{key:t,id:t,event:s,category:i,requestor:a,requestedDt:c,requestorComment:n,selected:r.has(t),onSelect:()=>(e=>o((t=>{const a=new Set([...t,e]);return t.has(e)&&a.delete(e),a})))(t)})}))),l.createElement(v.A.Footer,{fullWidth:!0},l.createElement(v.A.Row,null,l.createElement(v.A.HeaderCell,null),l.createElement(v.A.HeaderCell,{colSpan:"5"},l.createElement("div",{className:(0,_.A)("table-footer "+(c?"":"disabled"),S,{autoResolveMultipleImports:!0,handleMissingStyleName:"throw"})},l.createElement(m.Translate,{as:C.A,onClick:()=>d(!0),color:"teal"},"Approve"),l.createElement(m.Translate,{as:"span",className:"categories-client-js-components-___CategoryModeration-module__text-separator___n+kI6"},"or"),l.createElement(D.A,{size:"small",placeholder:m.Translate.string("Provide the rejection reason"),value:s,onChange:(e,t)=>{let{value:a}=t;return i(a)}}),l.createElement(m.Translate,{as:"span",className:"categories-client-js-components-___CategoryModeration-module__text-separator___n+kI6"},"and"),l.createElement(m.Translate,{as:C.A,onClick:()=>d(!1),color:"red"},"Reject")))))):l.createElement(m.Translate,{as:"p"},"There are no event move requests.")}function N(e){let{categoryId:t}=e;const{data:a,lastData:n,loading:r,reFetch:o}=(0,j.Ku)({url:w({category_id:t})},{camelize:!0}),s=null==a?void 0:a.length;return(0,l.useEffect)((()=>{const e=document.querySelector("#side-menu-category-management-sidemenu .item.active .badge");e&&void 0!==s&&(s?e.textContent=s:e.style.display="none")}),[s]),n?l.createElement(O,{requests:a||[],onSubmit:async(e,a,n)=>{const r=w({category_id:t});try{await q.indicoAxios.post(r,{requests:e,accept:a,reason:n}),o()}catch(e){return(0,T.handleSubmitError)(e)}},loading:!a||r}):null}R.propTypes={requestor:f().shape({fullName:f().string,avatarURL:f().string,affiliation:f().string}).isRequired,event:f().shape({id:f().number.isRequired,title:f().string.isRequired,startDt:f().string.isRequired,endDt:f().string.isRequired}).isRequired,category:f().shape({id:f().number.isRequired,chainTitles:f().arrayOf(f().string).isRequired}),requestedDt:f().string.isRequired,requestorComment:f().string.isRequired,selected:f().bool,onSelect:f().func.isRequired},R.defaultProps={selected:!1,category:null},O.propTypes={requests:f().array.isRequired,onSubmit:f().func.isRequired,loading:f().bool},O.defaultProps={loading:!1},N.propTypes={categoryId:f().number.isRequired};var I=a(52376),M=a(23507),k=a(31951),Y=a(57427),P=a(45423),F=a(87597),H=a(10102);const z=l.createContext(null),U=r.Ay.bind(null,{endpoint:"categories.statistics_json",rules:[{args:["category_id"],converters:{category_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"statistics.json",isDynamic:!1}]}]},"/");function G(e){let{categoryId:t}=e;const{data:a,loading:n}=(0,j.Ku)({url:U({category_id:t})},{camelize:!0});return n?l.createElement(M.A,{size:"massive",active:!0}):a?l.createElement(B,{data:a}):null}function B(e){let{data:t}=e;const a=(0,l.useContext)(z).replace("_","-"),n=p().utc(t.updated).local().format("LLL"),r=new Intl.NumberFormat(a),o=r.format(t.totalEvents),s=r.format(t.totalContributions),i=r.format(t.files),c=r.format(t.users),{eventGraph:d,contributionsGraph:u,series:g,axes:_,tooltip:y}=(0,l.useMemo)((()=>function(e){const t=t=>{const a=parseInt(Object.keys(t).reverse().find((t=>t<=e.maxYear+3)),10);return[[p()(e.minYear-1,"YYYY"),null],...Object.entries(t).filter((t=>{let[n]=t;return n<=a&&n>=e.minYear})).map((e=>{let[t,a]=e;return[p()(t,"YYYY"),a]})),[p()(a+1,"YYYY"),null]]};return{eventGraph:[{label:m.Translate.string("Events"),data:t(e.events)}],contributionsGraph:[{label:m.Translate.string("Contributions"),data:t(e.contributions)}],series:{type:"bar"},axes:[{primary:!0,type:"time",position:"bottom"},{type:"linear",position:"left"}],tooltip:{align:"left",anchor:"left"}}}(t)),[t]);return l.createElement(k.A,null,l.createElement(Y.A.Group,{horizontal:!0},l.createElement(Y.A,null,l.createElement(P.A,{as:"h2"},l.createElement(P.A.Content,null,l.createElement(m.Translate,null,"Number of events"),l.createElement(P.A.Subheader,null,l.createElement(m.Translate,null,"The year is the one of the start date of the event.")))),l.createElement(Y.A,{basic:!0},0===d[0].data.length?l.createElement(F.A,{info:!0},l.createElement(m.Translate,null,"No data available")):l.createElement("div",{className:"categories-client-js-components-___CategoryStatistics-module__chart-container___FFFfl"},l.createElement(I.Chart,{className:"categories-client-js-components-___CategoryStatistics-module__chart___DIs5S",data:d,series:g,axes:_,tooltip:y})))),l.createElement(Y.A,null,l.createElement(P.A,{as:"h2"},l.createElement(P.A.Content,null,l.createElement(m.Translate,null,"Number of contributions"),l.createElement(P.A.Subheader,null,l.createElement(m.Translate,null,"The year is the one of the start date of the contribution.")))),l.createElement(Y.A,{basic:!0},0===u[0].data.length?l.createElement(F.A,{info:!0},l.createElement(m.Translate,null,"No data available")):l.createElement("div",{className:"categories-client-js-components-___CategoryStatistics-module__chart-container___FFFfl"},l.createElement(I.Chart,{className:"categories-client-js-components-___CategoryStatistics-module__chart___DIs5S",data:u,series:g,axes:_,tooltip:y}))))),l.createElement(Y.A.Group,{horizontal:!0},l.createElement(Y.A,{inverted:!0,color:"blue",textAlign:"center"},l.createElement(H.A,{inverted:!0},l.createElement(H.A.Value,null,o),l.createElement(H.A.Label,null,l.createElement(m.Translate,null,"Total number of events")))),l.createElement(Y.A,{inverted:!0,color:"blue",textAlign:"center"},l.createElement(H.A,{inverted:!0},l.createElement(H.A.Value,null,s),l.createElement(H.A.Label,null,l.createElement(m.Translate,null,"Total number of contributions")))),l.createElement(Y.A,{inverted:!0,color:"blue",textAlign:"center"},l.createElement(H.A,{inverted:!0},l.createElement(H.A.Value,null,i),l.createElement(H.A.Label,null,l.createElement(m.Translate,null,"Number of attachments")))),void 0!==t.users&&l.createElement(Y.A,{inverted:!0,color:"blue",textAlign:"center"},l.createElement(H.A,{inverted:!0},l.createElement(H.A.Value,null,c),l.createElement(H.A.Label,null,l.createElement(m.Translate,null,"Number of users"))))),l.createElement(m.Translate,null,"Last updated on: ",l.createElement(m.Param,{name:"time",value:n})))}G.propTypes={categoryId:f().number.isRequired},B.propTypes={data:f().shape({contributions:f().object.isRequired,events:f().object.isRequired,files:f().number.isRequired,updated:f().string.isRequired,users:f().number,totalEvents:f().number.isRequired,totalContributions:f().number.isRequired,minYear:f().number.isRequired,maxYear:f().number.isRequired}).isRequired};const V=r.Ay.bind(null,{endpoint:"search.category_search",rules:[{args:["category_id"],converters:{category_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"search",isDynamic:!1}]}]},"/"),J=r.Ay.bind(null,{endpoint:"search.search",rules:[{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"search",isDynamic:!1},{data:"/",isDynamic:!1}]}]},"/");!function(e){document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#search-box");if(e){const t=JSON.parse(e.dataset.category),a=void 0!==e.dataset.isAdmin;o.render(l.createElement(g.A,{onSearch:(e,n,r)=>{const l={q:e};a&&r&&(l.admin_override_enabled=!0),n?window.location=J(l):(l.category_id=t.id,window.location=V(l))},category:t,isAdmin:a}),e)}})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#category-moderation");if(e){const t=parseInt(e.dataset.categoryId,10);o.render(l.createElement(N,{categoryId:t}),e)}})),e.setupCategoryStats=function(){document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#category-stats-root");if(!e)return;const t=parseInt(e.dataset.categoryId,10),a=e.dataset.lang;o.render(l.createElement(z.Provider,{value:a},l.createElement(G,{categoryId:t})),e)}))}}(window)}},e=>{e.O(0,[4644,4394,2076],(()=>{return t=486,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_categories.d4e35026.bundle.js.map