"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1207],{64300:(e,t,r)=>{var n=r(86326),a=r(35623),s=r(44515),i=r(88996),l=r(88183),c=r.n(l),o=r(49528);const u="SET_KEYWORD",m="SET_FILTER",d="SET_PAGE",p="UPDATE_ENTRIES",g="FETCH_STARTED",h="FETCH_FAILED",E="SET_DETAILED_VIEW",y="SET_METADATA_QUERY",f="SET_INITIAL_REALMS";function w(e){return{type:d,currentPage:e}}function b(e){return{type:E,currentViewIndex:e}}function x(e){return{type:y,metadataQuery:e}}function P(){return async(e,t)=>{e({type:g});const{logs:{filters:r,keyword:n,currentPage:a,metadataQuery:s},staticData:{fetchLogsUrl:i}}=t(),l={page:a,filters:[],meta:s};let u;n&&(l.q=n),Object.entries(r).forEach((e=>{let[t,r]=e;r&&l.filters.push(t)}));try{u=await o.indicoAxios.get(i,{params:l,paramsSerializer:e=>c().stringify(e,{arrayFormat:"repeat",allowDots:!0})})}catch(t){return(0,o.handleAxiosError)(t),void e({type:h})}const{entries:m,pages:d,total_page_count:E}=u.data;e(function(e,t,r){return{type:p,entries:e,pages:t,totalPageCount:r}}(m,d,E))}}var v=r(96478),N=r(36111),T=r(14867),D=r.n(T),R=r(97598),C=r.n(R),I=r(68803),k=r(68820),S=r(94900);class O extends n.Component{constructor(e){super(e),this.modal=void 0,this.onClose=this.onClose.bind(this),this.prevEntry=this.prevEntry.bind(this),this.nextEntry=this.nextEntry.bind(this),this.relatedEntries=this.relatedEntries.bind(this)}componentDidUpdate(){const{currentViewIndex:e}=this.props;null!==e&&this.open()}open(){this.modal.open()}onClose(){const{setDetailedView:e}=this.props;e(null)}prevEntry(){const{prevEntry:e}=this.props;e()}nextEntry(){const{nextEntry:e}=this.props;e()}relatedEntries(){const{relatedEntries:e}=this.props;e()}_isFirstEntry(){const{currentPage:e,currentViewIndex:t}=this.props;return 1===e&&0===t}_isLastEntry(){const{currentPage:e,totalPageCount:t,currentViewIndex:r,entries:n}=this.props;return e===t&&r===n.length-1}_hasRelatedEntries(){const{currentViewIndex:e,entries:t}=this.props,r=t[e];return 0!==Object.keys(r.meta).length}render(){const{currentViewIndex:e,entries:t}=this.props;if(null===e)return"";const{description:r,html:a,user:{fullName:s},time:i}=t[e];return n.createElement(k.Modal,{title:r,ref:e=>{this.modal=e},onClose:this.onClose,contentLabel:"Details about log entry",fixedFooter:!0},n.createElement(S.Slot,null,n.createElement("table",{className:"i-table log-modal-details",dangerouslySetInnerHTML:{__html:a}}),n.createElement("div",{className:"text-superfluous log-modal-author-info flexrow f-j-end"},n.createElement("span",null,s&&n.createElement("span",{className:"log-modal-user"},s," "),"on",n.createElement("span",{className:"log-modal-time"}," ",D()(i).format("ddd, D/M/YYYY HH:mm"))))),n.createElement(S.Slot,{name:"footer"},n.createElement("div",{className:"group flexrow f-j-space-between"},n.createElement(k.IButton,{title:v.Translate.string("Previous"),icon:"prev",onClick:this.prevEntry,disabled:this._isFirstEntry()},n.createElement(v.Translate,null,"Previous")),n.createElement(k.IButton,{onClick:this.relatedEntries,disabled:!this._hasRelatedEntries()},n.createElement(v.Translate,null,"Related entries")),n.createElement(k.IButton,{title:v.Translate.string("Next"),classes:{next:!0},highlight:!0,onClick:this.nextEntry,disabled:this._isLastEntry()},n.createElement(v.Translate,null,"Next")))))}}(0,N.A)(O,"propTypes",{entries:C().array.isRequired,currentViewIndex:C().number,setDetailedView:C().func.isRequired,prevEntry:C().func.isRequired,nextEntry:C().func.isRequired,relatedEntries:C().func.isRequired,currentPage:C().number.isRequired,totalPageCount:C().number.isRequired}),(0,N.A)(O,"defaultProps",{currentViewIndex:null});const V=(0,s.connect)((e=>{let{logs:t}=e;return{currentViewIndex:t.currentViewIndex,currentPage:t.currentPage,totalPageCount:t.totalPageCount}}),(e=>({setDetailedView:t=>{e(b(t))},prevEntry:()=>{e((async(e,t)=>{const{staticData:{pageSize:r},logs:{currentViewIndex:n,currentPage:a}}=t();0===n?0===a||(await e(w(a-1)),await e(P()),await e(b(r-1))):e({type:E,currentViewIndex:n-1})}))},nextEntry:()=>{e((async(e,t)=>{const{staticData:{pageSize:r},logs:{currentViewIndex:n,currentPage:a,pages:s}}=t();n===r-1?a===s[s.length-1]||(await e(w(a+1)),await e(b(0)),await e(P())):e({type:E,currentViewIndex:n+1})}))},relatedEntries:()=>{e(((e,t)=>{const{logs:{entries:r,currentViewIndex:n}}=t(),a=r[n],s=c().stringify({meta:a.meta},{allowDots:!0});e(x(a.meta)),e(w(1)),e(b(null)),e(P()),history.replaceState({},null,`${location.pathname}?${s}`)}))}})))(O);class q extends n.PureComponent{constructor(e){super(e),this.openDetails=this.openDetails.bind(this)}openDetails(e){const{setDetailedView:t}=this.props;t(e)}iconProps(e){if("email"===e.type)switch(e.payload.state){case"pending":return{className:"log-icon semantic-text warning",title:v.Translate.string("This email is pending and will be sent soon."),"data-qtip-style":"warning"};case"sent":return{className:"log-icon semantic-text success",title:v.Translate.string("This email has been sent."),"data-qtip-style":"success"};case"failed":return{className:"log-icon semantic-text error",title:v.Translate.string("Sending this email failed."),"data-qtip-style":"danger"}}return{className:"log-icon"}}entryKind(e){if("email"!==e.type)return e.kind;return{pending:"change",sent:"positive",failed:"negative"}[e.payload.state]||"other"}render(){const{entry:e}=this.props;return n.createElement("li",{className:`log-realm-${e.realm} log-kind-${this.entryKind(e)}`},n.createElement("span",{className:"log-module"},n.createElement("span",this.iconProps(e),n.createElement("i",{className:"log-realm"}),n.createElement("i",{className:"log-kind icon-circle-small"})),n.createElement("span",{className:"bold"},e.module)),n.createElement(k.TooltipIfTruncated,null,n.createElement("span",{className:"log-entry-description",onClick:()=>this.openDetails(e.index)},e.description)),n.createElement("span",{className:"log-entry-details"},n.createElement("span",{className:"logged-time",title:D()(e.time).format("DD/MM/YYYY HH:mm")},n.createElement("time",{dateTime:e.time},D()(e.time).fromNow())),e.user.avatarURL?n.createElement(I.A,{avatar:!0,title:e.user.fullName,src:e.user.avatarURL,className:"user-picture ui-qtip"}):""))}}(0,N.A)(q,"propTypes",{entry:C().object.isRequired,setDetailedView:C().func.isRequired});class F extends n.PureComponent{renderEmpty(){return n.createElement(k.MessageBox,{type:"info"},"No logs to show")}renderSpinner(){return n.createElement("div",{className:"event-log-list-spinner"},n.createElement("div",{className:"i-spinner"}))}renderList(){const{entries:e,pages:t,currentPage:r,changePage:a,isFetching:s,setDetailedView:i}=this.props;return n.createElement(n.Fragment,null,s&&this.renderSpinner(),n.createElement("ul",{className:"event-log-list "+(s?"loading":"")},e.map((e=>n.createElement(q,{key:e.id,entry:e,setDetailedView:i})))),!s&&n.createElement(k.Paginator,{currentPage:r,pages:t,changePage:a}),n.createElement(V,{entries:e}))}render(){const{entries:e,isFetching:t}=this.props;return 0===e.length?t?this.renderSpinner():this.renderEmpty():this.renderList()}}(0,N.A)(F,"propTypes",{entries:C().array.isRequired,currentPage:C().number.isRequired,pages:C().array.isRequired,changePage:C().func.isRequired,isFetching:C().bool.isRequired,setDetailedView:C().func.isRequired});const j=(0,s.connect)((e=>{let{logs:t}=e;return{entries:t.entries,currentPage:t.currentPage,pages:t.pages,isFetching:t.isFetching}}),(e=>({changePage:t=>{e(w(t)),e(P())},setDetailedView:t=>{e(b(t))}})))(F);class A extends n.Component{render(){const{realms:e,filters:t,setFilter:r}=this.props;return n.createElement("div",{className:"toolbar"},n.createElement("div",{className:"group i-selection "+(e.length<=1?"hidden":"")},n.createElement("span",{className:"i-button label"},n.createElement(v.Translate,null,"Show")),Object.keys(e).sort().map((a=>n.createElement(n.Fragment,{key:a},n.createElement("input",{type:"checkbox",id:`realm-${a}`,"data-realm":a,defaultChecked:t[a],onChange:e=>r({[a]:e.target.checked})}),n.createElement("label",{htmlFor:`realm-${a}`,className:"i-button"},e[a]))))))}}(0,N.A)(A,"propTypes",{realms:C().object.isRequired,filters:C().object.isRequired,setFilter:C().func.isRequired});const _=(0,s.connect)((e=>{let{logs:t}=e;return{filters:t.filters}}),(e=>({setFilter:t=>{e(function(e){return{type:m,filter:e}}(t)),e(w(1)),e(P())}})))(A);var L=r(3803),Y=r.n(L);class U extends n.Component{render(){const{setKeyword:e}=this.props;return n.createElement("div",{className:"toolbar"},n.createElement("div",{className:"group"},n.createElement("span",{className:"i-button label"},n.createElement("span",{className:"icon-search"})),n.createElement("input",{type:"text",onChange:t=>e(t.target.value.trim())})))}}(0,N.A)(U,"propTypes",{setKeyword:C().func.isRequired});const M=(0,s.connect)(null,(e=>({setKeyword:Y()((t=>{e(function(e){return{type:u,keyword:e}}(t)),e(w(1)),e(P())}),250)})))(U);class Q extends n.Component{render(){const{realms:e}=this.props;return n.createElement("div",{className:"toolbars"},n.createElement(_,{realms:e}),n.createElement(M,null))}}(0,N.A)(Q,"propTypes",{realms:C().object.isRequired});const H=(0,s.connect)((e=>{let{staticData:t}=e;return{realms:t.realms}}))(Q);function K(){const e=(0,s.useDispatch)();return n.createElement("div",{className:"highlight-message-box"},n.createElement("span",{className:"icon"}),n.createElement("div",{className:"message-text"},n.createElement(v.Translate,null,"Log entries are currently filtered by URL."," ",n.createElement(v.Param,{name:"link",wrapper:n.createElement("a",{onClick:()=>{e((e=>{e(x({})),e(w(1)),e(b(null)),e(P()),history.replaceState({},null,location.pathname)}))}})},"Click here")," ","to disable the filter.")))}function $(){const e=(0,s.useSelector)((e=>e.logs.metadataQuery));return n.createElement(n.Fragment,null,0!==Object.keys(e).length&&n.createElement(K,null),n.createElement(H,null),n.createElement(j,null))}function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach((function(t){(0,N.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}K.propTypes={};const J={entries:[],keyword:null,currentPage:1,isFetching:!1,metadataQuery:{},filters:{},pages:[],totalPageCount:0,currentViewIndex:null};function W(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return B(B({},e),{},{filters:Object.fromEntries(t.initialRealms.map((e=>[e,!0])))});case u:return B(B({},e),{},{keyword:t.keyword});case m:return B(B({},e),{},{filters:B(B({},e.filters),t.filter)});case d:return B(B({},e),{},{currentPage:t.currentPage});case p:return B(B({},e),{},{entries:t.entries,pages:t.pages,totalPageCount:t.totalPageCount,isFetching:!1});case g:return B(B({},e),{},{isFetching:!0});case h:return B(B({},e),{},{isFetching:!1});case E:return B(B({},e),{},{currentViewIndex:t.currentViewIndex});case y:return B(B({},e),{},{metadataQuery:t.metadataQuery});default:return e}}window.addEventListener("load",(()=>{const e=document.querySelector(".event-log"),t={staticData:{fetchLogsUrl:e.dataset.fetchLogsUrl,realms:JSON.parse(e.dataset.realms),pageSize:15}},r=(0,i.Ay)("event-logs",{logs:W},t);var l;r.dispatch((l=Object.keys(t.staticData.realms),{type:f,initialRealms:l})),r.dispatch(x(JSON.parse(e.dataset.metadataQuery))),a.render(n.createElement(s.Provider,{store:r},n.createElement($,null)),e),r.dispatch(P())}))}},e=>{e.O(0,[4644,4394,2076],(()=>{return t=64300,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_logs.dbf8afec.bundle.js.map