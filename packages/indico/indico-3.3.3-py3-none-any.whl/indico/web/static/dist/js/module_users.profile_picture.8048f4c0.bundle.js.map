{"version":3,"file":"js/module_users.profile_picture.8048f4c0.bundle.js","mappings":"i2BAKA,MAAAA,EAAAC,EAAAA,GAAAC,KAAA,MAAAC,SAAA,gCAAAC,MAAA,EAAAC,KAAA,qBAAAC,WAAA,CAAAC,OAAA,eAAAC,QAAA,oBAAAC,SAAA,GAAAC,MAAA,EAAAC,KAAA,IAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,OAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,SAAAC,WAAA,MAAAP,KAAA,WAAAC,WAAA,CAAAC,OAAA,gBAAAE,SAAA,GAAAC,MAAA,EAAAC,KAAA,IAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,OAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,SAAAC,WAAA,YAAAC,EAAAZ,EAAAA,GAAAC,KAAA,MAAAC,SAAA,6BAAAC,MAAA,EAAAC,KAAA,YAAAC,WAAA,CAAAE,QAAA,oBAAAC,SAAA,GAAAC,MAAA,EAAAC,KAAA,IAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,OAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,MAAAP,KAAA,GAAAC,WAAA,GAAAG,SAAA,GAAAC,MAAA,EAAAC,KAAA,IAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,OAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,YAoBA,SAASE,EAAkBC,GAAyC,IAAxC,MAACC,EAAK,KAAEC,EAAI,MAAEC,EAAK,SAAEC,EAAQ,OAAEZ,GAAOQ,EAChE,MACEK,OAAO,SAACC,EAAQ,MAAEC,KAChBC,EAAAA,EAAAA,UAAS,UAEPC,EAASF,IAAUf,EACzB,OACEkB,EAAAA,cAACC,EAAAA,EAAI,CACHC,MAAOH,EAAS,OAAS,KACzBI,QAASA,IAAMP,EAASd,GACxBsB,MAAOL,EAAS,CAACM,gBAAiB,WAAa,MAE/CL,EAAAA,cAACC,EAAAA,EAAKK,YAAW,KACdf,EACCS,EAAAA,cAACO,EAAAA,EAAK,CAACC,IAAKjB,EAAOkB,UAAQ,EAACC,KAAK,SAEjCV,EAAAA,cAACW,EAAAA,EAAI,CAACC,KAAK,0BAA0BF,KAAK,OAAOG,UAAU,kEAE5DrB,GAEFC,GACCO,EAAAA,cAACc,EAAAA,mBAAkB,CAACC,gBAAc,GAChCf,EAAAA,cAACC,EAAAA,EAAKe,QAAO,CAACC,OAAK,GACjBjB,EAAAA,cAACkB,EAAAA,UAAS,KAAC,YACAlB,EAAAA,cAACmB,EAAAA,MAAK,CAACP,KAAK,QAAQf,MAAOJ,OAK3CC,GAAYM,EAAAA,cAACC,EAAAA,EAAKe,QAAO,CAACC,OAAK,GAAEvB,GAGxC,CAgBA,SAAS0B,EAAmBC,GAAmB,IAAlB,eAACC,GAAeD,EAC3C,MAAM,WAACE,IAAcC,EAAAA,EAAAA,cAAa,CAChCC,aAAc,CAACF,YAAY,MAI3B5B,OAAO,SAACC,KACNE,EAAAA,EAAAA,UAAS,OAAQ,CAAC4B,WAAW,KAE3B,aAACC,EAAY,cAAEC,EAAa,KAAEC,IAAQC,EAAAA,EAAAA,IAAY,CACtDC,eAAgBC,IAAY,IAAVC,GAAKD,EACrBV,EAAeW,GACfrC,EAASqC,EAAK,EAEhBC,UAAU,EACVC,SAAS,EACTC,YAAY,EACZC,OAAQ,CAAC,OAAQ,OAAQ,QAAS,OAAQ,SAC1CC,SAAUf,IAGZ,OACEvB,EAAAA,cAAA,eACEA,EAAAA,cAAA,MAAS2B,IACP3B,EAAAA,cAAA,QAAW4B,KACX5B,EAAAA,cAACuC,EAAAA,EAAM,CACLD,SAAUf,EACViB,KAAK,SACLC,KAAK,SACLC,QAASxB,EAAAA,UAAUyB,OAAO,UAC1BjC,KAAK,QACLP,QAASyC,IACPA,EAAIC,kBACJhB,GAAM,KAMlB,CArDAxC,EAAmByD,UAAY,CAC7BvD,MAAOwD,IAAAA,OACPvD,KAAMuD,IAAAA,OAAiBC,WACvBvD,MAAOsD,IAAAA,OACPrD,SAAUqD,IAAAA,KACVjE,OAAQiE,IAAAA,MAAgB,CAAC,WAAY,YAAa,WAAY,WAAWC,YAG3E3D,EAAmB4D,aAAe,CAChC1D,MAAO,KACPE,MAAO,KACPC,SAAU,MA4CZ0B,EAAoB0B,UAAY,CAC9BxB,eAAgByB,IAAAA,KAAeC,YAGjC,MAAME,GAAgBC,EAAAA,EAAAA,GAAgB,CACpCC,MAAO,OACPC,QAASxD,GAAoB,OAAVA,EAAiB,CAAC,EAAI,CAACf,OAAQ,YAGpD,SAASwE,EAAcC,GAA0B,IAAzB,OAACC,EAAM,MAAE/D,EAAK,OAAEX,GAAOyE,EAC7C,MAAOE,EAAaC,IAAkBC,EAAAA,EAAAA,UAAS,OACxCC,EAAYC,IAAiBF,EAAAA,EAAAA,UAAoB,WAAX7E,GAEvCgF,EAAwB,OAAXN,EAAkB,CAACzE,QAASyE,GAAU,CAAC,EA4BpDO,GAAqBC,EAAAA,EAAAA,cAAY/B,IACrCyB,EAAezB,GACf4B,GAAc,EAAK,GAClB,IASH,OACE7D,EAAAA,cAAA,OAAKa,UAAU,+EACbb,EAAAA,cAACiE,EAAAA,KAAS,CACRC,SAzCgBC,UACpB,MAAMC,EAAe,IAAIC,SACD,WAApBC,EAASxF,QACXsF,EAAaG,OAAO,UAAWD,EAASrC,MAE1CmC,EAAaG,OAAO,SAAUD,EAASxF,QACvC,MAAM0F,EAAS,CACbC,QAAS,CAAC,eAAgB,wBAE5B,UACQC,EAAAA,YAAYC,KAAKvF,EAAQ0E,GAAaM,EAAcI,EAC5D,CAAE,MAAOI,GAEP,YADAC,EAAAA,EAAAA,kBAAiBD,EAEnB,CACAE,SAASC,eAEH,IAAIC,SAAQ,QAAS,EAyBvBC,cAAe,CAAChD,KAAM,KAAMnD,UAC5BoG,SAZWC,GACO,WAAlBA,EAAOrG,QAAwBqG,EAAOlD,KAGnC,CAAC,EAFC,CAACnD,OAAQ,WAWd2C,aAAc,CAAC,EACf2D,WAAY,CAAClC,KAEZmC,GACCrF,EAAAA,cAAA,WACEA,EAAAA,cAACsF,EAAAA,EAAI,CAACpB,SAAUmB,EAAOE,cACrBvF,EAAAA,cAACC,EAAAA,EAAKuF,MAAK,CAACC,YAAa,EAAGC,UAAQ,GAClC1F,EAAAA,cAACX,EAAkB,CACjBE,MAAOhB,EAAUoH,EAAAA,EAAC,CAAC,EAAG7B,GAAU,IAAEhF,OAAQ,cAC1CU,KAAM0B,EAAAA,UAAUyB,OAAO,wBACvB7D,OAAO,aAETkB,EAAAA,cAACX,EAAkB,CACjBE,MAAOhB,EAAUoH,EAAAA,EAAC,CAAC,EAAG7B,GAAU,IAAEhF,OAAQ,eAC1CU,KAAK,YACLV,OAAO,YACPW,MAAOA,IAETO,EAAAA,cAACX,EAAkB,CACjBE,MAAOhB,EAAUoH,EAAAA,EAAC,CAAC,EAAG7B,GAAU,IAAEhF,OAAQ,cAC1CU,KAAK,WACLV,OAAO,WACPW,MAAOA,IAETO,EAAAA,cAACX,EAAkB,CACjBE,MAAOqE,EAhDdH,EACHmC,IAAIC,gBAAgBpC,GACpBlF,EAAUoH,EAAAA,EAAC,CAAC,EAAG7B,GAAU,IAAEhF,OAAQ,YA8CU,KACnCU,KAAM0B,EAAAA,UAAUyB,OAAO,kBACvB7D,OAAO,UAEPkB,EAAAA,cAACoB,EAAmB,CAACE,eAAgByC,MAGzC/D,EAAAA,cAAC8F,EAAAA,kBAAiB,CAChBC,MAAO7E,EAAAA,UAAUyB,OAAO,gBACxB9B,UAAU,sBAQ1B,CAEAyC,EAAeR,UAAY,CACzBU,OAAQT,IAAAA,OACRtD,MAAOsD,IAAAA,OAAiBC,WACxBlE,OAAQiE,IAAAA,OAAiBC,YAG3BM,EAAeL,aAAe,CAC5BO,OAAQ,MAGVwC,OAAOC,sBAAwB,SAA+BzC,EAAQ/D,EAAOX,GAC3EoH,SAASC,iBAAiB,oBAAoB,KAC5CC,EAAAA,OACEpG,EAAAA,cAACsD,EAAc,CAACE,OAAQA,EAAQ/D,MAAOA,EAAOX,OAAQA,IACtDoH,SAASG,cAAc,8BACxB,GAEL,C","sources":["webpack:///indico/modules/users/client/js/ProfilePicture.jsx"],"sourcesContent":["// This file is part of Indico.\n// Copyright (C) 2002 - 2024 CERN\n//\n// Indico is free software; you can redistribute it and/or\n// modify it under the terms of the MIT License; see the\n// LICENSE file for more details.\n\nimport previewURL from 'indico-url:users.profile_picture_preview';\nimport saveURL from 'indico-url:users.save_profile_picture';\n\nimport createDecorator from 'final-form-calculate';\nimport PropTypes from 'prop-types';\nimport React, {useState, useCallback} from 'react';\nimport ReactDOM from 'react-dom';\nimport {useDropzone} from 'react-dropzone';\nimport {Form as FinalForm, useField, useFormState} from 'react-final-form';\nimport {Button, Form, Icon, Image, Card} from 'semantic-ui-react';\n\nimport {TooltipIfTruncated} from 'indico/react/components';\nimport {FinalSubmitButton} from 'indico/react/forms';\nimport {Translate, Param} from 'indico/react/i18n';\nimport {indicoAxios, handleAxiosError} from 'indico/utils/axios';\n\nimport './ProfilePicture.module.scss';\n\nfunction ProfilePictureCard({image, text, email, children, source}) {\n  const {\n    input: {onChange, value},\n  } = useField('source');\n\n  const active = value === source;\n  return (\n    <Card\n      color={active ? 'blue' : null}\n      onClick={() => onChange(source)}\n      style={active ? {backgroundColor: '#f5f5f5'} : null}\n    >\n      <Card.Description>\n        {image ? (\n          <Image src={image} circular size=\"tiny\" />\n        ) : (\n          <Icon name=\"question circle outline\" size=\"huge\" styleName=\"placeholder\" />\n        )}\n        {text}\n      </Card.Description>\n      {email && (\n        <TooltipIfTruncated useEventTarget>\n          <Card.Content extra>\n            <Translate>\n              Based on <Param name=\"email\" value={email} />\n            </Translate>\n          </Card.Content>\n        </TooltipIfTruncated>\n      )}\n      {children && <Card.Content extra>{children}</Card.Content>}\n    </Card>\n  );\n}\n\nProfilePictureCard.propTypes = {\n  image: PropTypes.string,\n  text: PropTypes.string.isRequired,\n  email: PropTypes.string,\n  children: PropTypes.node,\n  source: PropTypes.oneOf(['standard', 'identicon', 'gravatar', 'custom']).isRequired,\n};\n\nProfilePictureCard.defaultProps = {\n  image: null,\n  email: null,\n  children: null,\n};\n\nfunction CustomPictureUpload({onFileSelected}) {\n  const {submitting} = useFormState({\n    subscription: {submitting: true},\n  });\n\n  const {\n    input: {onChange},\n  } = useField('file', {allowNull: true});\n\n  const {getRootProps, getInputProps, open} = useDropzone({\n    onDropAccepted: ([file]) => {\n      onFileSelected(file);\n      onChange(file);\n    },\n    multiple: false,\n    noClick: true,\n    noKeyboard: true,\n    accept: ['.png', '.jpg', '.jpeg', '.gif', '.webp'],\n    disabled: submitting,\n  });\n\n  return (\n    <section>\n      <div {...getRootProps()}>\n        <input {...getInputProps()} />\n        <Button\n          disabled={submitting}\n          type=\"button\"\n          icon=\"upload\"\n          content={Translate.string('Upload')}\n          size=\"small\"\n          onClick={evt => {\n            evt.stopPropagation();\n            open();\n          }}\n        />\n      </div>\n    </section>\n  );\n}\n\nCustomPictureUpload.propTypes = {\n  onFileSelected: PropTypes.func.isRequired,\n};\n\nconst formDecorator = createDecorator({\n  field: 'file',\n  updates: value => (value === null ? {} : {source: 'custom'}),\n});\n\nfunction ProfilePicture({userId, email, source}) {\n  const [previewFile, setPreviewFile] = useState(null);\n  const [hasPreview, setHasPreview] = useState(source === 'custom');\n\n  const userIdArgs = userId !== null ? {user_id: userId} : {};\n\n  const submitPicture = async formData => {\n    const bodyFormData = new FormData();\n    if (formData.source === 'custom') {\n      bodyFormData.append('picture', formData.file);\n    }\n    bodyFormData.append('source', formData.source);\n    const config = {\n      headers: {'content-type': 'multipart/form-data'},\n    };\n    try {\n      await indicoAxios.post(saveURL(userIdArgs), bodyFormData, config);\n    } catch (e) {\n      handleAxiosError(e);\n      return;\n    }\n    location.reload();\n    // never finish submitting to avoid fields being re-enabled\n    await new Promise(() => {});\n  };\n\n  const getPreview = () => {\n    return previewFile\n      ? URL.createObjectURL(previewFile)\n      : previewURL({...userIdArgs, source: 'custom'});\n  };\n\n  const handleFileSelected = useCallback(file => {\n    setPreviewFile(file);\n    setHasPreview(true);\n  }, []);\n\n  const validate = values => {\n    if (values.source === 'custom' && !values.file) {\n      return {source: 'invalid'};\n    }\n    return {};\n  };\n\n  return (\n    <div styleName=\"profile-picture-selection\">\n      <FinalForm\n        onSubmit={submitPicture}\n        initialValues={{file: null, source}}\n        validate={validate}\n        subscription={{}}\n        decorators={[formDecorator]}\n      >\n        {fprops => (\n          <div>\n            <Form onSubmit={fprops.handleSubmit}>\n              <Card.Group itemsPerRow={4} centered>\n                <ProfilePictureCard\n                  image={previewURL({...userIdArgs, source: 'standard'})}\n                  text={Translate.string('System-assigned icon')}\n                  source=\"standard\"\n                />\n                <ProfilePictureCard\n                  image={previewURL({...userIdArgs, source: 'identicon'})}\n                  text=\"Identicon\"\n                  source=\"identicon\"\n                  email={email}\n                />\n                <ProfilePictureCard\n                  image={previewURL({...userIdArgs, source: 'gravatar'})}\n                  text=\"Gravatar\"\n                  source=\"gravatar\"\n                  email={email}\n                />\n                <ProfilePictureCard\n                  image={hasPreview ? getPreview() : null}\n                  text={Translate.string('Custom picture')}\n                  source=\"custom\"\n                >\n                  <CustomPictureUpload onFileSelected={handleFileSelected} />\n                </ProfilePictureCard>\n              </Card.Group>\n              <FinalSubmitButton\n                label={Translate.string('Save changes')}\n                className=\"submit-button\"\n              />\n            </Form>\n          </div>\n        )}\n      </FinalForm>\n    </div>\n  );\n}\n\nProfilePicture.propTypes = {\n  userId: PropTypes.number,\n  email: PropTypes.string.isRequired,\n  source: PropTypes.string.isRequired,\n};\n\nProfilePicture.defaultProps = {\n  userId: null,\n};\n\nwindow.setupPictureSelection = function setupPictureSelection(userId, email, source) {\n  document.addEventListener('DOMContentLoaded', () => {\n    ReactDOM.render(\n      <ProfilePicture userId={userId} email={email} source={source} />,\n      document.querySelector('#profile-picture-selection')\n    );\n  });\n};\n"],"names":["previewURL","_buildFlaskURL","bind","endpoint","rules","args","converters","source","user_id","defaults","trace","data","isDynamic","saveURL","ProfilePictureCard","_ref","image","text","email","children","input","onChange","value","useField","active","React","Card","color","onClick","style","backgroundColor","Description","Image","src","circular","size","Icon","name","className","TooltipIfTruncated","useEventTarget","Content","extra","Translate","Param","CustomPictureUpload","_ref2","onFileSelected","submitting","useFormState","subscription","allowNull","getRootProps","getInputProps","open","useDropzone","onDropAccepted","_ref3","file","multiple","noClick","noKeyboard","accept","disabled","Button","type","icon","content","string","evt","stopPropagation","propTypes","PropTypes","isRequired","defaultProps","formDecorator","createDecorator","field","updates","ProfilePicture","_ref4","userId","previewFile","setPreviewFile","useState","hasPreview","setHasPreview","userIdArgs","handleFileSelected","useCallback","FinalForm","onSubmit","async","bodyFormData","FormData","formData","append","config","headers","indicoAxios","post","e","handleAxiosError","location","reload","Promise","initialValues","validate","values","decorators","fprops","Form","handleSubmit","Group","itemsPerRow","centered","_objectSpread","URL","createObjectURL","FinalSubmitButton","label","window","setupPictureSelection","document","addEventListener","ReactDOM","querySelector"],"sourceRoot":""}