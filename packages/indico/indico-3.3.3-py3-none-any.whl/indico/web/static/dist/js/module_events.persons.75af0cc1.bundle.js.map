{"version":3,"file":"js/module_events.persons.75af0cc1.bundle.js","mappings":"8MAKA,MAAAA,EAAAC,EAAAA,GAAAC,KAAA,MAAAC,SAAA,wBAAAC,MAAA,EAAAC,KAAA,yBAAAC,WAAA,CAAAC,SAAA,mBAAAC,UAAA,oBAAAC,SAAA,GAAAC,MAAA,EAAAC,KAAA,IAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,QAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,WAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,SAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,UAAAC,WAAA,IAAAD,KAAA,IAAAC,WAAA,IAAAD,KAAA,YAAAC,WAAA,YAcA,SAASC,EAAeC,GAAiE,IAAhE,QAACC,EAAO,OAAEC,EAAM,0BAAEC,EAAyB,iBAAEC,GAAiBJ,EACrF,MAAOK,EAAWC,IAAgBC,EAAAA,EAAAA,WAAS,GA0B3C,OACEC,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAA,KACEC,UAAU,mBACVC,MAAOC,EAAAA,UAAUC,OAAO,2BACxBC,QAASA,IAAMP,GAAa,KAE7BD,GACCG,EAAAA,cAACM,EAAAA,mBAAkB,CACjBZ,OAAQA,EACRC,0BAA2BA,EAC3BY,gBAAc,EACdC,QAASA,IAAMV,GAAa,GAC5BW,SArCaC,MAAOrB,EAAMsB,KAChC,MAAMC,GAAgBC,EAAAA,EAAAA,kBAAiBxB,EAAMsB,GAS7C,IAAIG,EARCnB,EAGMiB,EAAcG,kBACvBH,EAAcI,YAAcJ,EAAcG,gBAAgBE,KAAKC,OAC/DN,EAAcO,cAAgBP,EAAcG,gBAAgBK,UACrDR,EAAcG,wBAJdH,EAAcG,gBAOvB,IACED,QAAaO,EAAAA,YAAYC,MACvB5C,EAAgB,CAACO,SAAUQ,EAASP,UAAWQ,EAAO0B,MACtDG,EAAAA,EAAAA,aAAYX,GAEhB,CAAE,MAAOY,GACP,OAAOC,EAAAA,EAAAA,mBAAkBD,EAC3B,CAEA5B,EAAiBkB,EAAKzB,KAAKqC,YACrB,IAAIC,SAAQ,QAAS,IAqB/B,CAEApC,EAAgBqC,UAAY,CAC1BnC,QAASoC,IAAAA,OAAiBC,WAC1BpC,OAAQmC,IAAAA,OAAiBC,WACzBnC,0BAA2BkC,IAAAA,KAAeC,WAC1ClC,iBAAkBiC,IAAAA,KAAeC,YAGnCC,OAAOC,qBAAuB,CAACvC,EAASC,EAAQC,KAC9C,MAAMsC,EAAYC,SAASC,cAAe,gBAAezC,EAAO0B,MAOhEgB,EAAAA,OACEpC,EAAAA,cAACT,EAAe,CACdE,QAASA,EACTC,QAAQ2C,EAAAA,EAAAA,cAAa3C,GACrBC,0BAA2BA,EAC3BC,iBAXqB8B,IACvBU,EAAAA,uBAAgCH,GAEhCK,EAAG,WAAU5C,EAAO0B,MAAMM,KAAKA,EAAK,IAUpCO,EACD,C","sources":["webpack:///indico/modules/events/persons/client/js/EditEventPerson.jsx"],"sourcesContent":["// This file is part of Indico.\n// Copyright (C) 2002 - 2024 CERN\n//\n// Indico is free software; you can redistribute it and/or\n// modify it under the terms of the MIT License; see the\n// LICENSE file for more details.\n\nimport updatePersonURL from 'indico-url:persons.update_person';\n\nimport PropTypes from 'prop-types';\nimport React, {useState} from 'react';\nimport ReactDOM from 'react-dom';\n\nimport {PersonDetailsModal} from 'indico/react/components';\nimport {getChangedValues, handleSubmitError} from 'indico/react/forms';\nimport {Translate} from 'indico/react/i18n';\nimport {indicoAxios} from 'indico/utils/axios';\nimport {camelizeKeys, snakifyKeys} from 'indico/utils/case';\n\nfunction EditEventPerson({eventId, person, hasPredefinedAffiliations, replacePersonRow}) {\n  const [modalOpen, setModalOpen] = useState(false);\n\n  const handleSubmit = async (data, form) => {\n    const changedValues = getChangedValues(data, form);\n    if (!hasPredefinedAffiliations) {\n      // changedValues.affiliation is already there and used\n      delete changedValues.affiliationData;\n    } else if (changedValues.affiliationData) {\n      changedValues.affiliation = changedValues.affiliationData.text.trim();\n      changedValues.affiliationId = changedValues.affiliationData.id;\n      delete changedValues.affiliationData;\n    }\n    let resp;\n    try {\n      resp = await indicoAxios.patch(\n        updatePersonURL({event_id: eventId, person_id: person.id}),\n        snakifyKeys(changedValues)\n      );\n    } catch (e) {\n      return handleSubmitError(e);\n    }\n\n    replacePersonRow(resp.data.html);\n    await new Promise(() => {});\n  };\n\n  return (\n    <>\n      <a\n        className=\"i-link icon-edit\"\n        title={Translate.string('Edit person information')}\n        onClick={() => setModalOpen(true)}\n      />\n      {modalOpen && (\n        <PersonDetailsModal\n          person={person}\n          hasPredefinedAffiliations={hasPredefinedAffiliations}\n          hideEmailField\n          onClose={() => setModalOpen(false)}\n          onSubmit={handleSubmit}\n        />\n      )}\n    </>\n  );\n}\n\nEditEventPerson.propTypes = {\n  eventId: PropTypes.number.isRequired,\n  person: PropTypes.object.isRequired,\n  hasPredefinedAffiliations: PropTypes.bool.isRequired,\n  replacePersonRow: PropTypes.func.isRequired,\n};\n\nwindow.setupEditEventPerson = (eventId, person, hasPredefinedAffiliations) => {\n  const container = document.querySelector(`#edit-person-${person.id}`);\n  const replacePersonRow = html => {\n    ReactDOM.unmountComponentAtNode(container);\n    // sorry for using jquery here, but it's the most convenient way to execute inline JS..\n    $(`#person-${person.id}`).html(html);\n  };\n\n  ReactDOM.render(\n    <EditEventPerson\n      eventId={eventId}\n      person={camelizeKeys(person)}\n      hasPredefinedAffiliations={hasPredefinedAffiliations}\n      replacePersonRow={replacePersonRow}\n    />,\n    container\n  );\n};\n"],"names":["updatePersonURL","_buildFlaskURL","bind","endpoint","rules","args","converters","event_id","person_id","defaults","trace","data","isDynamic","EditEventPerson","_ref","eventId","person","hasPredefinedAffiliations","replacePersonRow","modalOpen","setModalOpen","useState","React","className","title","Translate","string","onClick","PersonDetailsModal","hideEmailField","onClose","onSubmit","async","form","changedValues","getChangedValues","resp","affiliationData","affiliation","text","trim","affiliationId","id","indicoAxios","patch","snakifyKeys","e","handleSubmitError","html","Promise","propTypes","PropTypes","isRequired","window","setupEditEventPerson","container","document","querySelector","ReactDOM","camelizeKeys","$"],"sourceRoot":""}